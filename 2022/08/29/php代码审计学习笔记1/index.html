<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/wan1/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/wan1/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/wan1/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/wan1/images/logo.svg" color="#222">

<link rel="stylesheet" href="/wan1/css/main.css">


<link rel="stylesheet" href="/wan1/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"wanheiqiyihu.gitee.io","root":"/wan1/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="php代码审计学习笔记1课程是某牛的，笔记只供个人学习 感觉就是从代码层面复习了一遍漏洞原理 环境配置及审计工具介绍环境就用phpstudy 看代码的话我用的是notepad++ 审计工具可以用seay源代码审计系统（基于正则 Fortify SCA也是一款不错的商业化代码审计工具（靠内置的规则空间匹配 rips审计工具也不错，可以看到用户输的一些点 以及一款数据库监控工具 vMysqlMonit">
<meta property="og:type" content="article">
<meta property="og:title" content="php代码审计学习笔记1">
<meta property="og:url" content="https://wanheiqiyihu.gitee.io/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/index.html">
<meta property="og:site_name" content="十三の博客">
<meta property="og:description" content="php代码审计学习笔记1课程是某牛的，笔记只供个人学习 感觉就是从代码层面复习了一遍漏洞原理 环境配置及审计工具介绍环境就用phpstudy 看代码的话我用的是notepad++ 审计工具可以用seay源代码审计系统（基于正则 Fortify SCA也是一款不错的商业化代码审计工具（靠内置的规则空间匹配 rips审计工具也不错，可以看到用户输的一些点 以及一款数据库监控工具 vMysqlMonit">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://wanheiqiyihu.gitee.io/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220824105406833.png">
<meta property="og:image" content="https://wanheiqiyihu.gitee.io/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220824105546784.png">
<meta property="og:image" content="https://wanheiqiyihu.gitee.io/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220824105649145.png">
<meta property="og:image" content="https://wanheiqiyihu.gitee.io/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220824183645573.png">
<meta property="og:image" content="https://wanheiqiyihu.gitee.io/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220824185643247.png">
<meta property="og:image" content="https://wanheiqiyihu.gitee.io/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220824194314976.png">
<meta property="og:image" content="https://wanheiqiyihu.gitee.io/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220826202223548.png">
<meta property="og:image" content="https://wanheiqiyihu.gitee.io/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220826205026879.png">
<meta property="og:image" content="https://wanheiqiyihu.gitee.io/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220826205517820.png">
<meta property="og:image" content="https://wanheiqiyihu.gitee.io/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827131024547.png">
<meta property="og:image" content="https://wanheiqiyihu.gitee.io/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827133732973.png">
<meta property="og:image" content="https://wanheiqiyihu.gitee.io/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827135455087.png">
<meta property="og:image" content="https://wanheiqiyihu.gitee.io/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827151005452.png">
<meta property="og:image" content="https://wanheiqiyihu.gitee.io/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827151016017.png">
<meta property="og:image" content="https://wanheiqiyihu.gitee.io/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827151921288.png">
<meta property="og:image" content="https://wanheiqiyihu.gitee.io/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827165236507.png">
<meta property="og:image" content="https://wanheiqiyihu.gitee.io/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827183314670.png">
<meta property="og:image" content="https://wanheiqiyihu.gitee.io/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827183326474.png">
<meta property="og:image" content="https://wanheiqiyihu.gitee.io/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827170249923.png">
<meta property="og:image" content="https://wanheiqiyihu.gitee.io/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827171538419.png">
<meta property="og:image" content="https://wanheiqiyihu.gitee.io/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827180110497.png">
<meta property="og:image" content="https://wanheiqiyihu.gitee.io/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827190243561.png">
<meta property="og:image" content="https://wanheiqiyihu.gitee.io/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827201453222.png">
<meta property="og:image" content="https://wanheiqiyihu.gitee.io/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827203219636.png">
<meta property="og:image" content="https://wanheiqiyihu.gitee.io/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827210315089.png">
<meta property="og:image" content="https://wanheiqiyihu.gitee.io/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827210740514.png">
<meta property="og:image" content="https://wanheiqiyihu.gitee.io/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220828162149341.png">
<meta property="og:image" content="https://wanheiqiyihu.gitee.io/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220828162321840.png">
<meta property="og:image" content="https://wanheiqiyihu.gitee.io/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220828170533205.png">
<meta property="og:image" content="https://wanheiqiyihu.gitee.io/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220828172043564.png">
<meta property="og:image" content="https://wanheiqiyihu.gitee.io/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220829141621485.png">
<meta property="og:image" content="https://wanheiqiyihu.gitee.io/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220829144838482.png">
<meta property="og:image" content="https://wanheiqiyihu.gitee.io/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220829150623976.png">
<meta property="og:image" content="https://wanheiqiyihu.gitee.io/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220829155633444.png">
<meta property="og:image" content="https://wanheiqiyihu.gitee.io/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220829155648037.png">
<meta property="og:image" content="https://wanheiqiyihu.gitee.io/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220829155656537.png">
<meta property="og:image" content="https://wanheiqiyihu.gitee.io/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220829155706905.png">
<meta property="article:published_time" content="2022-08-29T12:44:06.000Z">
<meta property="article:modified_time" content="2022-12-07T17:03:24.000Z">
<meta property="article:author" content="十三">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://wanheiqiyihu.gitee.io/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220824105406833.png">

<link rel="canonical" href="https://wanheiqiyihu.gitee.io/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-cn'
  };
</script>

  <title>php代码审计学习笔记1 | 十三の博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/wan1/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">十三の博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/wan1/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/wan1/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-ctf做题笔记">

    <a href="/wan1/categories/Experience" rel="section"><i class="download fa-fw"></i>CTF做题笔记</a>

  </li>
        <li class="menu-item menu-item-python">

    <a href="/wan1/categories/python" rel="section"><i class="download fa-fw"></i>python</a>

  </li>
        <li class="menu-item menu-item-java">

    <a href="/wan1/categories/java" rel="section"><i class="download fa-fw"></i>java</a>

  </li>
        <li class="menu-item menu-item-读书笔记">

    <a href="/wan1/categories/readbook" rel="section"><i class="download fa-fw"></i>读书笔记</a>

  </li>
        <li class="menu-item menu-item-渗透测试">

    <a href="/wan1/categories/penetration" rel="section"><i class="download fa-fw"></i>渗透测试</a>

  </li>
        <li class="menu-item menu-item-基础">

    <a href="/wan1/categories/basic" rel="section"><i class="download fa-fw"></i>基础</a>

  </li>
        <li class="menu-item menu-item-轮子">

    <a href="/wan1/categories/lunzi" rel="section"><i class="download fa-fw"></i>轮子</a>

  </li>
        <li class="menu-item menu-item-漏洞库">

    <a href="/wan1/categories/fuxian" rel="section"><i class="download fa-fw"></i>漏洞库</a>

  </li>
        <li class="menu-item menu-item-工具">

    <a href="/wan1/categories/tools" rel="section"><i class="download fa-fw"></i>工具</a>

  </li>
        <li class="menu-item menu-item-代码审计">

    <a href="/wan1/categories/daima" rel="section"><i class="download fa-fw"></i>代码审计</a>

  </li>
        <li class="menu-item menu-item-逆向">

    <a href="/wan1/categories/nixiang" rel="section"><i class="download fa-fw"></i>逆向</a>

  </li>
        <li class="menu-item menu-item-应急响应">

    <a href="/wan1/categories/yingji" rel="section"><i class="download fa-fw"></i>应急响应</a>

  </li>
        <li class="menu-item menu-item-免杀">

    <a href="/wan1/categories/miansha" rel="section"><i class="download fa-fw"></i>免杀</a>

  </li>
        <li class="menu-item menu-item-靶场">

    <a href="/wan1/categories/bachang" rel="section"><i class="download fa-fw"></i>靶场</a>

  </li>
        <li class="menu-item menu-item-cve申请">

    <a href="/wan1/categories/cve" rel="section"><i class="download fa-fw"></i>cve申请</a>

  </li>
        <li class="menu-item menu-item-c语言">

    <a href="/wan1/categories/c" rel="section"><i class="download fa-fw"></i>c语言</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-cn">
    <link itemprop="mainEntityOfPage" href="https://wanheiqiyihu.gitee.io/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/wan1/images/avatar.gif">
      <meta itemprop="name" content="十三">
      <meta itemprop="description" content="潜心学习，不骄不躁">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="十三の博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          php代码审计学习笔记1
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-08-29 20:44:06" itemprop="dateCreated datePublished" datetime="2022-08-29T20:44:06+08:00">2022-08-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-12-08 01:03:24" itemprop="dateModified" datetime="2022-12-08T01:03:24+08:00">2022-12-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/wan1/categories/daima/" itemprop="url" rel="index"><span itemprop="name">-daima</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="php代码审计学习笔记1"><a href="#php代码审计学习笔记1" class="headerlink" title="php代码审计学习笔记1"></a>php代码审计学习笔记1</h1><p>课程是某牛的，笔记只供个人学习</p>
<p>感觉就是从代码层面复习了一遍漏洞原理</p>
<h1 id="环境配置及审计工具介绍"><a href="#环境配置及审计工具介绍" class="headerlink" title="环境配置及审计工具介绍"></a>环境配置及审计工具介绍</h1><p>环境就用phpstudy</p>
<p>看代码的话我用的是notepad++</p>
<p>审计工具可以用seay源代码审计系统（基于正则</p>
<p>Fortify SCA也是一款不错的商业化代码审计工具（靠内置的规则空间匹配</p>
<p>rips审计工具也不错，可以看到用户输的一些点</p>
<p>以及一款数据库监控工具 vMysqlMonitoring.exe</p>
<p>审计靶场:VAuditDemo   ZVulDrill</p>
<h1 id="代码审计的思路及流程"><a href="#代码审计的思路及流程" class="headerlink" title="代码审计的思路及流程"></a>代码审计的思路及流程</h1><h2 id="MVC架构"><a href="#MVC架构" class="headerlink" title="MVC架构"></a>MVC架构</h2><p>MVC是一种设计创建Web程序的一种模式，其同时提供了HTML,CSS和JAVASCRIPT的完全控制。</p>
<p><img src="/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220824105406833.png" alt="image-20220824105406833"></p>
<p>MVC关系</p>
<p><img src="/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220824105546784.png" alt="image-20220824105546784"></p>
<h2 id="常见的php框架"><a href="#常见的php框架" class="headerlink" title="常见的php框架"></a>常见的php框架</h2><p><img src="/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220824105649145.png" alt="image-20220824105649145"></p>
<h2 id="审计思路"><a href="#审计思路" class="headerlink" title="审计思路"></a>审计思路</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MVC框架常见的一个处理流程</span><br><span class="line">获取请求 全剧过滤 模块文件 c函数内容 m函数内容 v显示</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">常见网站目录架构</span><br><span class="line">主目录</span><br><span class="line"></span><br><span class="line">模块目录</span><br><span class="line">插件目录</span><br><span class="line">上传目录</span><br><span class="line">模板目录</span><br><span class="line">数据目录</span><br><span class="line">配置目录</span><br><span class="line"></span><br><span class="line">配置文件</span><br><span class="line"></span><br><span class="line">公共函数的文件</span><br><span class="line">安全过滤的文件</span><br><span class="line"></span><br><span class="line">数据库结构</span><br><span class="line"></span><br><span class="line">入口文件</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">通读全文</span><br><span class="line">函数集文件，配置文件，安全过滤文件，index文件</span><br><span class="line">优点：了解程序的架构及业务逻辑，挖掘更高质的漏洞</span><br><span class="line">缺点：耗费时间多，工程较大</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">敏感关键字回溯参数</span><br><span class="line">优点：快速挖掘想要的漏洞，最常用的方法。</span><br><span class="line">缺点：覆盖不到逻辑漏洞的挖掘，不能了解程序的基本架构</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">查找可控变量</span><br><span class="line">可以用rips审计工具的查找用户输入功能</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">功能点定向审计</span><br><span class="line">程序安装，文件上传，文件管理，登录验证，备份恢复，找回密码</span><br></pre></td></tr></table></figure>

<h1 id="PHP核心配置详解"><a href="#PHP核心配置详解" class="headerlink" title="PHP核心配置详解"></a>PHP核心配置详解</h1><p>   PHP.INI配置文件也就是所谓的核心配置</p>
<p>下面是一些常亮</p>
<p><img src="/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220824183645573.png" alt="image-20220824183645573"></p>
<h2 id="基本配置-语法"><a href="#基本配置-语法" class="headerlink" title="基本配置-语法"></a>基本配置-语法</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">大小写敏感</span><br><span class="line">directive = value（指令 = 值）</span><br><span class="line">foo=bar ≠ FOO=bar</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">运算符</span><br><span class="line">|、&amp;、~、!</span><br></pre></td></tr></table></figure>

<p><img src="/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220824185643247.png" alt="image-20220824185643247"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">空值的表达方式</span><br><span class="line">foo =     ;</span><br><span class="line">foo = none;</span><br><span class="line">foo = &quot;none&quot;;这个就表示这么一个字符串了，而不是空值</span><br></pre></td></tr></table></figure>

<h2 id="基本配置-安全模式"><a href="#基本配置-安全模式" class="headerlink" title="基本配置-安全模式"></a>基本配置-安全模式</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">安全模式</span><br><span class="line">safe_mode = off</span><br><span class="line">安全模式，用来限制文档的存取、限制环境变量的存取，限制外部程序的执行。</span><br><span class="line">本特性已在PHP5.4.0被移除</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">限制环境变量存取</span><br><span class="line">safe_mode_allowed_env_vars = string</span><br><span class="line">指定php程序可以改变的环境变量的前缀，当这个选项的值为空时，那么php可以改变任何环境变量。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">外部程序执行目录</span><br><span class="line">safe_mode_exec_dir = &quot;E:\Local Test\WWW&quot;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">禁用函数</span><br><span class="line">disable_function</span><br><span class="line">为了更安全的运行php，可以用此指令来禁止一些敏感函数的使用，当你想用本指令禁止一些危险函数时，切忌把dl()函数也加到禁止的列表，攻击者可以利用dl()函数加载自定义的php扩展来突破disable_function。配置禁用函数时可以使用逗号分隔函数名。</span><br><span class="line">同理</span><br><span class="line">disable_classes是禁用类</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">com组件</span><br><span class="line">com.allow_dcom = false</span><br><span class="line">php设置在安全模式下，仍旧允许攻击者使用com()函数来创建系统组件来执行任意命令，我推荐关闭这个函数来防止出现此漏洞。</span><br><span class="line">使用COM()函数需要在php.ini中配置extension=php_com_dotnet.dll,如果php VERSION&lt;5.4.5则不需要</span><br></pre></td></tr></table></figure>

<h2 id="基本配置-控制变量"><a href="#基本配置-控制变量" class="headerlink" title="基本配置-控制变量"></a>基本配置-控制变量</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">全局变量注册开关</span><br><span class="line">register_globals = off</span><br><span class="line">php.ini的register_globals选项的默认值预设为off，在4.2版本之前是默认开启的，当register_globals的设定为On时，程序可以接受来自服务器的各种环境变量，包括表单提交的变量，这是对服务器来讲是不安全的，所以我们不能让它注册为全局变量。</span><br><span class="line">register_globals = off时，服务器端获取数据的时候用$_GET[&#x27;name&#x27;]来获取数据</span><br><span class="line">register_globals = On时，服务器使用POST或者GET提交的变量，都将自动使用全局变量的值来接受值。</span><br><span class="line">如下：</span><br><span class="line">开启这个开关之后，我们只要传入一个_SESSION[username]=aa，就可以doeverthing</span><br><span class="line">关掉之后，我们就不能获取权限了</span><br></pre></td></tr></table></figure>

<p><img src="/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220824194314976.png" alt="image-20220824194314976"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">魔术引号过滤</span><br><span class="line">magic_quotes_gpc = on  本特性已在PHP5.4.0已经移除</span><br><span class="line">magic_quotes_gpc = Off 在php.ini里面是默认关闭的，如果他打开后将自动把用户提交对sql的查询语句进行转换，如果设置成ON的话，php会吧所有的单引号，双引号，反斜杠和空字符加上反斜杠进行转义，他会影响HTTP请求的数据有(GET,POST,Cookies)，开启他会提高网站的安全性，当然，您也可以使用addslashes来转义提交的HTTP请求数据，或者用stripsashes来删除转义</span><br></pre></td></tr></table></figure>

<h2 id="基本配置-远程文件"><a href="#基本配置-远程文件" class="headerlink" title="基本配置-远程文件"></a>基本配置-远程文件</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">是否允许远程包含文件</span><br><span class="line">allow_url_include = off</span><br><span class="line">该配置为on的情况下，可以直接包含远程文件，若包含的变量为可控的情况下，可以直接控制变量来执行PHP代码</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">是否允许打开远程文件</span><br><span class="line">allow_url_open = on</span><br><span class="line">允许本地PHP文件通过调用URL重写来打开和关闭写权限，默认的封装协议提供的ftp和http协议来访问文件。</span><br></pre></td></tr></table></figure>

<h2 id="基本配置-目录权限"><a href="#基本配置-目录权限" class="headerlink" title="基本配置-目录权限"></a>基本配置-目录权限</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HTTP头部版本信息</span><br><span class="line">expose_php = off</span><br><span class="line">防止了通过http头部泄露的php版本信息</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">文件上传临时目录</span><br><span class="line">upload_tmp_dir = </span><br><span class="line">上传文件临时保存目录，如果不设置的话，则采用系统的临时目录</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">用户可访问目录</span><br><span class="line">open_basedir = E:\Local Test\WWW</span><br><span class="line">能够控制PHP脚本只能访问指定的目录，这样能够避免PHP脚本访问，不应该访问的文件，一定程度上限制了phpshell的危害 </span><br></pre></td></tr></table></figure>

<h2 id="基本配置-错误信息"><a href="#基本配置-错误信息" class="headerlink" title="基本配置-错误信息"></a>基本配置-错误信息</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">内部错误选项</span><br><span class="line">display_errors = on</span><br><span class="line">表明显示PHP脚本的内部错误，网站发布后便宜关闭PHP的错误回显，在调试的时候通常把PHP错误显示打开</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">错误报告级别</span><br><span class="line">error_reporting = E_ALL &amp; ~E_NOTICE</span><br><span class="line">这个设置的作用是将错误级别跳到最高，显示所有问题，方便排错。</span><br></pre></td></tr></table></figure>

<h1 id="代码调试"><a href="#代码调试" class="headerlink" title="代码调试"></a>代码调试</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">代码调试小技巧</span><br><span class="line"></span><br><span class="line">echo</span><br><span class="line">最简单的输出调试方法，一般用来输出变量值或者不确定执行到哪个分支。</span><br><span class="line"></span><br><span class="line">print_r（true为1，false为空）,var_dump,debug_zval_dump</span><br><span class="line">这个主要是输出变量的数据值，特别是数组和对象数据，一般我们在查看接口的返回值或者不确定的变量，都可以使用这个api，debug_zval_dump输出结果和var_dump类似，唯一增加的一个值是refcount，记录一个变量被引用了多少次</span><br><span class="line"></span><br><span class="line">debug_print_backtrace</span><br><span class="line">可以查看输出的调用栈信息</span><br><span class="line"></span><br><span class="line">exit()</span><br><span class="line">停止程序，无法运行后面代码</span><br></pre></td></tr></table></figure>

<h1 id="审计中涉及的超全局变量"><a href="#审计中涉及的超全局变量" class="headerlink" title="审计中涉及的超全局变量"></a>审计中涉及的超全局变量</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">全局变量：全局变量就是在函数外面定义的变量。不能在函数中直接使用。因为他的作用域不会到函数内部。所以在函数内部使用的时候常常看到类似global$a;</span><br><span class="line">超全局变量：超全局变量作用域在所有脚本都有效。注意，除了$_GET,$_POST,$_SERVER,$_COOKIE等之外的超全局变量保存在$GLOBALS数组中。</span><br></pre></td></tr></table></figure>

<h2 id="GLOBALOS"><a href="#GLOBALOS" class="headerlink" title="$GLOBALOS"></a>$GLOBALOS</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$name</span> = <span class="number">123</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$name</span> = <span class="number">456</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test();</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$name</span>;</span><br></pre></td></tr></table></figure>

<p>以上代码输出的是123</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$name</span> = <span class="number">123</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="variable">$name</span> = <span class="number">456</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test();</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$name</span>;</span><br></pre></td></tr></table></figure>

<p>这样就是输出的456，其中global起的是一个参数传递的作用。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$name</span> = <span class="number">123</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$GLOBALS</span>[name] = <span class="number">4567</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test();</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$name</span>;</span><br></pre></td></tr></table></figure>

<p>输出4567，变量的作用域设置的全局</p>
<h2 id="POST-和-GET"><a href="#POST-和-GET" class="headerlink" title="$_POST 和 $_GET"></a><code>$_POST</code> 和 <code>$_GET</code></h2><p>post是向服务器传送数据。将表单内各个字段与其内容放置在HTML HEADER内一起传送到ACTION属性所指的URL地址，用户看不到这个过程。</p>
<p>get是从服务器上获取数据，把参数数据队列加到提交表单的ACTION属性所指的URL中，值和表单内各个字段一一对应，在URL中可以看到</p>
<h2 id="REQUEST"><a href="#REQUEST" class="headerlink" title="$_REQUEST"></a>$_REQUEST</h2><p>request可以接受get和post的数据，但是比较慢，所以我们尽量不要使用request</p>
<h2 id="SERVER"><a href="#SERVER" class="headerlink" title="$_SERVER"></a>$_SERVER</h2><p>这种超全局变量保存关于报头，路径和脚本位置的信息等。</p>
<p>我整理了其中的参数，也方便以后查阅</p>
<p>可以var_dump下来看一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">$_SERVER[&#x27;PHP_SELF&#x27;] #当前正在执行脚本的文件名，与 document root相关。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;argv&#x27;] #传递给该脚本的参数。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;argc&#x27;] #包含传递给程序的命令行参数的个数（如果运行在命令行模式）。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;GATEWAY_INTERFACE&#x27;] #服务器使用的 CGI 规范的版本。例如，“CGI/1.1”。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;SERVER_NAME&#x27;] #当前运行脚本所在服务器主机的名称。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;SERVER_SOFTWARE&#x27;] #服务器标识的字串，在响应请求时的头部中给出。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;SERVER_PROTOCOL&#x27;] #请求页面时通信协议的名称和版本。例如，“HTTP/1.0”。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;REQUEST_METHOD&#x27;] #访问页面时的请求方法。例如：“GET”、“HEAD”，“POST”，“PUT”。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;QUERY_STRING&#x27;] #查询(query)的字符串。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;DOCUMENT_ROOT&#x27;] #当前运行脚本所在的文档根目录。在服务器配置文件中定义。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;HTTP_ACCEPT&#x27;] #当前请求的 Accept: 头部的内容。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;HTTP_ACCEPT_CHARSET&#x27;] #当前请求的 Accept-Charset: 头部的内容。例如：“iso-8859-1,*,utf-8”。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;HTTP_ACCEPT_ENCODING&#x27;] #当前请求的 Accept-Encoding: 头部的内容。例如：“gzip”。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;HTTP_ACCEPT_LANGUAGE&#x27;]#当前请求的 Accept-Language: 头部的内容。例如：“en”。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;HTTP_CONNECTION&#x27;] #当前请求的 Connection: 头部的内容。例如：“Keep-Alive”。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;HTTP_HOST&#x27;] #当前请求的 Host: 头部的内容。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;HTTP_REFERER&#x27;] #链接到当前页面的前一页面的 URL 地址。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;HTTP_USER_AGENT&#x27;] #当前请求的 User_Agent: 头部的内容。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;HTTPS&#x27;] — 如果通过https访问,则被设为一个非空的值(on)，否则返回off</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;REMOTE_ADDR&#x27;] #正在浏览当前页面用户的 IP 地址。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;REMOTE_HOST&#x27;] #正在浏览当前页面用户的主机名。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;REMOTE_PORT&#x27;] #用户连接到服务器时所使用的端口。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;SCRIPT_FILENAME&#x27;] #当前执行脚本的绝对路径名。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;SERVER_ADMIN&#x27;] #管理员信息</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;SERVER_PORT&#x27;] #服务器所使用的端口</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;SERVER_SIGNATURE&#x27;] #包含服务器版本和虚拟主机名的字符串。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;PATH_TRANSLATED&#x27;] #当前脚本所在文件系统（不是文档根目录）的基本路径。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;SCRIPT_NAME&#x27;] #包含当前脚本的路径。这在页面需要指向自己时非常有用。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;REQUEST_URI&#x27;] #访问此页面所需的 URI。例如，“/index.html”。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;PHP_AUTH_USER&#x27;] #当 PHP 运行在 Apache 模块方式下，并且正在使用 HTTP 认证功能，这个变量便是用户输入的用户名。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;PHP_AUTH_PW&#x27;] #当 PHP 运行在 Apache 模块方式下，并且正在使用 HTTP 认证功能，这个变量便是用户输入的密码。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;AUTH_TYPE&#x27;] #当 PHP 运行在 Apache 模块方式下，并且正在使用 HTTP 认证功能，这个变量便是认证的类型。</span><br></pre></td></tr></table></figure>

<h2 id="FILE"><a href="#FILE" class="headerlink" title="$_FILE"></a>$_FILE</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$_FILES数组内容如下: </span><br><span class="line">$_FILES[&#x27;myFile&#x27;][&#x27;name&#x27;] 客户端文件的原名称。 </span><br><span class="line">$_FILES[&#x27;myFile&#x27;][&#x27;type&#x27;] 文件的 MIME 类型，需要浏览器提供该信息的支持，例如&quot;image/gif&quot;。 </span><br><span class="line">$_FILES[&#x27;myFile&#x27;][&#x27;size&#x27;] 已上传文件的大小，单位为字节。 </span><br><span class="line">$_FILES[&#x27;myFile&#x27;][&#x27;tmp_name&#x27;] 文件被上传后在服务端储存的临时文件名，一般是系统默认。可以在php.ini的upload_tmp_dir 指定，但 用 putenv() 函数设置是不起作用的。 </span><br><span class="line">$_FILES[&#x27;myFile&#x27;][&#x27;error&#x27;] 和该文件上传相关的错误代码。[&#x27;error&#x27;] 是在 PHP 4.2.0 版本中增加的。下面是它的说明：(它们在PHP3.0以后成了常量) </span><br><span class="line">UPLOAD_ERR_OK </span><br><span class="line">值：0; 没有错误发生，文件上传成功。 </span><br><span class="line">UPLOAD_ERR_INI_SIZE </span><br><span class="line">值：1; 上传的文件超过了 php.ini 中 upload_max_filesize 选项限制的值。 </span><br><span class="line">UPLOAD_ERR_FORM_SIZE </span><br><span class="line">值：2; 上传文件的大小超过了 HTML 表单中 MAX_FILE_SIZE 选项指定的值。 </span><br><span class="line">UPLOAD_ERR_PARTIAL </span><br><span class="line">值：3; 文件只有部分被上传。 </span><br><span class="line">UPLOAD_ERR_NO_FILE </span><br><span class="line">值：4; 没有文件被上传。 </span><br><span class="line">值：5; 上传文件大小为0. </span><br></pre></td></tr></table></figure>

<h2 id="COOKIE"><a href="#COOKIE" class="headerlink" title="$_COOKIE"></a>$_COOKIE</h2><p>通过HTTPCookies方式传递给当前脚本的变量的数组</p>
<p>$HTTP_COOKIE_VARS和$_COOKIE是不同的变量，PHP处理他们的方式不同</p>
<p>$HTTP_COOKIE_VARS包含相同的信息（4.1.0已废弃）但它不是一个超全局变量</p>
<h2 id="SESSION"><a href="#SESSION" class="headerlink" title="$_SESSION"></a>$_SESSION</h2><p>是一个数值，其中的value值可以我们设置，类似cookie</p>
<h2 id="ENV"><a href="#ENV" class="headerlink" title="$_ENV"></a>$_ENV</h2><p>$_ENV包含服务器端环境变量的数组，可在PHP程序的任何地方直接访问</p>
<p>$_ENV只是被动的接收服务器端的环境碧昂量转换为数组元素。</p>
<h1 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h1><h2 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h2><p>数字型的注入，当输入的参数是整型时，则可认为是数字型注入。如年龄，id，页码，都可以是，而且不需要单引号进行闭合。</p>
<p>首先我们自己新建一个数据库来进行一个测试</p>
<p><img src="/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220826202223548.png" alt="image-20220826202223548"></p>
<p>这是一个名为test的数据库,以及一个user表</p>
<p>随后自己写一个查询页面</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"><span class="variable">$conn</span> = mysql_connect(<span class="string">&#x27;127.0.0.1&#x27;</span>,<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;root&#x27;</span>);<span class="comment">#建立一个连接，返回一个连接标识</span></span><br><span class="line">mysql_select_db(<span class="string">&#x27;test&#x27;</span>,<span class="variable">$conn</span>);<span class="comment">#选择数据库</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM USER WHERE id =<span class="subst">$id</span>&quot;</span>;</span><br><span class="line"><span class="variable">$result</span> = mysql_query(<span class="variable">$sql</span>) <span class="keyword">or</span> <span class="keyword">die</span>(mysql_error());<span class="comment">#执行一次sql查询</span></span><br><span class="line"><span class="keyword">while</span>(<span class="variable">$row</span> = mysql_fetch_array(<span class="variable">$result</span>)<span class="comment">#返回一个关联数组)&#123;</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;ID&#x27;</span>.<span class="variable">$row</span>[<span class="string">&#x27;id&#x27;</span>].<span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;USERNAME&#x27;</span>.<span class="variable">$row</span>[<span class="string">&#x27;username&#x27;</span>].<span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;PASSWORD&#x27;</span>.<span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>].<span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;PHONE&#x27;</span>.<span class="variable">$row</span>[<span class="string">&#x27;phone&#x27;</span>].<span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">mysql_close(<span class="variable">$conn</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$sql</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220826205026879.png" alt="image-20220826205026879"></p>
<p>可以看到就像是一个基础的sql注入靶场</p>
<p>or1=1就可以看到注入成功</p>
<p><img src="/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220826205517820.png" alt="image-20220826205517820"></p>
<h2 id="注入利用的方式"><a href="#注入利用的方式" class="headerlink" title="注入利用的方式"></a>注入利用的方式</h2><p>查询数据，读写文件，执行命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">写入webshell</span><br><span class="line">union select 1,2,3,十六进制编码的一句话 into outfile &#x27;C:/Localhost/WWW/3.php&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="登录处注入的例子"><a href="#登录处注入的例子" class="headerlink" title="登录处注入的例子"></a>登录处注入的例子</h2><p><code>login.html</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>login<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;login.php&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    账号：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;点击登录&quot;</span> <span class="attr">name</span>=<span class="string">&quot;login&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">form</span>&gt;</span>&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>login.php</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;login&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;fail&#x27;</span>;<span class="comment">#首先看是否有数据从那边传过来</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$username</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    <span class="variable">$password</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">    <span class="variable">$conn</span> = mysql_connect(<span class="string">&quot;127.0.0.1&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;root&quot;</span>);<span class="comment">#连接数据库</span></span><br><span class="line">    mysql_select_db(<span class="string">&quot;test&quot;</span>,<span class="variable">$conn</span>);<span class="comment">#选择数据库</span></span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;SELECT *FROM USER WHERE USERNAME=&#x27;&quot;</span>.<span class="variable">$username</span>.<span class="string">&quot;&#x27;&quot;</span>;<span class="comment">#拼接sql语句</span></span><br><span class="line">    <span class="variable">$result</span> = mysql_query(<span class="variable">$sql</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&#x27;执行失败&#x27;</span>.mysql_errno());<span class="comment">#执行sql语句</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="variable">$row</span> = mysql_fetch_array(<span class="variable">$result</span>))&#123;</span><br><span class="line">        <span class="variable">$db_username</span> = <span class="variable">$row</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">        <span class="variable">$db_password</span> = <span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">    &#125;<span class="comment">#拿到数据库的结果整理</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$db_password</span> == <span class="variable">$password</span> &amp;&amp; <span class="variable">$db_username</span> = <span class="variable">$username</span>)&#123;<span class="comment">#对比数据</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;成功&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;失败&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这里的用户名就存在万能密码注入，<code>or 1=1</code></p>
<h2 id="HTTP头注入"><a href="#HTTP头注入" class="headerlink" title="HTTP头注入"></a>HTTP头注入</h2><p><img src="/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827131024547.png" alt="image-20220827131024547"></p>
<h1 id="宽字节注入和二次注入"><a href="#宽字节注入和二次注入" class="headerlink" title="宽字节注入和二次注入"></a>宽字节注入和二次注入</h1><h2 id="宽字节注入"><a href="#宽字节注入" class="headerlink" title="宽字节注入"></a>宽字节注入</h2><p>intval()#是强制转换类型，强制将其中的内容转换成整型。常用于数字型</p>
<p>add#函数在指定的预定义<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%AD%97%E7%AC%A6/4768913">字符</a>前添加<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%8F%8D%E6%96%9C%E6%9D%A0/10132050">反斜杠</a>。这些字符是单引号（’）、双引号（”）、反斜线（\）与NUL（NULL字符）。</p>
<p>而宽字节注入的思路就是，单引号逃逸</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">因为%df的关系，\的编码%5c被吃掉了，也就失去了转义的效果，直接被带入到mysql中，然后mysql在解读时无视了%a0%5c形成的新字节，那么单引号便重新发挥了效果</span><br><span class="line"></span><br><span class="line">常见的宽字节编码：GB2312,GBK,GB18030,BIG5,Shift_JIS</span><br><span class="line"></span><br><span class="line">如果数据库使用的的是GBK编码而PHP编码为UTF8就可能出现注入问题，原因是程序员为了防止SQL注入，就会调用我们上面所介绍的几种函数，将单引号或双引号进行转义操作，转义无非便是在单或双引号前加上斜杠（\）进行转义 ，但这样并非安全，因为数据库使用的是宽字节编码，两个连在一起的字符会被当做是一个汉字，而在PHP使用的UTF8编码则认为是两个独立的字符，如果我们在单或双引号前添加一个字符，使其和斜杠（\）组合被当作一个汉字，从而保留单或双引号，使其发挥应用的作用。但添加的字符的Ascii要大于128，两个字符才能组合成汉字 ，因为前一个ascii码要大于128，才到汉字的范围 ，这一点需要注意。</span><br></pre></td></tr></table></figure>

<p><img src="/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827133732973.png" alt="image-20220827133732973"></p>
<h3 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h3><p>test.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$id</span> = addslashes(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>]);</span><br><span class="line"><span class="variable">$conn</span> = mysql_connect(<span class="string">&#x27;127.0.0.1:3306&#x27;</span>,<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;root&#x27;</span>);</span><br><span class="line">mysql_select_db(<span class="string">&#x27;test&#x27;</span>,<span class="variable">$conn</span>);</span><br><span class="line">mysql_query(<span class="string">&quot;SET NAMES &#x27;GBK&#x27;&quot;</span>);</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM user WHERE id = &#x27;<span class="subst">$id</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="variable">$result</span> = mysql_query(<span class="variable">$sql</span>) <span class="keyword">or</span> <span class="keyword">die</span>(mysql_error());</span><br><span class="line"><span class="keyword">while</span>(<span class="variable">$row</span> = mysql_fetch_array(<span class="variable">$result</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;ID&#x27;</span>.<span class="variable">$row</span>[<span class="string">&#x27;id&#x27;</span>].<span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;USERNAME&#x27;</span>.<span class="variable">$row</span>[<span class="string">&#x27;username&#x27;</span>].<span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;PASSWORD&#x27;</span>.<span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>].<span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;PHONE&#x27;</span>.<span class="variable">$row</span>[<span class="string">&#x27;phone&#x27;</span>].<span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">mysql_close(<span class="variable">$conn</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$sql</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827135455087.png" alt="image-20220827135455087"></p>
<p>成功宽字节注入（payload <code>1%20%df%27%20union%20select%201,database(),3,4%20--+</code></p>
<p>修复建议：</p>
<p>使用<code>mysql_ser_charset(GBK)</code>指定字符集</p>
<p>使用<code>mysql_real_escape_string</code>进行转义</p>
<h2 id="二次注入"><a href="#二次注入" class="headerlink" title="二次注入"></a>二次注入</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">二阶注入：</span><br><span class="line">1.攻击者在http请求中提交恶意输入(输入的时候过滤了，但是进入数据库的时候还原了)</span><br><span class="line">2.恶意输入保存在数据库中</span><br><span class="line">3.攻击者提交第二次http请求</span><br><span class="line">4.未处理第二次http请求，程序在检索存储在数据库中的恶意输入，构造sql语句</span><br><span class="line">5.如果攻击成功，在第二次请求响应中返回结果</span><br></pre></td></tr></table></figure>

<h3 id="demo-1"><a href="#demo-1" class="headerlink" title="demo"></a>demo</h3><p>reg.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$id</span> = addslashes(<span class="variable">$_POST</span>[<span class="string">&#x27;id&#x27;</span>]);</span><br><span class="line">    <span class="variable">$username</span> = addslashes(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]);</span><br><span class="line">    <span class="variable">$password</span> = addslashes(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]);</span><br><span class="line">    <span class="variable">$phone</span> = addslashes(<span class="variable">$_POST</span>[<span class="string">&#x27;phone&#x27;</span>]);</span><br><span class="line">    <span class="variable">$conn</span> = mysql_connect(<span class="string">&#x27;127.0.0.1&#x27;</span>,<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;root&#x27;</span>);</span><br><span class="line">    mysql_select_db(<span class="string">&#x27;test&#x27;</span>);</span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;INSERT INTO user(id,username,password,phone) VALUES(&#x27;<span class="subst">$id</span>&#x27;,&#x27;<span class="subst">$username</span>&#x27;,&#x27;<span class="subst">$password</span>&#x27;,&#x27;<span class="subst">$phone</span>&#x27;);&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = mysql_query(<span class="variable">$sql</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;失败&quot;</span>.mysql_error());</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$result</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;注册成功&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;注册失败&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;not&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;form action=<span class="string">&quot;reg.php&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">    id:&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;id&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">    username:&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;username&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">    password:&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;password&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">    phone:&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;phone&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> name=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;点击提交&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>search.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$id</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">    <span class="variable">$conn</span> = mysql_connect(<span class="string">&#x27;127.0.0.1&#x27;</span>,<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;root&#x27;</span>);</span><br><span class="line">    mysql_select_db(<span class="string">&#x27;test&#x27;</span>);</span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM user WHERE id=&quot;</span>.<span class="variable">$id</span>.<span class="string">&quot;;&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = mysql_query(<span class="variable">$sql</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;失败1&quot;</span>.mysql_error());</span><br><span class="line">    <span class="keyword">while</span>(<span class="variable">$row</span> = mysql_fetch_array(<span class="variable">$result</span>))&#123;</span><br><span class="line">        <span class="variable">$username</span> = <span class="variable">$row</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">        <span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM USER WHERE username=&#x27;&quot;</span>.<span class="variable">$username</span>.<span class="string">&quot;&#x27;;&quot;</span>;</span><br><span class="line">        <span class="variable">$result</span> = mysql_query(<span class="variable">$sql</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;失败2&quot;</span>.mysql_error());</span><br><span class="line">        <span class="keyword">while</span>(<span class="variable">$row</span> = mysql_fetch_array(<span class="variable">$result</span>))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;ID:&quot;</span>.<span class="variable">$row</span>[<span class="string">&#x27;id&#x27;</span>].<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;USERNAME:&quot;</span>.<span class="variable">$row</span>[<span class="string">&#x27;username&#x27;</span>].<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;PASSWORD:&quot;</span>.<span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>].<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;PHONE:&quot;</span>.<span class="variable">$row</span>[<span class="string">&#x27;phone&#x27;</span>].<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;form action=<span class="string">&quot;search.php&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">    search ID:&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;id&quot;</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> name=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;点击搜索&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>我们的payload就可以在username那里加上<code>&#39;union select 1,2,database(),4;#</code></p>
<p><img src="/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827151005452.png" alt="image-20220827151005452"></p>
<p>再查询0</p>
<p><img src="/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827151016017.png" alt="image-20220827151016017"></p>
<p>但是为什么感觉就是再讲漏洞原理啊喂(#`O′)</p>
<p>思路：先将注入语句插入到数据库，注册、留言板等功能都具有insert数据库的操作，然后再使用update的地方触发插入到数据库的注入语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE 表名称 SET 列名称 = 新值 WHERE 列名称 = 某值&#x27;union select ......#</span><br></pre></td></tr></table></figure>

<h1 id="代码执行漏洞"><a href="#代码执行漏洞" class="headerlink" title="代码执行漏洞"></a>代码执行漏洞</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">思路：</span><br><span class="line">用户能够控制函数输入</span><br><span class="line">存在可执行代码的危险函数</span><br></pre></td></tr></table></figure>

<p><img src="/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827151921288.png" alt="image-20220827151921288"></p>
<h2 id="常见的一些函数"><a href="#常见的一些函数" class="headerlink" title="常见的一些函数"></a>常见的一些函数</h2><p>eval()和assert()函数就不说了，直接把中间的参数当做php代码执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">回调函数：</span><br><span class="line">mixed call_user_func(callble $callback[,mixed $parameter[,mixed $...]])</span><br><span class="line">$callback是要调用自定义的函数名称</span><br><span class="line">$parameter是自定义函数的参数</span><br><span class="line">call_user_func — 把第一个参数作为回调函数调用 第二个参数当做回调函数的参数</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$b</span> = <span class="string">&quot;phpinfo()&quot;</span>;</span><br><span class="line">call_user_func(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>],<span class="variable">$b</span>);</span><br></pre></td></tr></table></figure>

<p><img src="/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827165236507.png" alt="image-20220827165236507"></p>
<p>常见的回调函数：</p>
<p>call_user_func(),call_user_func_array(),array_map()等</p>
<p>这里不全，后面我自己会补充。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">动态执行函数</span><br><span class="line">1.定义一个函数</span><br><span class="line">2.将函数名（字符串）赋值给一个变量</span><br><span class="line">3.使用变量名代替函数名调用动态执行函数</span><br><span class="line"></span><br><span class="line">$_GET[&#x27;a&#x27;]($_GET[&#x27;b&#x27;]);#简单例子</span><br><span class="line">感觉就和免杀才开始那种一样，a做函数名，b做函数参数。</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">preg_replace函数</span><br><span class="line"></span><br><span class="line">mixed preg_replace ( mixed $pattern , mixed $replacement , mixed $subject [, int $limit = -1 [, int &amp;$count ]] )</span><br><span class="line"></span><br><span class="line">搜索 subject 中匹配 pattern 的部分， 以 replacement 进行替换。</span><br></pre></td></tr></table></figure>

<p>一般$pattern是正则</p>
<p>$pattern存在/e模式修正符修饰 允许代码执行,下面是其他修正符的含义</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1、/g 表示该表达式将用来在输入字符串中查找所有可能的匹配，返回的结果可以是多个。如果不加/g最多只会匹配一个</span><br><span class="line">2、/i 表示匹配的时候不区分大小写，这个跟其它语言的正则用法相同</span><br><span class="line">3、/m 表示多行匹配。什么是多行匹配呢？就是匹配换行符两端的潜在匹配。影响正则中的^$符号</span><br><span class="line">4、/s 与/m相对，单行模式匹配。</span><br><span class="line">5、/e 可执行模式，此为PHP专有参数，例如preg_replace函数。</span><br><span class="line">6、/x 忽略空白模式。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">反向引用</span><br><span class="line"></span><br><span class="line">对一个正则表达式模式或部分模式 两边添加圆括号 将导致相关 匹配存储到一个临时缓冲区 中</span><br><span class="line">，所捕获的每个子匹配都按照在正则表达式模式中从左到右出现的顺序存储。缓冲区编号从 1 开始，</span><br><span class="line">最多可存储 99 个捕获的子表达式。每个缓冲区都可以使用 &#x27;\n&#x27; 访问，其中 n 为一个标识特定缓冲区的</span><br><span class="line">一位或两位十进制数。</span><br></pre></td></tr></table></figure>

<p>这里举一个简单的例子</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$cmd</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="variable">$str</span> = <span class="string">&#x27;&lt;php&gt;phpinfo()&lt;/php&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">preg_replace(<span class="string">&quot;/&lt;php&gt;(.*?)<span class="subst">$cmd</span>&quot;</span>,<span class="string">&quot;\\1&quot;</span>,<span class="variable">$str</span>);</span><br></pre></td></tr></table></figure>

<p>上面的意思大概就是，从str中匹配前面有<code>&lt;php&gt;</code>的后面条件自己设定的字符，用//1来进行替换,但是我们又是/e模式，执行了第二个语句，那么就成功rce。</p>
<p>我们这里的payload就可这样<code>&lt;\/php&gt;/e</code>因为如果有特殊符号要转义，所以前面有个斜杠，匹配成功之后，就会被//1引用，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">修复方案</span><br><span class="line">尽量不要执行外部的应用程序或命令</span><br><span class="line">使用自定义函数或函数库来代替外部应用程序或命令的应用</span><br><span class="line">使用escappeshellarg函数来处理命令的参数</span><br><span class="line">使用safe_mode_exec_dir来指定可执行的文件路径</span><br><span class="line">将执行函数的参数做白名单限制，在代码或配置文件中限制某些参数</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Reme_mber/article/details/124185032">(96条消息) php preg_replace /e 模式 漏洞分析_quan9i的博客-CSDN博客_preg_replace漏洞</a></p>
<p>这篇文章感觉不错，我搬运过来</p>
<h2 id="preg-replace详解"><a href="#preg-replace详解" class="headerlink" title="preg_replace详解"></a>preg_replace详解</h2><p>/e在php5.5的时候就被废弃</p>
<p>第一个案例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;&#125;</span><br><span class="line"><span class="keyword">echo</span> preg_replace(<span class="string">&quot;/s*(.*)s*/ies&quot;</span>, <span class="string">&quot;\\1&quot;</span>, <span class="variable">$_GET</span>[<span class="string">&quot;h&quot;</span>]);</span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>那么我们可以看出其大致含义就是匹配出的任意内容，都用()包含起来，作为子字符串，存在缓冲区，\1是访问括号内的内容，此时我们上面那个代码，我们就可以构造如下payload进行rce</p>
<p>对于payload中${}的解释，它这里其实是一个可变变量<br><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/language.variables.variable.php">https://www.php.net/manual/zh/language.variables.variable.php</a><br>我们输入了${phpinfo()}，那么它呢因为被括号包裹了，就会存进缓冲区，此时他是符合那个过滤函数的，所以要更替为第二个语句，而这里用到了/e，就相当于将第二个语句给执行了，就相当于eval(xx)，第二个语句也就是//1，而//1的含义是${phpinfo()},他这个时候总的语句呢就是eval(${phpinfo()}),这玩意就相当于变量里面套变量，所以我们需要先执行里面的，也就是${phpinfo()} 中的 phpinfo() 会被当做变量先执行，执行后，即变成 ${1} (phpinfo()成功执行返回true)，此时我们呢再执行这个eval${1},这玩意能正常执行出来，由于我们没有给1赋值，他会给个警告，但是没问题，不影响我们的语句，所以这个时候我们的rce就实现了</p>
<p>第二个案例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$data</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;data&#x27;</span>];</span><br><span class="line">preg_replace(<span class="string">&#x27;/&lt;data&gt;(.*)&lt;\/data&gt;/e&#x27;</span>,<span class="string">&#x27;$ret=&quot;\\1&quot;;&#x27;</span>,<span class="variable">$data</span>);</span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>payload如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?data=&lt;data&gt;$&#123;phpinfo()&#125;&lt;/data&gt;</span><br></pre></td></tr></table></figure>

<p>分析原因，此时括号内的内容是${phpinfo()}，传到了缓冲区，执行后面语句时会调用，那么后面语句此时就相当于$ret=${phpinfo()}，肯定会先执行phpinfo()，然后呢返回了1，此时语句是$ret=1，加上我们的/e是执行语句的，所以这里执行的就等同于eval($ret=1)；我们本地测试一下输出结果</p>
<p><img src="/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827183314670.png" alt="image-20220827183314670">所以，这就是执行报错的原因所在，有没有解决办法呢，当然有，再加个<code>&#123;&#125;</code>，此时执行结果如下</p>
<p><img src="/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827183326474.png" alt="image-20220827183326474"></p>
<p>这是为啥呢，我们不妨再来分析一下，此时存入缓冲区的是{${phpinfo()}}，此时由于\1是反向引用，再加上/e，实际的执行语句就是eval($ret={${phpinfo()}})执行过里面之后，得到的就是eval($ret={1}),而里面会当做变量来执行，也就是eval($ret=${1})，此时就执行出来了。</p>
<p>第三个案例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?</span></span><br><span class="line"><span class="meta">&lt;?</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">&#125;</span><br><span class="line">preg_replace(<span class="string">&quot;/s*(.*)s*/ies&quot;</span>, <span class="string">&quot;test(\\1)&quot;</span>, <span class="variable">$_GET</span>[<span class="string">&quot;h&quot;</span>]);</span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment">*eval(&quot;\$&#123;phpinfo()&#125;&quot;);</span></span><br><span class="line"><span class="comment">*eval(&quot;test(\&quot;&#123;\$&#123;phpinfo()&#125;&#125;\&quot;);&quot;);</span></span><br><span class="line"><span class="comment">*$&#123;phpinfo()&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>payload如下</p>
<p>?h=${phpinfo()}</p>
<p>此时执行的就是<code>eval(test($&#123;phpinfo()&#125;)</code>，，而后为<code>eval(test(1))</code>，里面那个是空的，所以执行结果为空，没有错误，可以正常执行</p>
<h2 id="一些正则"><a href="#一些正则" class="headerlink" title="一些正则"></a>一些正则</h2><p><img src="/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827170249923.png" alt="image-20220827170249923"></p>
<p><img src="/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827171538419.png" alt="image-20220827171538419"></p>
<p><img src="/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827180110497.png" alt="image-20220827180110497"></p>
<h1 id="命令执行漏洞"><a href="#命令执行漏洞" class="headerlink" title="命令执行漏洞"></a>命令执行漏洞</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">挖掘思路</span><br><span class="line">用户能够控制函数输入</span><br><span class="line">存在可执行代码的危险函数</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">类型</span><br><span class="line">代码层过滤不严</span><br><span class="line">系统的漏洞造成命令注入</span><br><span class="line">调用的第三方组件存在代码执行漏洞</span><br></pre></td></tr></table></figure>

<p><img src="/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827190243561.png" alt="image-20220827190243561"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">system函数 自带回显的，不用输出也可</span><br><span class="line">system(string $command, int &amp;$return_var = ?): string</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">passthru函数 也是自带回显</span><br><span class="line">passthru ( string $command [, int &amp;$return_var ] ) : void</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Exec函数  不自带回显</span><br><span class="line">exec ( string $command [, array &amp;$output [, int &amp;$return_var ]] )；</span><br><span class="line"></span><br><span class="line">$command：表示要执行的命令。</span><br><span class="line"></span><br><span class="line">$output:如果提供了 output 参数， 那么会用命令执行的输出填充此数组， 每行输出填充数组中的一个元素。 数组中的数据不包含行尾的空白字符，例如 \n 字符。 请注意，如果数组中已经包含了部分元素，exec() 函数会在数组末尾追加内容。如果你不想在数组末尾进行追加， 请在传入 exec() 函数之前 对数组使用 unset() 函数进行重置。</span><br><span class="line"></span><br><span class="line">$return_var:如果同时提供 output 和 return_var 参数， 命令执行后的返回状态会被写入到此变量。</span><br><span class="line"></span><br><span class="line">一般来说，我们只要写第一个参数，也就是$command。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">shell_exec函数  不自带回显的</span><br><span class="line">string shell_exec(string $cmd)</span><br><span class="line">$cmd 要执行的命令</span><br><span class="line">反引号``则调用此函数</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">过滤函数</span><br><span class="line">Escapeshellcmd()</span><br><span class="line">过滤整条命令</span><br><span class="line"></span><br><span class="line">Escapeshellarg()</span><br><span class="line">过滤整个参数</span><br></pre></td></tr></table></figure>

<h1 id="XSS漏洞"><a href="#XSS漏洞" class="headerlink" title="XSS漏洞"></a>XSS漏洞</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">挖掘思路</span><br><span class="line">没有过滤的参数，传入到输出函数中</span><br><span class="line">搜索内容，发表文章，留言，评论回复，资料设置</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">反射xss常见场景</span><br><span class="line">将前端获取的内容，直接输出到浏览器页面</span><br><span class="line">将前端获取的内容，直接输出到HTML标签</span><br><span class="line">将前端获取的内容，直接输出到&lt;script&gt;标签</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$content</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$content</span>;<span class="comment">//这就是没有过滤直接输出到浏览器的xss</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$content = $_GET[&#x27;content&#x27;];</span><br><span class="line">?&gt;</span><br><span class="line">&lt;input type=&quot;text&quot; value=&quot;&lt;?php echo $content;?&gt;&quot;&gt;</span><br><span class="line">//payload是 123?&gt;&quot;&gt;&lt;script&gt;alert(`xss`)&lt;/script&gt;#</span><br><span class="line">//闭合了标签</span><br></pre></td></tr></table></figure>

<p><img src="/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827201453222.png" alt="image-20220827201453222"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$content = $_GET[&#x27;content&#x27;];</span><br><span class="line">?&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    var xss = &#x27;&lt;?php echo $content?&gt;&#x27;;</span><br><span class="line">    document.write(xss);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">//payload是123%27;&lt;/script&gt;&lt;script&gt;alert(`xss`)&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>存储其实和反射差不多，只不过大多是存在数据库的，需要别人点击去触发。</p>
<p><img src="/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827203219636.png" alt="image-20220827203219636"></p>
<p>dom既可能是存储型，也可能是反射型</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$content = $_GET[&#x27;content&#x27;];</span><br><span class="line">?&gt;</span><br><span class="line">&lt;input type=&quot;text&quot; id=&quot;text&quot; value=&quot;&lt;?php echo $content;?&gt;&quot;&gt;</span><br><span class="line">&lt;dic id=&quot;print&quot;&gt;&lt;/dic&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">    var text = document.getElementById(&quot;text&quot;);</span><br><span class="line">    var print = document.getElementById(&quot;print&quot;);</span><br><span class="line">    print.innerHTML = text.value;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827210315089.png" alt="image-20220827210315089"></p>
<p><img src="/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827210740514.png" alt="image-20220827210740514"></p>
<h1 id="csrf漏洞"><a href="#csrf漏洞" class="headerlink" title="csrf漏洞"></a>csrf漏洞</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">挖掘思路</span><br><span class="line">后台功能模块：管理后台，会员中心，添加用户等</span><br><span class="line">被引用的核心文件里面没有验证token和referer相关的代码</span><br><span class="line"></span><br><span class="line">没带token:可以直接请求这个页面</span><br><span class="line">没带referer:返回相同的数据</span><br></pre></td></tr></table></figure>

<p>这个简单，我就不写代码了，就是后端只验证了session，但是没有验证origin或者referer等参数，或者没有加上csrftoken，导致这么一个漏洞。</p>
<h1 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">文件上传可控点</span><br><span class="line">content-length，即上传内容大小</span><br><span class="line">MAX_FILE_SIZE,即上传内容的最大长度</span><br><span class="line">filename,即上传文件名</span><br><span class="line">content-type，即上传文件内心</span><br><span class="line">请求保重的乱码字段，即上传文件的内容</span><br><span class="line">有可能存在请求包中的可控点还有上传路径，只是上面的示例中没有出现</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">挖掘思路</span><br><span class="line">上传点都调用同一个上传类，直接全局搜索上传函数</span><br><span class="line">黑盒寻找上传点，代码定位</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">代码案例</span><br><span class="line">name：客户端的原始上传文件名称</span><br><span class="line">Type：上传文件的MIME类型</span><br><span class="line">Tmp_name：服务器端用来保存上传文件的临时文件夹</span><br><span class="line">Error：上传文件时的错误信息</span><br><span class="line">Size：上传文件的大小，单位是</span><br></pre></td></tr></table></figure>

<p>upload.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">&quot;Content-type:text/html;charset=utf-8&quot;</span>);</span><br><span class="line"><span class="variable">$upload_dir</span> = <span class="string">&quot;D:\phpStudy\PHPTutorial\WWW\daima\upload&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$upload_name</span> = <span class="variable">$upload_dir</span>.<span class="string">&quot;\\&quot;</span>.<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">    move_uploaded_file(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>],<span class="variable">$upload_name</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Type:&quot;</span>.<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>].<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Size:&quot;</span>.<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;size&#x27;</span>]/<span class="number">1024</span> . <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Name&quot;</span>.<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>].<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;上传失败&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>upload.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;upload.php&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;上传文件&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;MAX_FILE_SIZE&quot;</span> <span class="attr">name</span>=<span class="string">&quot;4096&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>下面的绕过讲师只是提一下，后面我可能自己会总结</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">文件上传绕过-客户端</span><br><span class="line">用firebug将form表单中的onsubmit事件删除</span><br><span class="line">上传木马文件，burp拦截数据包，修改扩展名</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">文件上传绕过-服务端</span><br><span class="line">黑白名单过滤</span><br><span class="line">修改mime类型</span><br><span class="line">截断上传攻击</span><br><span class="line">.htaccess文件攻击</span><br><span class="line">解析漏洞，文件包含漏洞</span><br><span class="line">目录验证</span><br></pre></td></tr></table></figure>

<h1 id="目录穿越以及文件包含"><a href="#目录穿越以及文件包含" class="headerlink" title="目录穿越以及文件包含"></a>目录穿越以及文件包含</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    readfile(<span class="string">&#x27;&#x27;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220828162149341.png" alt="image-20220828162149341"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">目录穿越绕过方式</span><br><span class="line">进行url编码</span><br><span class="line">进行16位unicode编码</span><br><span class="line">进行双倍url编码</span><br><span class="line">进行超常utf-8 unicode编码</span><br></pre></td></tr></table></figure>

<p><img src="/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220828162321840.png" alt="image-20220828162321840"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">目录穿越修复方案</span><br><span class="line">在url中不要使用文件名称作为参数</span><br><span class="line">检查使用者输入的文件名是否有目录阶层字符</span><br><span class="line">在php.ini文件中设置open_basedir来指定文件的目录</span><br><span class="line">使用realpath函数来展开文件路径中的&quot;./&quot;、&quot;../&quot;等字符，然后返回绝对路径名称</span><br><span class="line">使用basename函数来返回不包含路径的文件名称</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">文件包含-挖掘经验</span><br><span class="line"></span><br><span class="line">模块加载，cache调用，传入的参数拼接包含路径</span><br><span class="line"></span><br><span class="line">include()</span><br><span class="line">使用此函数，只有代码执行到此函数时才将文件包含进来，发生错误时只警告并继续执行</span><br><span class="line"></span><br><span class="line">inclue_once()</span><br><span class="line">功能和前者一样，区别在于当重复调用同一文件时，程序只调用一次</span><br><span class="line"></span><br><span class="line">require()</span><br><span class="line">使用此函数，只要程序执行，立即调用此函数包含文件，发生错误时，会输出错误信息并立即终止程序。</span><br><span class="line"></span><br><span class="line">require_once()</span><br><span class="line">功能和前者一样，区别在于当重复调用同一文件时，程序只调用一次</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">远程包含</span><br><span class="line">RFI允许攻击者包含远程文件，远程文件包含需要设置allow_url_include = On 四个文件都支持HTTP、FTP等协议，相对本地文件包含更容易利用</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">本地包含-利用方式</span><br><span class="line">%00截断</span><br><span class="line"></span><br><span class="line">记录错误日志文件</span><br></pre></td></tr></table></figure>

<p>远程包含-利用方式</p>
<p><img src="/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220828170533205.png" alt="image-20220828170533205"></p>
<h1 id="任意文件读取及删除漏洞"><a href="#任意文件读取及删除漏洞" class="headerlink" title="任意文件读取及删除漏洞"></a>任意文件读取及删除漏洞</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">文件读取-挖掘经验</span><br><span class="line">allow_url_fopen选项激活了URL形式的fopen封装协议是的可以访问URL对象例如文件，默认的封装协议提供ftp和http协议来访问远程文件，一些扩展库例如zlib可以能会注册更多的封装协议</span><br><span class="line"></span><br><span class="line">fopen()</span><br><span class="line">file_get_contents()</span><br><span class="line">fread</span><br><span class="line">fgets</span><br><span class="line">fgetss</span><br><span class="line">file</span><br><span class="line">fpassthru</span><br><span class="line">parse_ini_file</span><br><span class="line">readfile</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">文件删除-挖掘经验</span><br><span class="line">unlink($file,$cont)</span><br></pre></td></tr></table></figure>

<h1 id="变量覆盖漏洞"><a href="#变量覆盖漏洞" class="headerlink" title="变量覆盖漏洞"></a>变量覆盖漏洞</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">漏洞危害</span><br><span class="line">比如说文件上传页面的白名单，我们可以覆盖白名单导致文件上传</span><br><span class="line">用户注册页面控制没覆盖的未初始化变量导致sql</span><br></pre></td></tr></table></figure>

<p><img src="/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220828172043564.png" alt="image-20220828172043564"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">常见的遍历方式释放代码，可能导致变量覆盖漏洞</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">foreach</span>(<span class="keyword">array</span>(<span class="string">&#x27;_COOKIE&#x27;</span>,<span class="string">&#x27;_POST&#x27;</span>,<span class="string">&#x27;_GET&#x27;</span>) <span class="keyword">as</span> <span class="variable">$_request</span>)&#123;</span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$$_request</span> <span class="keyword">as</span> <span class="variable">$_key</span> =&gt; <span class="variable">$_value</span>)&#123;</span><br><span class="line">        <span class="variable">$$_key</span> = addslashes(<span class="variable">$_value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">extract()变量覆盖</span><br><span class="line">int extract( $array , extract_rules,prefix )</span><br><span class="line">$array 关联的数组，受第二个和第三个参数的影响</span><br><span class="line">extract_rules  对待非法/数字和冲突的键名的方法将根据去除标记</span><br><span class="line">prefix  尽在第二个参数特殊时需要，添加前缀</span><br></pre></td></tr></table></figure>

<p><img src="/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220829141621485.png" alt="image-20220829141621485"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">parse_str()变量覆盖</span><br><span class="line">void parse_str(string $encoded_string [,array &amp;$result])</span><br><span class="line">incoded_string输入的字符串</span><br><span class="line">result 变量将会以数组元素的形式存入到这个数组，作为替代</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import_request_variables()</span><br><span class="line">（PHP 4&gt;= 4.1.0 , php5 &lt; 5.4.0）</span><br><span class="line">bool import_request_variables(string $types[,string $prefix])</span><br><span class="line">$type 指定需要导入的变量。可以用字母&#x27;G&#x27;,&#x27;P&#x27;,&#x27;C&#x27;来表示get，post，cookie</span><br><span class="line">$prefix 变量名前缀</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">修复方案</span><br><span class="line">在php.ini文件中设置register_globals=off</span><br><span class="line">使用原始变量数组，如$_POST,$_GET等数组变量进行操作</span><br><span class="line">不适用foreach语句来遍历$_GET变量，而改用[(index)]来指定</span><br><span class="line">验证变量是否存在，注册变量前先判断变量是否存在</span><br></pre></td></tr></table></figure>

<h1 id="反序列化漏洞"><a href="#反序列化漏洞" class="headerlink" title="反序列化漏洞"></a>反序列化漏洞</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">serialize()</span><br><span class="line">unserialize()</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">漏洞成因</span><br><span class="line">反序列化对象中存在魔术方法，而且魔术方法中的代码可以被控制，漏洞根据不同的代码可以导致各种攻击，如代码注入、sql注入、目录遍历等等</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">序列化的不同结果</span><br><span class="line">public</span><br><span class="line">private</span><br><span class="line">protect</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$test1</span> = <span class="string">&quot;dhk 2002&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$test2</span> = <span class="string">&quot;dhk 2002&quot;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$test3</span> = <span class="string">&quot;dhk 2002&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> test();</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="variable">$test</span>);</span><br></pre></td></tr></table></figure>

<p><img src="/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220829144838482.png" alt="image-20220829144838482"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">漏洞本质</span><br><span class="line">unserialize函数的变量可控</span><br><span class="line">php文件中存在可利用的类，类中有魔术方法</span><br></pre></td></tr></table></figure>

<p><img src="/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220829150623976.png" alt="image-20220829150623976"></p>
<h1 id="PHP弱类型"><a href="#PHP弱类型" class="headerlink" title="PHP弱类型"></a>PHP弱类型</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">变量类型</span><br><span class="line">标准类型：布尔boolen、整型integer、浮点floadt、字符string</span><br><span class="line">复杂类型：数组array、对象object</span><br><span class="line">特殊类型：资源resource</span><br></pre></td></tr></table></figure>

<p><img src="/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220829155633444.png" alt="image-20220829155633444"></p>
<p><img src="/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220829155648037.png" alt="image-20220829155648037"></p>
<p><img src="/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220829155656537.png" alt="image-20220829155656537"></p>
<p><img src="/wan1/wan1/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220829155706905.png" alt="image-20220829155706905"></p>
<h1 id="PHP伪协议"><a href="#PHP伪协议" class="headerlink" title="PHP伪协议"></a>PHP伪协议</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">file://协议</span><br><span class="line">用于访问本地系统文件</span><br><span class="line">allow_url_fopen:off/on</span><br><span class="line">allow_url_include:off/on</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">php://filter</span><br><span class="line">读取源代码并进行base64编码输出</span><br><span class="line">allow_url_fopen:off/on</span><br><span class="line">allow_url_include:off/on</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">php://input</span><br><span class="line">可以访问请求的原始数据的只读流</span><br><span class="line">allow_url_fopen:off/on</span><br><span class="line">allow_url_include:on</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">data://</span><br><span class="line">数据</span><br><span class="line">allow_url_fopen:on</span><br><span class="line">allow_url_include:on</span><br></pre></td></tr></table></figure>


    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/wan1/2022/08/23/vulnstack-%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA-%E4%BA%8C/" rel="prev" title="vulnstack 红日靶场 二">
      <i class="fa fa-chevron-left"></i> vulnstack 红日靶场 二
    </a></div>
      <div class="post-nav-item">
    <a href="/wan1/2022/09/05/%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01-%E6%9F%90%E7%88%B1%E6%8A%80%E6%9C%AF%E5%90%A7%E7%9A%84vip%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/" rel="next" title="逆向学习笔记1（某爱技术吧的vip基础教程">
      逆向学习笔记1（某爱技术吧的vip基础教程 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01"><span class="nav-number">1.</span> <span class="nav-text">php代码审计学习笔记1</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E5%8F%8A%E5%AE%A1%E8%AE%A1%E5%B7%A5%E5%85%B7%E4%BB%8B%E7%BB%8D"><span class="nav-number">2.</span> <span class="nav-text">环境配置及审计工具介绍</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%9A%84%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%B5%81%E7%A8%8B"><span class="nav-number">3.</span> <span class="nav-text">代码审计的思路及流程</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#MVC%E6%9E%B6%E6%9E%84"><span class="nav-number">3.1.</span> <span class="nav-text">MVC架构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84php%E6%A1%86%E6%9E%B6"><span class="nav-number">3.2.</span> <span class="nav-text">常见的php框架</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%A1%E8%AE%A1%E6%80%9D%E8%B7%AF"><span class="nav-number">3.3.</span> <span class="nav-text">审计思路</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#PHP%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3"><span class="nav-number">4.</span> <span class="nav-text">PHP核心配置详解</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE-%E8%AF%AD%E6%B3%95"><span class="nav-number">4.1.</span> <span class="nav-text">基本配置-语法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE-%E5%AE%89%E5%85%A8%E6%A8%A1%E5%BC%8F"><span class="nav-number">4.2.</span> <span class="nav-text">基本配置-安全模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE-%E6%8E%A7%E5%88%B6%E5%8F%98%E9%87%8F"><span class="nav-number">4.3.</span> <span class="nav-text">基本配置-控制变量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE-%E8%BF%9C%E7%A8%8B%E6%96%87%E4%BB%B6"><span class="nav-number">4.4.</span> <span class="nav-text">基本配置-远程文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE-%E7%9B%AE%E5%BD%95%E6%9D%83%E9%99%90"><span class="nav-number">4.5.</span> <span class="nav-text">基本配置-目录权限</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE-%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF"><span class="nav-number">4.6.</span> <span class="nav-text">基本配置-错误信息</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E8%B0%83%E8%AF%95"><span class="nav-number">5.</span> <span class="nav-text">代码调试</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%A1%E8%AE%A1%E4%B8%AD%E6%B6%89%E5%8F%8A%E7%9A%84%E8%B6%85%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F"><span class="nav-number">6.</span> <span class="nav-text">审计中涉及的超全局变量</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#GLOBALOS"><span class="nav-number">6.1.</span> <span class="nav-text">$GLOBALOS</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#POST-%E5%92%8C-GET"><span class="nav-number">6.2.</span> <span class="nav-text">$_POST 和 $_GET</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#REQUEST"><span class="nav-number">6.3.</span> <span class="nav-text">$_REQUEST</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SERVER"><span class="nav-number">6.4.</span> <span class="nav-text">$_SERVER</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#FILE"><span class="nav-number">6.5.</span> <span class="nav-text">$_FILE</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#COOKIE"><span class="nav-number">6.6.</span> <span class="nav-text">$_COOKIE</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SESSION"><span class="nav-number">6.7.</span> <span class="nav-text">$_SESSION</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ENV"><span class="nav-number">6.8.</span> <span class="nav-text">$_ENV</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SQL%E6%B3%A8%E5%85%A5"><span class="nav-number">7.</span> <span class="nav-text">SQL注入</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80"><span class="nav-number">7.1.</span> <span class="nav-text">基础</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B3%A8%E5%85%A5%E5%88%A9%E7%94%A8%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="nav-number">7.2.</span> <span class="nav-text">注入利用的方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%99%BB%E5%BD%95%E5%A4%84%E6%B3%A8%E5%85%A5%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="nav-number">7.3.</span> <span class="nav-text">登录处注入的例子</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HTTP%E5%A4%B4%E6%B3%A8%E5%85%A5"><span class="nav-number">7.4.</span> <span class="nav-text">HTTP头注入</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5%E5%92%8C%E4%BA%8C%E6%AC%A1%E6%B3%A8%E5%85%A5"><span class="nav-number">8.</span> <span class="nav-text">宽字节注入和二次注入</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5"><span class="nav-number">8.1.</span> <span class="nav-text">宽字节注入</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#demo"><span class="nav-number">8.1.1.</span> <span class="nav-text">demo</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E6%AC%A1%E6%B3%A8%E5%85%A5"><span class="nav-number">8.2.</span> <span class="nav-text">二次注入</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#demo-1"><span class="nav-number">8.2.1.</span> <span class="nav-text">demo</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E"><span class="nav-number">9.</span> <span class="nav-text">代码执行漏洞</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E4%B8%80%E4%BA%9B%E5%87%BD%E6%95%B0"><span class="nav-number">9.1.</span> <span class="nav-text">常见的一些函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#preg-replace%E8%AF%A6%E8%A7%A3"><span class="nav-number">9.2.</span> <span class="nav-text">preg_replace详解</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E4%BA%9B%E6%AD%A3%E5%88%99"><span class="nav-number">9.3.</span> <span class="nav-text">一些正则</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E"><span class="nav-number">10.</span> <span class="nav-text">命令执行漏洞</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#XSS%E6%BC%8F%E6%B4%9E"><span class="nav-number">11.</span> <span class="nav-text">XSS漏洞</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#csrf%E6%BC%8F%E6%B4%9E"><span class="nav-number">12.</span> <span class="nav-text">csrf漏洞</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="nav-number">13.</span> <span class="nav-text">文件上传</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%9B%AE%E5%BD%95%E7%A9%BF%E8%B6%8A%E4%BB%A5%E5%8F%8A%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="nav-number">14.</span> <span class="nav-text">目录穿越以及文件包含</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E5%8F%8A%E5%88%A0%E9%99%A4%E6%BC%8F%E6%B4%9E"><span class="nav-number">15.</span> <span class="nav-text">任意文件读取及删除漏洞</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96%E6%BC%8F%E6%B4%9E"><span class="nav-number">16.</span> <span class="nav-text">变量覆盖漏洞</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E"><span class="nav-number">17.</span> <span class="nav-text">反序列化漏洞</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#PHP%E5%BC%B1%E7%B1%BB%E5%9E%8B"><span class="nav-number">18.</span> <span class="nav-text">PHP弱类型</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#PHP%E4%BC%AA%E5%8D%8F%E8%AE%AE"><span class="nav-number">19.</span> <span class="nav-text">PHP伪协议</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="十三"
      src="/wan1/images/avatar.gif">
  <p class="site-author-name" itemprop="name">十三</p>
  <div class="site-description" itemprop="description">潜心学习，不骄不躁</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/wan1/archives/">
        
          <span class="site-state-item-count">172</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">十三</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/wan1/lib/anime.min.js"></script>
  <script src="/wan1/lib/velocity/velocity.min.js"></script>
  <script src="/wan1/lib/velocity/velocity.ui.min.js"></script>

<script src="/wan1/js/utils.js"></script>

<script src="/wan1/js/motion.js"></script>


<script src="/wan1/js/schemes/pisces.js"></script>


<script src="/wan1/js/next-boot.js"></script>




  




  
<script src="/wan1/js/local-search.js"></script>













  

  

<script src="/wan1/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginModelPath":"assets/","model":{"jsonPath":"live2d-widget-model-tsumiki"},"display":{"position":"right","width":300,"height":600},"mobile":{"show":true},"log":false,"pluginJsPath":"lib/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/clicklove.js"></script>
