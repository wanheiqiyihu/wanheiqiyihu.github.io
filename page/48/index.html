<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"wanheiqiyihu.top","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="潜心学习，不骄不躁">
<meta property="og:type" content="website">
<meta property="og:title" content="十三の博客">
<meta property="og:url" content="https://wanheiqiyihu.top/page/48/index.html">
<meta property="og:site_name" content="十三の博客">
<meta property="og:description" content="潜心学习，不骄不躁">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="十三">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://wanheiqiyihu.top/page/48/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-cn'
  };
</script>

  <title>十三の博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">十三の博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-ctf做题笔记">

    <a href="/categories/Experience" rel="section"><i class="download fa-fw"></i>CTF做题笔记</a>

  </li>
        <li class="menu-item menu-item-python">

    <a href="/categories/python" rel="section"><i class="download fa-fw"></i>python</a>

  </li>
        <li class="menu-item menu-item-java">

    <a href="/categories/java" rel="section"><i class="download fa-fw"></i>java</a>

  </li>
        <li class="menu-item menu-item-读书笔记">

    <a href="/categories/readbook" rel="section"><i class="download fa-fw"></i>读书笔记</a>

  </li>
        <li class="menu-item menu-item-渗透测试">

    <a href="/categories/penetration" rel="section"><i class="download fa-fw"></i>渗透测试</a>

  </li>
        <li class="menu-item menu-item-基础">

    <a href="/categories/basic" rel="section"><i class="download fa-fw"></i>基础</a>

  </li>
        <li class="menu-item menu-item-轮子">

    <a href="/categories/lunzi" rel="section"><i class="download fa-fw"></i>轮子</a>

  </li>
        <li class="menu-item menu-item-漏洞库">

    <a href="/categories/fuxian" rel="section"><i class="download fa-fw"></i>漏洞库</a>

  </li>
        <li class="menu-item menu-item-工具">

    <a href="/categories/tools" rel="section"><i class="download fa-fw"></i>工具</a>

  </li>
        <li class="menu-item menu-item-代码审计">

    <a href="/categories/daima" rel="section"><i class="download fa-fw"></i>代码审计</a>

  </li>
        <li class="menu-item menu-item-逆向">

    <a href="/categories/nixiang" rel="section"><i class="download fa-fw"></i>逆向</a>

  </li>
        <li class="menu-item menu-item-应急响应">

    <a href="/categories/yingji" rel="section"><i class="download fa-fw"></i>应急响应</a>

  </li>
        <li class="menu-item menu-item-免杀">

    <a href="/categories/miansha" rel="section"><i class="download fa-fw"></i>免杀</a>

  </li>
        <li class="menu-item menu-item-靶场">

    <a href="/categories/bachang" rel="section"><i class="download fa-fw"></i>靶场</a>

  </li>
        <li class="menu-item menu-item-cve申请">

    <a href="/categories/cve" rel="section"><i class="download fa-fw"></i>cve申请</a>

  </li>
        <li class="menu-item menu-item-c语言">

    <a href="/categories/c" rel="section"><i class="download fa-fw"></i>c语言</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-cn">
    <link itemprop="mainEntityOfPage" href="https://wanheiqiyihu.top/2022/01/15/BUUCTF-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AD%BE%E5%88%B0%E9%A2%98-%E5%86%85%E6%9C%89sql-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E5%86%85%E8%81%94/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="十三">
      <meta itemprop="description" content="潜心学习，不骄不躁">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="十三の博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/15/BUUCTF-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AD%BE%E5%88%B0%E9%A2%98-%E5%86%85%E6%9C%89sql-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E5%86%85%E8%81%94/" class="post-title-link" itemprop="url">BUUCTF 的一些签到题 内有sql 命令执行(内联)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-01-15 16:48:00 / 修改时间：16:53:18" itemprop="dateCreated datePublished" datetime="2022-01-15T16:48:00+08:00">2022-01-15</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Experience/" itemprop="url" rel="index"><span itemprop="name">-Experience</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="BUUCTF-的一些签到题-内有sql-命令执行"><a href="#BUUCTF-的一些签到题-内有sql-命令执行" class="headerlink" title="BUUCTF 的一些签到题 内有sql 命令执行"></a>BUUCTF 的一些签到题 内有sql 命令执行</h1><h2 id="第一题-easy-sql"><a href="#第一题-easy-sql" class="headerlink" title="第一题 easy sql"></a>第一题 easy sql</h2><p><img src="/2022/01/15/BUUCTF-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AD%BE%E5%88%B0%E9%A2%98-%E5%86%85%E6%9C%89sql-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E5%86%85%E8%81%94/image-20220115110256458.png" alt="image-20220115110256458"></p>
<p>直接在admin那里用’’ or 1=1#</p>
<p>密码那也可以’’ or 1=1#  记得#要用%23</p>
<p><img src="/2022/01/15/BUUCTF-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AD%BE%E5%88%B0%E9%A2%98-%E5%86%85%E6%9C%89sql-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E5%86%85%E8%81%94/image-20220115110523694.png" alt="image-20220115110523694"></p>
<h2 id="第二题-php-代码审计"><a href="#第二题-php-代码审计" class="headerlink" title="第二题 php 代码审计"></a>第二题 php 代码审计</h2><p>打开看源代码发现提示</p>
<p><img src="/2022/01/15/BUUCTF-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AD%BE%E5%88%B0%E9%A2%98-%E5%86%85%E6%9C%89sql-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E5%86%85%E8%81%94/image-20220115110631989.png" alt="image-20220115110631989"></p>
<p>打开提示得到一串源码</p>
<p><img src="/2022/01/15/BUUCTF-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AD%BE%E5%88%B0%E9%A2%98-%E5%86%85%E6%9C%89sql-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E5%86%85%E8%81%94/image-20220115110716784.png" alt="image-20220115110716784"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">emmm</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">checkFile</span>(<span class="params">&amp;<span class="variable">$page</span></span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="comment">//白名单列表</span></span><br><span class="line">            <span class="variable">$whitelist</span> = [<span class="string">&quot;source&quot;</span>=&gt;<span class="string">&quot;source.php&quot;</span>,<span class="string">&quot;hint&quot;</span>=&gt;<span class="string">&quot;hint.php&quot;</span>];</span><br><span class="line">            <span class="comment">//isset()判断变量是否声明is_string()判断变量是否是字符串 &amp;&amp;用了逻辑与两个值都为真才执行if里面的值</span></span><br><span class="line">            <span class="keyword">if</span> (! <span class="keyword">isset</span>(<span class="variable">$page</span>) || !is_string(<span class="variable">$page</span>)) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it A&quot;</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//检测传进来的值是否匹配白名单列表$whitelist 如果有则执行真</span></span><br><span class="line">            <span class="keyword">if</span> (in_array(<span class="variable">$page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//过滤问号的函数(如果$page的值有？则从?之前提取字符串)</span></span><br><span class="line">            <span class="variable">$_page</span> = mb_substr(</span><br><span class="line">                <span class="variable">$page</span>,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                mb_strpos(<span class="variable">$page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)<span class="comment">//返回$page.?里卖弄?号出现的第一个位置</span></span><br><span class="line">            );</span><br><span class="line"></span><br><span class="line">             <span class="comment">//第二次检测传进来的值是否匹配白名单列表$whitelist 如果有则执行真</span></span><br><span class="line">            <span class="keyword">if</span> (in_array(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//url对$page解码</span></span><br><span class="line">            <span class="variable">$_page</span> = urldecode(<span class="variable">$page</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//第二次过滤问号的函数(如果$page的值有？则从?之前提取字符串)</span></span><br><span class="line">            <span class="variable">$_page</span> = mb_substr(</span><br><span class="line">                <span class="variable">$_page</span>,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                mb_strpos(<span class="variable">$_page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="comment">//第三次检测传进来的值是否匹配白名单列表$whitelist 如果有则执行真</span></span><br><span class="line">            <span class="keyword">if</span> (in_array(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>在源码中发现了一个hint.php去看一下</p>
<p><img src="/2022/01/15/BUUCTF-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AD%BE%E5%88%B0%E9%A2%98-%E5%86%85%E6%9C%89sql-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E5%86%85%E8%81%94/image-20220115111610174.png" alt="image-20220115111610174"></p>
<p>得到提示</p>
<p>根据我们的审计，首先我们要传参file，是字符串类型，然后让函数checkfile返回为真。</p>
<p>hint.php?../../../../../ffffllllaaaagggg 我们可以想象他传入checkFile函数要经历 第一次白名单验证 一次？过滤后他就是hint.php 再进行一次白名单验证 返回为真 则达成条件进行包含得到flag</p>
<p><img src="/2022/01/15/BUUCTF-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AD%BE%E5%88%B0%E9%A2%98-%E5%86%85%E6%9C%89sql-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E5%86%85%E8%81%94/image-20220115113729499.png" alt="image-20220115113729499"></p>
<h2 id="第三题-简单小题"><a href="#第三题-简单小题" class="headerlink" title="第三题 简单小题"></a>第三题 简单小题</h2><p>在源代码中有个注释</p>
<p><img src="/2022/01/15/BUUCTF-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AD%BE%E5%88%B0%E9%A2%98-%E5%86%85%E6%9C%89sql-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E5%86%85%E8%81%94/image-20220115113908245.png" alt="image-20220115113908245"></p>
<p>传参cat=dog得到flag</p>
<p><img src="/2022/01/15/BUUCTF-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AD%BE%E5%88%B0%E9%A2%98-%E5%86%85%E6%9C%89sql-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E5%86%85%E8%81%94/image-20220115113926285.png" alt="image-20220115113926285"></p>
<h2 id="第四题-文件包含伪协议"><a href="#第四题-文件包含伪协议" class="headerlink" title="第四题 文件包含伪协议"></a>第四题 文件包含伪协议</h2><p>先查一下伪协议的使用 有点忘了</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_45588247/article/details/119348342">(32条消息) 【文件包含漏洞】——文件包含漏洞进阶_PHP伪协议_剑客 getshell的博客-CSDN博客</a></p>
<p><img src="/2022/01/15/BUUCTF-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AD%BE%E5%88%B0%E9%A2%98-%E5%86%85%E6%9C%89sql-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E5%86%85%E8%81%94/image-20220115114717651.png" alt="image-20220115114717651"></p>
<p>打开题目是这样的</p>
<p>然后就用?file=php://filter/read=convert.base64-encode/resource=./flag.php</p>
<p><img src="/2022/01/15/BUUCTF-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AD%BE%E5%88%B0%E9%A2%98-%E5%86%85%E6%9C%89sql-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E5%86%85%E8%81%94/image-20220115114822119.png" alt="image-20220115114822119"></p>
<p>然后就base64解密</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Can you find out the flag?&quot;</span>;</span><br><span class="line"><span class="comment">//flag&#123;8888b971-6d8f-4507-892a-eddd64932264&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="第五题-强网杯随便注-经典题目了"><a href="#第五题-强网杯随便注-经典题目了" class="headerlink" title="第五题 强网杯随便注 经典题目了"></a>第五题 强网杯随便注 经典题目了</h2><p><img src="/2022/01/15/BUUCTF-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AD%BE%E5%88%B0%E9%A2%98-%E5%86%85%E6%9C%89sql-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E5%86%85%E8%81%94/image-20220115115110263.png" alt="image-20220115115110263"></p>
<p>堆叠注入</p>
<p>然后预处理和大小写绕过selct与prepare，set</p>
<p><img src="/2022/01/15/BUUCTF-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AD%BE%E5%88%B0%E9%A2%98-%E5%86%85%E6%9C%89sql-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E5%86%85%E8%81%94/image-20220115121839028.png" alt="image-20220115121839028"></p>
<h2 id="第六题-sql注入"><a href="#第六题-sql注入" class="headerlink" title="第六题 sql注入"></a>第六题 sql注入</h2><p><img src="/2022/01/15/BUUCTF-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AD%BE%E5%88%B0%E9%A2%98-%E5%86%85%E6%9C%89sql-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E5%86%85%E8%81%94/image-20220115122524341.png" alt="image-20220115122524341"></p>
<p>输入1有回显，试了下堆叠注入。</p>
<p><img src="/2022/01/15/BUUCTF-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AD%BE%E5%88%B0%E9%A2%98-%E5%86%85%E6%9C%89sql-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E5%86%85%E8%81%94/image-20220115122558307.png" alt="image-20220115122558307"></p>
<p><img src="/2022/01/15/BUUCTF-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AD%BE%E5%88%B0%E9%A2%98-%E5%86%85%E6%9C%89sql-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E5%86%85%E8%81%94/image-20220115122647147.png" alt="image-20220115122647147"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">但是要用select的时候返回了nonono，说明select关键字又被过滤了，那再试一下预处理。</span><br><span class="line"></span><br><span class="line">也不行，麻了，我是真的菜狗啊。</span><br></pre></td></tr></table></figure>

<p>然后就去看别人的wp</p>
<p>(≧∇≦)ﾉ顺便偷了个葵花宝典</p>
<p><img src="/2022/01/15/BUUCTF-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AD%BE%E5%88%B0%E9%A2%98-%E5%86%85%E6%9C%89sql-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E5%86%85%E8%81%94/1658967-20200622120028704-1362680601.png" alt="img"></p>
<p>别人的wp：</p>
<p>这道题目需要我们去对后端语句进行猜测，有点矛盾的地方在于其描述的功能和实际的功能似乎并不相符，通过输入非零数字得到的回显1和输入其余字符得不到回显来判断出内部的查询语句可能存在有||，也就是select 输入的数据||内置的一个列名 from 表名，进一步进行猜测即为select post进去的数据||flag from Flag(含有数据的表名，通过堆叠注入可知)，需要注意的是，此时的||起到的作用是or的作用</p>
<p>解法1</p>
<p>输入的内容为*,1</p>
<p>内置的sql语句为sql=”select”.sql=”select”.post[‘query’].”||flag from Flag”;</p>
<p>如果$post[‘query’]的数据为*,1，sql语句就变成了select *,1||flag from Flag，也就是select *,1 from Flag，也就是直接查询出了Flag表中的所有内容</p>
<p>解法2</p>
<p>输入的内容为1;set sql_mode=pipes_as_concat;select 1</p>
<p>其中set sql_mode=pipes_as_concat的作用是将||的作用由or变为拼接字符串</p>
<h2 id="第七题-命令执行漏洞"><a href="#第七题-命令执行漏洞" class="headerlink" title="第七题 命令执行漏洞"></a>第七题 命令执行漏洞</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/happystudyhuan/p/11458455.html">命令执行漏洞 - 再简单一点点 - 博客园 (cnblogs.com)</a></p>
<p><img src="/2022/01/15/BUUCTF-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AD%BE%E5%88%B0%E9%A2%98-%E5%86%85%E6%9C%89sql-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E5%86%85%E8%81%94/image-20220115143436249.png" alt="image-20220115143436249"></p>
<h2 id="第八题-伪协议"><a href="#第八题-伪协议" class="headerlink" title="第八题 伪协议"></a>第八题 伪协议</h2><p>在源码中发现了一个文件，前去看看</p>
<p><img src="/2022/01/15/BUUCTF-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AD%BE%E5%88%B0%E9%A2%98-%E5%86%85%E6%9C%89sql-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E5%86%85%E8%81%94/BUUCTF-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AD%BE%E5%88%B0%E9%A2%98-%E5%86%85%E6%9C%89sql-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E5%86%85%E8%81%94%5Cimage-20220115144300054.png" alt="image-20220115144300054"></p>
<p><img src="/2022/01/15/BUUCTF-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AD%BE%E5%88%B0%E9%A2%98-%E5%86%85%E6%9C%89sql-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E5%86%85%E8%81%94/image-20220115145927816.png" alt="image-20220115145927816"></p>
<p>抓包发现新东西</p>
<p><img src="/2022/01/15/BUUCTF-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AD%BE%E5%88%B0%E9%A2%98-%E5%86%85%E6%9C%89sql-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E5%86%85%E8%81%94/image-20220115145958610.png" alt="image-20220115145958610"></p>
<p>开始代码审计</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;title&gt;secret&lt;/title&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    error_reporting(<span class="number">0</span>);</span><br><span class="line">    <span class="variable">$file</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(strstr(<span class="variable">$file</span>,<span class="string">&quot;../&quot;</span>)||stristr(<span class="variable">$file</span>, <span class="string">&quot;tp&quot;</span>)||stristr(<span class="variable">$file</span>,<span class="string">&quot;input&quot;</span>)||stristr(<span class="variable">$file</span>,<span class="string">&quot;data&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Oh no!&quot;</span>;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>); </span><br><span class="line"><span class="comment">//flag放在了flag.php里</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>简单，继续用伪协议</p>
<p><img src="/2022/01/15/BUUCTF-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AD%BE%E5%88%B0%E9%A2%98-%E5%86%85%E6%9C%89sql-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E5%86%85%E8%81%94/image-20220115150131652.png" alt="image-20220115150131652"></p>
<p>base解密</p>
<p><img src="/2022/01/15/BUUCTF-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AD%BE%E5%88%B0%E9%A2%98-%E5%86%85%E6%9C%89sql-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E5%86%85%E8%81%94/image-20220115150207094.png" alt="image-20220115150207094"></p>
<h2 id="第九题-sql注入"><a href="#第九题-sql注入" class="headerlink" title="第九题 sql注入"></a>第九题 sql注入</h2><p><img src="/2022/01/15/BUUCTF-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AD%BE%E5%88%B0%E9%A2%98-%E5%86%85%E6%9C%89sql-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E5%86%85%E8%81%94/image-20220115150411281.png" alt="image-20220115150411281"></p>
<p>又是sql注入，他说不让用map就不用？</p>
<p>好嘛没扫出来。</p>
<p>万能密码也行不通了，开始手动注入</p>
<p><img src="/2022/01/15/BUUCTF-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AD%BE%E5%88%B0%E9%A2%98-%E5%86%85%E6%9C%89sql-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E5%86%85%E8%81%94/image-20220115151050988.png" alt="image-20220115151050988"></p>
<p>order by4报错，就是说有3列</p>
<p>payload：-1’ union select database(),2,3;#</p>
<p><img src="/2022/01/15/BUUCTF-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AD%BE%E5%88%B0%E9%A2%98-%E5%86%85%E6%9C%89sql-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E5%86%85%E8%81%94/image-20220115151455966.png" alt="image-20220115151455966"></p>
<p>回显的是2,3</p>
<p>payload：-1’ union select 1,database(),user();#</p>
<p><img src="/2022/01/15/BUUCTF-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AD%BE%E5%88%B0%E9%A2%98-%E5%86%85%E6%9C%89sql-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E5%86%85%E8%81%94/image-20220115151728456.png" alt="image-20220115151728456"></p>
<p>得到数据库名字</p>
<p>然后就开始爆表</p>
<p>-1’ union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=database() ;#</p>
<p>爆字段</p>
<p>-1’ union select 1,2,group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=’l0ve1ysq1’ ;#</p>
<p><img src="/2022/01/15/BUUCTF-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AD%BE%E5%88%B0%E9%A2%98-%E5%86%85%E6%9C%89sql-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E5%86%85%E8%81%94/image-20220115153816044.png" alt="image-20220115153816044"></p>
<p>爆数据：</p>
<p>-1’ union select 1,2,group_concat(id,username,password) from l0ve1ysq1 ;#</p>
<p><img src="/2022/01/15/BUUCTF-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AD%BE%E5%88%B0%E9%A2%98-%E5%86%85%E6%9C%89sql-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E5%86%85%E8%81%94/image-20220115153828210.png" alt="image-20220115153828210"></p>
<p>得到flag</p>
<p><img src="/2022/01/15/BUUCTF-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AD%BE%E5%88%B0%E9%A2%98-%E5%86%85%E6%9C%89sql-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E5%86%85%E8%81%94/image-20220115153915190.png" alt="image-20220115153915190"></p>
<h2 id="第十题-命令执行漏洞"><a href="#第十题-命令执行漏洞" class="headerlink" title="第十题 命令执行漏洞"></a>第十题 命令执行漏洞</h2><p><img src="/2022/01/15/BUUCTF-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AD%BE%E5%88%B0%E9%A2%98-%E5%86%85%E6%9C%89sql-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E5%86%85%E8%81%94/image-20220115154242420.png" alt="image-20220115154242420"></p>
<p>又是ping命令</p>
<p><img src="/2022/01/15/BUUCTF-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AD%BE%E5%88%B0%E9%A2%98-%E5%86%85%E6%9C%89sql-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E5%86%85%E8%81%94/image-20220115154306587.png" alt="image-20220115154306587"></p>
<p>发现flag</p>
<p><img src="/2022/01/15/BUUCTF-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AD%BE%E5%88%B0%E9%A2%98-%E5%86%85%E6%9C%89sql-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E5%86%85%E8%81%94/image-20220115154348761.png" alt="image-20220115154348761"></p>
<p>但是发现/和空格都被过滤了，想办法绕过</p>
<p><img src="/2022/01/15/BUUCTF-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AD%BE%E5%88%B0%E9%A2%98-%E5%86%85%E6%9C%89sql-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E5%86%85%E8%81%94/image-20220115154446178.png" alt="image-20220115154446178"></p>
<p>额flag也被绕过了</p>
<p>代替空格的符号有</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%20(space)、%09(tab)、$IFS$9、$&#123;IFS&#125;$9、 &#123;IFS&#125;、IFS 都可以</span><br></pre></td></tr></table></figure>

<p><img src="/2022/01/15/BUUCTF-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AD%BE%E5%88%B0%E9%A2%98-%E5%86%85%E6%9C%89sql-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E5%86%85%E8%81%94/image-20220115154651400.png" alt="image-20220115154651400"></p>
<p>访问index看看过滤规则,用的是正则表达式。</p>
<p>我们可以用变量来代替flag字段，/?ip=127.0.0.1;echo$IFS$1Y2F0IGZsYWcucGhw|base64$IFS$1-d|sh</p>
<p><img src="/2022/01/15/BUUCTF-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AD%BE%E5%88%B0%E9%A2%98-%E5%86%85%E6%9C%89sql-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E5%86%85%E8%81%94/image-20220115155138771.png" alt="image-20220115155138771"></p>
<p>得到flag</p>
<p>在网上还发现了其他的方法：</p>
<p>  1.通过执行sh命令来执行 （bash被过滤了，不然也可以执行）</p>
<pre><code>/ip=127.0.0.1;echo$IFS$1Y2F0IGZsYWcucGhw|base64$IFS$1-d|sh
注：sh是linux中运行shell的命令，bash相当于sh的升级版，sh∈bash





2.内联执行 （真正的大佬操作，给跪了）
构造 /?ip=127.0.0.1;cat$IFS$9`ls`
注：内联，就是将反引号内命令的输出作为输入执行。
</code></pre>
<h2 id="第十一题-菜刀"><a href="#第十一题-菜刀" class="headerlink" title="第十一题 菜刀"></a>第十一题 菜刀</h2><p><img src="/2022/01/15/BUUCTF-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AD%BE%E5%88%B0%E9%A2%98-%E5%86%85%E6%9C%89sql-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E5%86%85%E8%81%94/image-20220115160821181.png" alt="image-20220115160821181"></p>
<p>蚁剑直接连</p>
<p><img src="/2022/01/15/BUUCTF-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AD%BE%E5%88%B0%E9%A2%98-%E5%86%85%E6%9C%89sql-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E5%86%85%E8%81%94/image-20220115160834862.png" alt="image-20220115160834862"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-cn">
    <link itemprop="mainEntityOfPage" href="https://wanheiqiyihu.top/2022/01/11/sql%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="十三">
      <meta itemprop="description" content="潜心学习，不骄不躁">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="十三の博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/11/sql%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/" class="post-title-link" itemprop="url">sql必知必会</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-01-11 22:34:47 / 修改时间：22:36:04" itemprop="dateCreated datePublished" datetime="2022-01-11T22:34:47+08:00">2022-01-11</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/readbook/" itemprop="url" rel="index"><span itemprop="name">-readbook</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="sql必知必会"><a href="#sql必知必会" class="headerlink" title="sql必知必会"></a>sql必知必会</h1><h1 id="第一课-了解sql"><a href="#第一课-了解sql" class="headerlink" title="第一课 了解sql"></a>第一课 了解sql</h1><p>数据库（database）</p>
<p>表（table）储存在表中的数据时同一种类型的数据或清单</p>
<p>列（column）</p>
<p>行（row）</p>
<h2 id="1-1主键-primart-key"><a href="#1-1主键-primart-key" class="headerlink" title="1.1主键 primart key"></a>1.1主键 primart key</h2><p>表中每一行都应该有一列可以唯一标识自己。</p>
<p>主键值能够唯一标识表中的每一行。</p>
<p>注：主键列不允许null，不允许修改或更新，不能重用。</p>
<h1 id="第二课-检索数据"><a href="#第二课-检索数据" class="headerlink" title="第二课 检索数据"></a>第二课 检索数据</h1><h2 id="2-1SELECT语句"><a href="#2-1SELECT语句" class="headerlink" title="2.1SELECT语句"></a>2.1SELECT语句</h2><h3 id="2-1-1检索单列"><a href="#2-1-1检索单列" class="headerlink" title="2.1.1检索单列"></a>2.1.1检索单列</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> prod <span class="keyword">from</span> products;</span><br><span class="line">#意为从表products中查询prod列</span><br></pre></td></tr></table></figure>

<p>提示：结合sql语句</p>
<p>多条sql语句必须以分号(;)分隔，并且sql语句不区分大小写。</p>
<h3 id="2-1-2检索多列"><a href="#2-1-2检索多列" class="headerlink" title="2.1.2检索多列"></a>2.1.2检索多列</h3><p>与单列相同，列名之间必须以逗号分隔，但是在最后一个列名的后面不加，否则会报错。</p>
<h3 id="2-1-3检索所有列"><a href="#2-1-3检索所有列" class="headerlink" title="2.1.3检索所有列"></a>2.1.3检索所有列</h3><p>在实际列名的位置使用星号通配符可以做到这点。</p>
<h3 id="2-1-4检索不同值"><a href="#2-1-4检索不同值" class="headerlink" title="2.1.4检索不同值"></a>2.1.4检索不同值</h3><p>想要返回不同的值，在列名前直接用distinct，则不会返回重复的数值。</p>
<h3 id="2-1-5top关键字"><a href="#2-1-5top关键字" class="headerlink" title="2.1.5top关键字"></a>2.1.5top关键字</h3><p>在SQLserver中使用SELECT时，可以用TOP关键字来限制最多返回多少行。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> top <span class="number">5</span> prod_name FORM prducts;</span><br><span class="line">#检索products表中前五个列</span><br></pre></td></tr></table></figure>

<h3 id="2-1-6LIMIT关键字"><a href="#2-1-6LIMIT关键字" class="headerlink" title="2.1.6LIMIT关键字"></a>2.1.6LIMIT关键字</h3><p>如果使用mysql，mariaDB，postgresql，则用LIMIT关键字来限制</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> top <span class="number">5</span> prod_name FORM prducts LIMIT <span class="number">5</span>;</span><br><span class="line">#只返回五行数据</span><br><span class="line"><span class="keyword">SELECT</span> top <span class="number">5</span> prod_name FORM prducts LIMIT <span class="number">5</span> <span class="keyword">OFFSET</span> <span class="number">4</span>;</span><br><span class="line">#从第四行开始返回五行数据</span><br></pre></td></tr></table></figure>

<h1 id="第三课-排列数据"><a href="#第三课-排列数据" class="headerlink" title="第三课 排列数据"></a>第三课 排列数据</h1><h3 id="3-1-1ORDER-BY关键字"><a href="#3-1-1ORDER-BY关键字" class="headerlink" title="3.1.1ORDER BY关键字"></a>3.1.1ORDER BY关键字</h3><p>在SELECT语句最后使用，ORDER BY，对order by后面的列进行排序（列名之间用逗号分开），其后加数字也可以（相对列位置）。</p>
<h1 id="第四课-过滤数据"><a href="#第四课-过滤数据" class="headerlink" title="第四课 过滤数据"></a>第四课 过滤数据</h1><h2 id="4-1使用WHERE子句"><a href="#4-1使用WHERE子句" class="headerlink" title="4.1使用WHERE子句"></a>4.1使用WHERE子句</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> sex <span class="keyword">FROM</span> <span class="keyword">member</span> <span class="keyword">WHERE</span> username<span class="operator">=</span> <span class="string">&#x27;allen&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>分析 这条语句从menber表中检索了 username为allen那一行的sex列。</p>
<h2 id="4-2where子句的操作符"><a href="#4-2where子句的操作符" class="headerlink" title="4.2where子句的操作符"></a>4.2where子句的操作符</h2><p>有大于小于以及取非!，还有两个比较特殊的”BETWEEN AND”  “IS NULL”。就像是python里的if一样，输出满足条件的那一行。</p>
<h1 id="第五课-高级数据过滤"><a href="#第五课-高级数据过滤" class="headerlink" title="第五课 高级数据过滤"></a>第五课 高级数据过滤</h1><h2 id="5-1组合WHERE子句"><a href="#5-1组合WHERE子句" class="headerlink" title="5.1组合WHERE子句"></a>5.1组合WHERE子句</h2><h3 id="5-1-1AND操作符"><a href="#5-1-1AND操作符" class="headerlink" title="5.1.1AND操作符"></a>5.1.1AND操作符</h3><p>要通过不知一个列进行过滤，可以使用AND操作符给WHERE子句附加条件</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> sex <span class="keyword">FROM</span> <span class="keyword">member</span> <span class="keyword">WHERE</span> username<span class="operator">=</span> <span class="string">&#x27;allen&#x27;</span> <span class="keyword">AND</span> address <span class="operator">=</span> <span class="string">&#x27;nba 76&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="5-1-2OR操作符"><a href="#5-1-2OR操作符" class="headerlink" title="5.1.2OR操作符"></a>5.1.2OR操作符</h3><p>就和其他的编程语言一样，or也是或运算。许多dbms在OR WHERE子句的第一个条件得到满足的情况下就不会计算第二个条件了。</p>
<h3 id="5-1-3运算顺序"><a href="#5-1-3运算顺序" class="headerlink" title="5.1.3运算顺序"></a>5.1.3运算顺序</h3><p>and的优先级是大于or的</p>
<h2 id="5-2-IN操作符"><a href="#5-2-IN操作符" class="headerlink" title="5.2 IN操作符"></a>5.2 IN操作符</h2><p>IN操作符用来指定条件的范围，范围中的每个条件都可以进行匹配。IN取一组由逗号分隔、括在圆括号中的合法值。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> username <span class="keyword">from</span> <span class="keyword">member</span> <span class="keyword">where</span> id <span class="keyword">in</span> (<span class="number">1</span>,<span class="number">3</span>);</span><br><span class="line">#这个语句会找到id为<span class="number">1</span>和<span class="number">3</span>的数据，并不是开区间的意思，比起<span class="keyword">or</span>更加简洁明了，执行起来也更加快捷。</span><br></pre></td></tr></table></figure>



<h2 id="5-3NOT操作符"><a href="#5-3NOT操作符" class="headerlink" title="5.3NOT操作符"></a>5.3NOT操作符</h2><p>WHERE子句中的NOT操作符有且仅有一个功能，那就是否定其后所跟的任何条件。 </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> username <span class="keyword">from</span> <span class="keyword">member</span> <span class="keyword">where</span> <span class="keyword">NOT</span>  id <span class="keyword">in</span> (<span class="number">1</span>,<span class="number">3</span>);</span><br><span class="line">#检索id不是<span class="number">1</span>和<span class="number">3</span>的数据。</span><br></pre></td></tr></table></figure>

<h1 id="第六课-用通配符进行过滤"><a href="#第六课-用通配符进行过滤" class="headerlink" title="第六课 用通配符进行过滤"></a>第六课 用通配符进行过滤</h1><p>通配符（wildcard）:用来匹配值的一部分的特殊字符</p>
<p>搜索模式(search pattern):由字面值、通配符或两者组合构成的搜索条件。</p>
<h2 id="6-1-LIKE操作符"><a href="#6-1-LIKE操作符" class="headerlink" title="6.1 LIKE操作符"></a>6.1 LIKE操作符</h2><h3 id="6-1-1-百分号-通配符"><a href="#6-1-1-百分号-通配符" class="headerlink" title="6.1.1 百分号%通配符"></a>6.1.1 百分号%通配符</h3><p>最常使用的通配符，%表示任何字符出现任意次数。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> username <span class="keyword">from</span> <span class="keyword">member</span> <span class="keyword">where</span> username <span class="keyword">LIKE</span> <span class="string">&#x27;L%&#x27;</span>;</span><br><span class="line">#检索username以l开头的的行</span><br></pre></td></tr></table></figure>

<h3 id="6-1-2下划线-通配符"><a href="#6-1-2下划线-通配符" class="headerlink" title="6.1.2下划线_通配符"></a>6.1.2下划线_通配符</h3><p>下划线的作用和百分号一样，但是它只匹配单个字符而不是多个字符。</p>
<h3 id="6-1-3方括号-通配符"><a href="#6-1-3方括号-通配符" class="headerlink" title="6.1.3方括号[]通配符"></a>6.1.3方括号[]通配符</h3><p>方括号通配符用来指定一个字符集，他必须匹配指定位置(通配符的位置)的一个字符。</p>
<p>注意:并不是所有都支持集合，sqlserver支持，但是mysql，Oracle，db2，sqlite都不支持</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> username <span class="keyword">from</span> <span class="keyword">member</span> <span class="keyword">where</span> username <span class="keyword">like</span> &quot;[jm]%&quot;</span><br><span class="line">#找出所有名字以j或者m开头的成员</span><br></pre></td></tr></table></figure>

<h1 id="第七课-创建计算字段"><a href="#第七课-创建计算字段" class="headerlink" title="第七课 创建计算字段"></a>第七课 创建计算字段</h1><h2 id="7-1计算字段"><a href="#7-1计算字段" class="headerlink" title="7.1计算字段"></a>7.1计算字段</h2><p>储存在数据库表中的数据一般不是应用程序所需要的的格式，这就是计算字段可以派上用场的地方了。与前几课介绍的列不同，计算字段并不实际存在于数据库中。计算字段是运行时在SELECT语句内创建的。</p>
<h2 id="7-2拼接字段"><a href="#7-2拼接字段" class="headerlink" title="7.2拼接字段"></a>7.2拼接字段</h2><p>在不同的DBMS中会使用不同的拼接符号，大部分是+ 有些是||</p>
<p>例子：拼接由两列组成的标题。</p>
<p><img src="/2022/01/11/sql%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/image-20220110211300133.png" alt="image-20220110211300133"></p>
<p><img src="/2022/01/11/sql%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/image-20220110211308998.png" alt="image-20220110211308998"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> age <span class="operator">+</span> username <span class="keyword">FROM</span> <span class="keyword">Member</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> uername</span><br></pre></td></tr></table></figure>

<h3 id="7-2-1补充-去除空格的函数"><a href="#7-2-1补充-去除空格的函数" class="headerlink" title="7.2.1补充 去除空格的函数"></a>7.2.1补充 去除空格的函数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rtrim(列名)去除右边的空格</span><br><span class="line">ltrim(列名)去除左边的空格</span><br><span class="line"><span class="built_in">trim</span>(列名)去除两边的空格</span><br></pre></td></tr></table></figure>

<h2 id="7-3使用别名"><a href="#7-3使用别名" class="headerlink" title="7.3使用别名"></a>7.3使用别名</h2><p>select语句可以很好的拼接两个地址字段。但是这个新计算列的并没有名字，他只是一个值，我们可以用AS关键字给他赋予别名。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> rtrim(age <span class="operator">+</span> username) <span class="keyword">AS</span> totl <span class="keyword">FROM</span> <span class="keyword">Member</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> uername</span><br></pre></td></tr></table></figure>

<h2 id="7-4执行算数计算"><a href="#7-4执行算数计算" class="headerlink" title="7.4执行算数计算"></a>7.4执行算数计算</h2><p>计算字段的另一常见用途是对检索出的数据进行算术计算。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> quantity,price,quantity<span class="operator">*</span>price <span class="keyword">AS</span> final_price <span class="keyword">FROM</span> <span class="keyword">order</span>;</span><br><span class="line">#计算总的价格之后输出</span><br></pre></td></tr></table></figure>

<h1 id="8-使用函数处理数据"><a href="#8-使用函数处理数据" class="headerlink" title="8.使用函数处理数据"></a>8.使用函数处理数据</h1><h2 id="8-1使用函数"><a href="#8-1使用函数" class="headerlink" title="8.1使用函数"></a>8.1使用函数</h2><p>大多数sql实现支持一下函数：</p>
<p>用于处理文本字符串的文本函数，用于在数值计算上的算数操作函数，用于处理日期和时间值并从这些值中提取特定数值的日期和时间函数，用于生产美观好动的输出内容的格式化函数，返回dbms特殊信息的函数。</p>
<h3 id="8-1-1文本处理函数"><a href="#8-1-1文本处理函数" class="headerlink" title="8.1.1文本处理函数"></a>8.1.1文本处理函数</h3><p>UPPER()输出转化为大写</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">upper</span>(username) <span class="keyword">from</span> users;</span><br></pre></td></tr></table></figure>

<p>下面介绍常用的文本处理函数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">rtrim(列名)去除右边的空格</span><br><span class="line">ltrim(列名)去除左边的空格</span><br><span class="line"><span class="built_in">trim</span>(列名)去除两边的空格</span><br><span class="line"><span class="keyword">left</span>()返回字符串左边的字符</span><br><span class="line">length()返回字符串的长度</span><br><span class="line"><span class="built_in">lower</span>()将字符串转换为小写</span><br><span class="line"><span class="keyword">right</span>()返回字符串右边的字符</span><br><span class="line">substr或者<span class="built_in">substring</span>()提取字符串的组成部分</span><br><span class="line">soundex()返回字符串的soundex值</span><br></pre></td></tr></table></figure>

<p>其中，soundex是一个将任何文本串转换为描述其语音表示的字母数字模式的算法</p>
<h3 id="8-1-2日期和时间处理函数"><a href="#8-1-2日期和时间处理函数" class="headerlink" title="8.1.2日期和时间处理函数"></a>8.1.2日期和时间处理函数</h3><p>每种dbms都有自己的特殊形式的日期和时间。</p>
<p>例子：在sqlsever中检索2020年所有的订单，可如下进行：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> order_num</span><br><span class="line"><span class="keyword">from</span> Orders</span><br><span class="line"><span class="keyword">where</span> DATAPART(yy,order_date) <span class="operator">=</span> <span class="number">2020</span>;</span><br></pre></td></tr></table></figure>

<h3 id="8-1-3数值处理函数"><a href="#8-1-3数值处理函数" class="headerlink" title="8.1.3数值处理函数"></a>8.1.3数值处理函数</h3><p>这些函数，一般主要用于，代数，三角或集合运算，因此不想字符串和时间那样使用的平凡。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ABS</span>()返回一个数的绝对值</span><br><span class="line"><span class="built_in">COS</span>()返回一个角度的余弦</span><br><span class="line"><span class="built_in">EXP</span>()返回一个数的指数值</span><br><span class="line">PI()返回圆周率π的值</span><br><span class="line"><span class="built_in">SIN</span>()返回一个角度的正弦</span><br><span class="line"><span class="built_in">SQRT</span>()返回一个数的平方根</span><br><span class="line"><span class="built_in">TAN</span>()返回一个角度的正弦</span><br></pre></td></tr></table></figure>

<h1 id="第九课-汇总数据"><a href="#第九课-汇总数据" class="headerlink" title="第九课 汇总数据"></a>第九课 汇总数据</h1><h2 id="9-1聚集函数"><a href="#9-1聚集函数" class="headerlink" title="9.1聚集函数"></a>9.1聚集函数</h2><p>有时候需要汇总数据但是不用把他们实际检索出来、这种类型的检索例子有：</p>
<p>确定表中的行数</p>
<p>获得表中某些行的和</p>
<p>找出表列的最大值、最小值、平均值。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">sql</span>聚集函数</span><br><span class="line"><span class="built_in">AVG</span>()返回某列的平均值</span><br><span class="line"><span class="built_in">COUNT</span>()返回某列的行数</span><br><span class="line"><span class="built_in">MAX</span>()返回某列的最大值</span><br><span class="line"><span class="built_in">MIN</span>()返回某列的最小值</span><br><span class="line"><span class="built_in">SUM</span>()返回某列值之和</span><br></pre></td></tr></table></figure>

<h3 id="9-1-1AVG-函数"><a href="#9-1-1AVG-函数" class="headerlink" title="9.1.1AVG()函数"></a>9.1.1AVG()函数</h3><p>可用来返回所有列的平均值，也可以用来返回特定列或行的平均值。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">avg</span>(id) <span class="keyword">from</span> <span class="keyword">member</span>;</span><br></pre></td></tr></table></figure>

<p>返回id的平均值。注意，avg()函数忽略列值为NULL的行。</p>
<h3 id="9-1-2COUNT-函数"><a href="#9-1-2COUNT-函数" class="headerlink" title="9.1.2COUNT()函数"></a>9.1.2COUNT()函数</h3><p>可利用count 确定表中行的数目或符合特定条件行的数目。</p>
<p>count()函数有两种使用方法</p>
<p>使用count(*)对表中行的数目进行计数，不管表列中包含的是空值还是非空值。</p>
<p>使用count(colums)对特定列中具有值的进行行计数，忽略null。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> num_cust <span class="keyword">from</span> <span class="keyword">member</span>;</span><br><span class="line">计算有多少行</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(cust_email) <span class="keyword">as</span> num_cust <span class="keyword">from</span> <span class="keyword">member</span>;</span><br><span class="line">计算有邮箱的用户有多少个</span><br></pre></td></tr></table></figure>

<h3 id="9-1-3max-函数"><a href="#9-1-3max-函数" class="headerlink" title="9.1.3max()函数"></a>9.1.3max()函数</h3><p>返回指定列中的最大值，要求指定列名。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">max</span>(id) <span class="keyword">as</span> max_id <span class="keyword">from</span> <span class="keyword">member</span>;</span><br></pre></td></tr></table></figure>

<h3 id="9-1-4min-函数"><a href="#9-1-4min-函数" class="headerlink" title="9.1.4min()函数"></a>9.1.4min()函数</h3><p>返回指定列中的最小值，要求指定列名。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">min</span>(id) <span class="keyword">as</span> min_id <span class="keyword">from</span> <span class="keyword">member</span>;</span><br></pre></td></tr></table></figure>

<h3 id="9-1-5sum-函数"><a href="#9-1-5sum-函数" class="headerlink" title="9.1.5sum()函数"></a>9.1.5sum()函数</h3><p>用返回指定列的和</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">sum</span>(id) <span class="keyword">as</span> sum_id <span class="keyword">from</span> <span class="keyword">member</span>;</span><br></pre></td></tr></table></figure>

<h2 id="9-2聚集不同值"><a href="#9-2聚集不同值" class="headerlink" title="9.2聚集不同值"></a>9.2聚集不同值</h2><p>以上五个聚集函数都可以如下使用：</p>
<p>对所有行执行计算，指定all参数或不指定参数（因为all是默认行为）。</p>
<p>只包含不同的值，指定distinct参数。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">avg</span>(<span class="keyword">distinct</span> id) <span class="keyword">from</span> <span class="keyword">member</span>;</span><br></pre></td></tr></table></figure>

<h2 id="9-3组合聚集参数"><a href="#9-3组合聚集参数" class="headerlink" title="9.3组合聚集参数"></a>9.3组合聚集参数</h2><p>实际上，selct语句可以根据需要包含多个聚集函数。中间用逗号隔开</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">avg</span>(<span class="keyword">distinct</span> id),<span class="built_in">min</span>(id) <span class="keyword">from</span> <span class="keyword">member</span>;</span><br></pre></td></tr></table></figure>

<h1 id="10-分组数据"><a href="#10-分组数据" class="headerlink" title="10.分组数据"></a>10.分组数据</h1><h2 id="10-1数据分组"><a href="#10-1数据分组" class="headerlink" title="10.1数据分组"></a>10.1数据分组</h2><p>使用分组可以将数据分为多个逻辑组，对每个组进行聚集计算。</p>
<h2 id="10-2创建分组"><a href="#10-2创建分组" class="headerlink" title="10.2创建分组"></a>10.2创建分组</h2><p>分组是使用SELECT语句的GROUP BY子句建立的。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> username,<span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> sum <span class="keyword">from</span> <span class="keyword">member</span> <span class="keyword">group</span> <span class="keyword">by</span> username;</span><br></pre></td></tr></table></figure>

<p>由于使用了group by语句，count函数会对每一个组进行计算。这个语句的意思就是，检索每一个用户有多少条数据。</p>
<p>注意，group by子句必须出现在where子句之后，order by 子句之前。</p>
<h2 id="10-3过滤分组"><a href="#10-3过滤分组" class="headerlink" title="10.3过滤分组"></a>10.3过滤分组</h2><p>虽然where可以进行数据的过滤，但是因为where过滤指定的是行而不是分组，实际上，where子句并没有分组的概念。</p>
<p>这时候我们可以用having子句来代替，他们的差距就是where过滤行，having过滤分组。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> username,<span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> sum <span class="keyword">from</span> <span class="keyword">member</span> <span class="keyword">group</span> <span class="keyword">by</span> username <span class="keyword">having</span> <span class="built_in">count</span>(<span class="operator">*</span>)<span class="operator">&gt;=</span><span class="number">2</span>;</span><br><span class="line">这个语句的意思就是，检索有两行以上上数据的用户名字。</span><br></pre></td></tr></table></figure>

<p>注意：having要放在group by后面。</p>
<h2 id="10-4select子句顺序"><a href="#10-4select子句顺序" class="headerlink" title="10.4select子句顺序"></a>10.4select子句顺序</h2><p>下面回顾一下select语句中子句的顺序。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line"><span class="keyword">HAVING</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br></pre></td></tr></table></figure>

<h1 id="第十一课-使用子查询"><a href="#第十一课-使用子查询" class="headerlink" title="第十一课 使用子查询"></a>第十一课 使用子查询</h1><h2 id="11-1子查询"><a href="#11-1子查询" class="headerlink" title="11.1子查询"></a>11.1子查询</h2><p>sql支持创建子查询，即创建在其他查询中的查询。</p>
<p>下面举几个例子</p>
<h2 id="11-2利用子查询进行过滤"><a href="#11-2利用子查询进行过滤" class="headerlink" title="11.2利用子查询进行过滤"></a>11.2利用子查询进行过滤</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> cust_id</span><br><span class="line"><span class="keyword">from</span> Orders</span><br><span class="line"><span class="keyword">where</span> order_num <span class="keyword">IN</span> (<span class="keyword">select</span> order_num</span><br><span class="line">                   <span class="keyword">from</span> OrderItems</span><br><span class="line">                   <span class="keyword">where</span> prod<span class="operator">-</span>id <span class="operator">=</span> <span class="string">&#x27;RGAN01&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>这里就限制了order_num的范围，在select语句中，子查询总是从内向外处理。而且对于子查询的嵌套没有限制。</p>
<h1 id="第十二课-联结表"><a href="#第十二课-联结表" class="headerlink" title="第十二课 联结表"></a>第十二课 联结表</h1><h2 id="12-1联结"><a href="#12-1联结" class="headerlink" title="12.1联结"></a>12.1联结</h2><p>sql最强大的功能就是在数据查询的执行中联结(join)表。联结是利用sql的select能执行的最重要的操作。</p>
<h3 id="12-1-1创建联结"><a href="#12-1-1创建联结" class="headerlink" title="12.1.1创建联结"></a>12.1.1创建联结</h3><p>创建联结非常简单，指定要连接的所有表以及关联他们的方式即可。</p>
<p>下面看一个例子</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> vend_name,prod_name,prod_price</span><br><span class="line"><span class="keyword">from</span> Vendors,Products</span><br><span class="line"><span class="keyword">WHERE</span> Vendors.vend_id <span class="operator">=</span> Products.ven_id;</span><br><span class="line">#<span class="keyword">where</span>子句指示dbms将Vendors表中的vend_id与Products表中的vend_id匹配起来。</span><br></pre></td></tr></table></figure>

<h3 id="12-1-2内连接"><a href="#12-1-2内连接" class="headerlink" title="12.1.2内连接"></a>12.1.2内连接</h3><p>目前为止使用的联结称为等值联结，他基于两个表之间的相等测试，这种联结也称为内连接。</p>
<h1 id="第十三课-创建高级联结（未完）"><a href="#第十三课-创建高级联结（未完）" class="headerlink" title="第十三课 创建高级联结（未完）"></a>第十三课 创建高级联结（未完）</h1><h2 id="13-1使用表别名"><a href="#13-1使用表别名" class="headerlink" title="13.1使用表别名"></a>13.1使用表别名</h2><p>同样是在表的后面使用as关键字即可，</p>
<h1 id="第十四课-组合查询"><a href="#第十四课-组合查询" class="headerlink" title="第十四课 组合查询"></a>第十四课 组合查询</h1><h2 id="14-1组合查询"><a href="#14-1组合查询" class="headerlink" title="14.1组合查询"></a>14.1组合查询</h2><p>sql也允许执行多个查询，(多条sql语句)，并将结果作为一个查询结果集返回，这些组合查询通常称为并(union)或复合查询(xompound query)</p>
<h2 id="14-2创建组合查询"><a href="#14-2创建组合查询" class="headerlink" title="14.2创建组合查询"></a>14.2创建组合查询</h2><h3 id="14-2-1使用UNION"><a href="#14-2-1使用UNION" class="headerlink" title="14.2.1使用UNION"></a>14.2.1使用UNION</h3><p>给出每条SELECT语句，在每条语句之间放上关键字union。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> username <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">union</span> <span class="keyword">select</span> username <span class="keyword">from</span> <span class="keyword">member</span> <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<p>虽然sql没有对union数量进行限制，但是最好参考一下dbms的文档。</p>
<h3 id="14-2-2union规则"><a href="#14-2-2union规则" class="headerlink" title="14.2.2union规则"></a>14.2.2union规则</h3><p>1.union必须有两条或两条以上的select语句组成，语句中间用union分隔。</p>
<p>2.union中的每个查询必须包含相同的列、表达式或聚集函数。</p>
<p>3.列数据类型必须兼容，类型不必完全相同，但是必须是dbms可以隐含转换的类型。</p>
<h3 id="14-2-3包含或取消重复的行"><a href="#14-2-3包含或取消重复的行" class="headerlink" title="14.2.3包含或取消重复的行"></a>14.2.3包含或取消重复的行</h3><p>union会自动将重复的行删除，如果想要返回重复的行，使用union all即可</p>
<h3 id="14-2-4对组合查询结果排序"><a href="#14-2-4对组合查询结果排序" class="headerlink" title="14.2.4对组合查询结果排序"></a>14.2.4对组合查询结果排序</h3><p>在使用union时，只能使用一条ORDER BY语句，必须位于最后一条select语句的后面，不存在用一种方式排列一部分。</p>
<h1 id="第十五课-插入数据"><a href="#第十五课-插入数据" class="headerlink" title="第十五课 插入数据"></a>第十五课 插入数据</h1><h2 id="15-1数据插入"><a href="#15-1数据插入" class="headerlink" title="15.1数据插入"></a>15.1数据插入</h2><p>除了select语句，sql同样还有其他三个常用的语句。数据插入就是INSERT</p>
<p>顾名思义，insert用来将行插入到数据库中，插入有几种方式；</p>
<p>插入完整的行；</p>
<p>插入行的一部分；</p>
<p>插入写查询的结果；</p>
<h3 id="15-1-1插入完整的行"><a href="#15-1-1插入完整的行" class="headerlink" title="15.1.1插入完整的行"></a>15.1.1插入完整的行</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">member</span></span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">&#x27;8&#x27;</span>,<span class="string">&#x27;test&#x27;</span>,<span class="string">&#x27;asdasdasd&#x27;</span>,<span class="string">&#x27;boy&#x27;</span>,<span class="string">&#x27;1111111111&#x27;</span>,<span class="string">&#x27;chain&#x27;</span>,<span class="string">&#x27;aaa@pikachu.com&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>注意：必须给每一列都提供一个值，如果没有值，那也必须输入null。</p>
<p>虽然上述方法比较简单，但是并不安全，因为他依赖于列的顺序，很有可能就会打乱我们的数据库，下面介绍一种更加安全的方法。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">member</span>(<span class="string">&#x27;id&#x27;</span>,<span class="string">&#x27;username&#x27;</span>,<span class="string">&#x27;pw&#x27;</span>,<span class="string">&#x27;sex&#x27;</span>,<span class="string">&#x27;phonenum&#x27;</span>,<span class="string">&#x27;address&#x27;</span>,<span class="string">&#x27;email&#x27;</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">&#x27;8&#x27;</span>,<span class="string">&#x27;test&#x27;</span>,<span class="string">&#x27;asdasdasd&#x27;</span>,<span class="string">&#x27;boy&#x27;</span>,<span class="string">&#x27;1111111111&#x27;</span>,<span class="string">&#x27;chain&#x27;</span>,<span class="string">&#x27;aaa@pikachu.com&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>虽然这种方法与上面功能一样而且更加繁琐但是不会打乱我们的数据库，因为明确给出了每一列的列名，就像python中的基于索引和基于名字的参数。</p>
<h3 id="15-1-2插入部分行"><a href="#15-1-2插入部分行" class="headerlink" title="15.1.2插入部分行"></a>15.1.2插入部分行</h3><p>正如所述，使用INSERT的推荐方法是明确给出表的列名。用这种语法还可以省略列，这表示可以只给某些列提供值，给其他列不提供值。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">member</span>(<span class="string">&#x27;pw&#x27;</span>,<span class="string">&#x27;sex&#x27;</span>,<span class="string">&#x27;phonenum&#x27;</span>,<span class="string">&#x27;address&#x27;</span>,<span class="string">&#x27;email&#x27;</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">&#x27;asdasdasd&#x27;</span>,<span class="string">&#x27;boy&#x27;</span>,<span class="string">&#x27;1111111111&#x27;</span>,<span class="string">&#x27;chain&#x27;</span>,<span class="string">&#x27;aaa@pikachu.com&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>这里就没有输入id 和username这两行，这表示insert语句省略了这两列，如果省略了，有默认值就是默认值没有就是null。</p>
<h3 id="15-1-3插入检索出的数据"><a href="#15-1-3插入检索出的数据" class="headerlink" title="15.1.3插入检索出的数据"></a>15.1.3插入检索出的数据</h3><p>可以使用INSERT SELECT来实现插入检索出的数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">member</span>(<span class="string">&#x27;id&#x27;</span>,<span class="string">&#x27;username&#x27;</span>,<span class="string">&#x27;pw&#x27;</span>,<span class="string">&#x27;sex&#x27;</span>,<span class="string">&#x27;phonenum&#x27;</span>,<span class="string">&#x27;address&#x27;</span>,<span class="string">&#x27;email&#x27;</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">SELECT</span> id,username,pw,sex,phonenum,address,xxx</span><br><span class="line"><span class="keyword">FROM</span> xxx;</span><br></pre></td></tr></table></figure>

<h2 id="15-2从一个表复制到另一个表"><a href="#15-2从一个表复制到另一个表" class="headerlink" title="15.2从一个表复制到另一个表"></a>15.2从一个表复制到另一个表</h2><p>有一种数据插入不使用insert语句，要将一个表的内容复制到一个全新表(运行中创建的表)。</p>
<p>使用CREATE SELECT</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> custcopy <span class="keyword">AS</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> customers;</span><br></pre></td></tr></table></figure>



<h1 id="第十六课-更新和删除数据"><a href="#第十六课-更新和删除数据" class="headerlink" title="第十六课 更新和删除数据"></a>第十六课 更新和删除数据</h1><p>这一课介绍如何利用UPDATE 和 DELETE语句进一步操作表数据。</p>
<h2 id="16-1更新数据"><a href="#16-1更新数据" class="headerlink" title="16.1更新数据"></a>16.1更新数据</h2><p>更新(修改)数据，可以使用UPDATE语句，有两种使用的方法：</p>
<p>更新中的特定行</p>
<p>更新表中所有行</p>
<p>基本的UPDATE语句由三部分组成，分别是：要更新的表，列名和他们的新值，确定要更新哪些行的过滤条件。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UPDATE copytable </span><br><span class="line"><span class="keyword">SET</span> username <span class="operator">=</span> <span class="string">&#x27;xiugai&#x27;</span></span><br><span class="line"><span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>上面语句就是修改id为1的用户的名字。</p>
<p>在更新多个列时，只需要使用一条set命令，每个“列=值”对之间用逗号分隔。</p>
<h2 id="16-2删除数据"><a href="#16-2删除数据" class="headerlink" title="16.2删除数据"></a>16.2删除数据</h2><p>从个表中删除数据，使用DELETE语句，有两种使用方式：</p>
<p>从表中删除特定的行</p>
<p>从表中删除所有行</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> copytable</span><br><span class="line"><span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>删除了表copytable中id为1的用户。如果省略WHERE语句，他就会删除整个表。update也一样。</p>
<h1 id="第十七课-创建和操纵表"><a href="#第十七课-创建和操纵表" class="headerlink" title="第十七课 创建和操纵表"></a>第十七课 创建和操纵表</h1><h2 id="17-1创建表"><a href="#17-1创建表" class="headerlink" title="17.1创建表"></a>17.1创建表</h2><p>一般有两种创建表的方法：</p>
<p>多数dbms都具有交互式创建和管理数据库表的工具</p>
<p>表可以直接用sql语句操纵</p>
<h3 id="17-1-1表创建基础"><a href="#17-1-1表创建基础" class="headerlink" title="17.1.1表创建基础"></a>17.1.1表创建基础</h3><p>利用CREATE TABLE创建表，必须给出下列信息：</p>
<p>新表的名字，在create table关键字之后给出</p>
<p>列表的名字和定义，用逗号分隔</p>
<p>有的dbms还要求指定表的位置</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> new_table</span><br><span class="line">(id <span class="type">CHAR</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line"> passwd <span class="type">CHAR</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>这里创建了一个名叫new_table 的表，表中有两列，一列是id 一列是passwd，后面跟了数据类型。</p>
<h3 id="17-1-2使用null值"><a href="#17-1-2使用null值" class="headerlink" title="17.1.2使用null值"></a>17.1.2使用null值</h3><p>每个表列要么是NULL列，要么是NOT NULL列，有null的时候那个列的默认值就是null。</p>
<h3 id="17-1-3指定默认列"><a href="#17-1-3指定默认列" class="headerlink" title="17.1.3指定默认列"></a>17.1.3指定默认列</h3><p>默认值在CREATE TABLE语句的列定义中用关键字DEFAULT指定</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> new_table</span><br><span class="line">(id <span class="type">CHAR</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line"> passwd <span class="type">CHAR</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">1</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="17-2更新表"><a href="#17-2更新表" class="headerlink" title="17.2更新表"></a>17.2更新表</h2><p>更新表定义，可以使用ALTER TABLE语句，虽然所有的dbms都支持这个语句，但是他们的允许更新的内容差别很大。</p>
<p>所以在这里给出都支持的操作。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> new_table</span><br><span class="line"><span class="keyword">ADD</span> name <span class="type">CHAR</span>(<span class="number">20</span>)</span><br></pre></td></tr></table></figure>

<p>在new_table 表中创建了添加了一个新的列，名为name。</p>
<h2 id="17-3删除表"><a href="#17-3删除表" class="headerlink" title="17.3删除表"></a>17.3删除表</h2><p>使用DROP TABLE语句即可</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> new_table;</span><br></pre></td></tr></table></figure>

<h2 id="17-4重命名表"><a href="#17-4重命名表" class="headerlink" title="17.4重命名表"></a>17.4重命名表</h2><p>每个dbms对表重命名的支持有所不同，对于这个操作，不存在严格的标准。</p>
<p>mysql用户使用rename语句，其他的大伙自行查阅即可。</p>
<h1 id="第十八课-使用视图"><a href="#第十八课-使用视图" class="headerlink" title="第十八课 使用视图"></a>第十八课 使用视图</h1><h2 id="18-1视图"><a href="#18-1视图" class="headerlink" title="18.1视图"></a>18.1视图</h2><p>视图是虚拟的表，与包含数据的表不一样，视图只包含使用时动态检索数据的查询。</p>
<p>当我们需要查询多个表的数据时，可能会运用表的联结，但是如果把多个表包装成名为xxx的虚拟表，则可以让我们的检索代码更加简洁。</p>
<h3 id="18-1-1视图的一些规则和限制"><a href="#18-1-1视图的一些规则和限制" class="headerlink" title="18.1.1视图的一些规则和限制"></a>18.1.1视图的一些规则和限制</h3><p>与表一样，视图必须唯一命名。</p>
<p>对于可以创建的视图数目没有限制。</p>
<p>视图可以嵌套，即可以利用从其他视图中检索数据的查询来构造视图。</p>
<p>许多dbms禁止在视图中使用order by</p>
<h2 id="18-2创建视图"><a href="#18-2创建视图" class="headerlink" title="18.2创建视图"></a>18.2创建视图</h2><p>用CREATE VIEW 语句来创建，并且只能用于创建不存在的视图。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> xxx <span class="keyword">as</span></span><br><span class="line"><span class="keyword">select</span> xxx,xxx</span><br><span class="line"><span class="keyword">from</span> xxx,xx</span><br><span class="line"><span class="keyword">where</span> xxx</span><br></pre></td></tr></table></figure>

<h1 id="第十九课-使用存储过程"><a href="#第十九课-使用存储过程" class="headerlink" title="第十九课 使用存储过程"></a>第十九课 使用存储过程</h1><h2 id="19-1存储过程"><a href="#19-1存储过程" class="headerlink" title="19.1存储过程"></a>19.1存储过程</h2><p>简单的说，存储过程就是为以后使用而保存的一条或多条sql语句，可将其视为批文件，虽然他们的作用不仅限于批处理。#可以理解为python中创建一个函数</p>
<h2 id="19-2执行储存过程"><a href="#19-2执行储存过程" class="headerlink" title="19.2执行储存过程"></a>19.2执行储存过程</h2><p>存储过程的的执行远比编写繁琐得多，所以我们先介绍存储过程的执行，</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXECUTE</span> AddNewProduct(<span class="string">&#x27;JTSO1&#x27;</span>,</span><br><span class="line">                      <span class="string">&#x27;Stuffed Eiffel Tower&#x27;</span>,</span><br><span class="line">                      <span class="number">6</span>,<span class="number">49</span>,</span><br><span class="line">                      <span class="string">&#x27;Plush stuffed toy withxxxx&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>这里执行了一个名为AddNewProduct的存储过程，佳宁一个新产品添加到Product表中，里面有四个参数，供应商，产品名，价格和描述，</p>
<h2 id="19-3创建存储过程"><a href="#19-3创建存储过程" class="headerlink" title="19.3创建存储过程"></a>19.3创建存储过程</h2><p>下面的例子是SqlServer版本?为什么作者说执行的过程比创建的过程更加繁琐？？？？</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> Malilinglistcount </span><br><span class="line"><span class="keyword">AS</span> </span><br><span class="line"><span class="keyword">DECLARE</span> <span class="variable">@cnt</span> <span class="type">INTEGER</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@cnt</span> <span class="operator">=</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>)</span><br><span class="line"><span class="keyword">FROM</span> Customers</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">NOT</span> cust_email <span class="keyword">IS</span> <span class="keyword">NULL</span></span><br><span class="line"><span class="keyword">RETURN</span> <span class="variable">@cnt</span>;</span><br></pre></td></tr></table></figure>

<p>分析：申明了一个局部变量@cnt，然后在select语句中使用这个变量 让他包含count()函数返回的的值，最后用return输出。</p>
<h1 id="第二十课管理事务处理"><a href="#第二十课管理事务处理" class="headerlink" title="第二十课管理事务处理"></a>第二十课管理事务处理</h1><h2 id="20-1事务处理"><a href="#20-1事务处理" class="headerlink" title="20.1事务处理"></a>20.1事务处理</h2><p>使用事务处理，通过确保成批的sql操作要么完全知晓，要么不完全执行，来维护数据库的完整性。</p>
<p>下面是事务处理的几个关键词</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">事物 transaction 指一组<span class="keyword">sql</span>语句</span><br><span class="line">回退 <span class="keyword">rollback</span> 指撤销指定<span class="keyword">sql</span>的过程</span><br><span class="line">提交 <span class="keyword">commit</span> 指将为存储的<span class="keyword">sql</span>语句结果写入数据库表</span><br><span class="line">保留点 saepoint 值事务处理中设置的临时占位符，可以对他发布退回</span><br></pre></td></tr></table></figure>

<h2 id="20-2控制事务处理"><a href="#20-2控制事务处理" class="headerlink" title="20.2控制事务处理"></a>20.2控制事务处理</h2><p>不同的dbms有不同的语法。</p>
<p>下面举sql server</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span> TRANSACTION</span><br><span class="line"></span><br><span class="line"><span class="keyword">COMMIT</span> TRANSACTION</span><br></pre></td></tr></table></figure>

<h3 id="20-2-1使用ROLLBACK"><a href="#20-2-1使用ROLLBACK" class="headerlink" title="20.2.1使用ROLLBACK"></a>20.2.1使用ROLLBACK</h3><p>sqk的rollback用来回撤sql语句，</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> Orders</span><br><span class="line"><span class="keyword">ROLLBACK</span></span><br></pre></td></tr></table></figure>

<h3 id="20-2-2使用commit"><a href="#20-2-2使用commit" class="headerlink" title="20.2.2使用commit"></a>20.2.2使用commit</h3><p>一般的sql语句都是针对数据库表直接执行和编写的。这就是所谓的隐式提交(implicit commit)，即提交操作是自动进行的。</p>
<p>在事物处理块中，他并不会隐式提交，有的dbms又是。</p>
<p>下面是sql server 的例子</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span> TRANSACTION</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">Order</span></span><br><span class="line"><span class="keyword">COMMIT</span> TRANSACTION</span><br></pre></td></tr></table></figure>

<h1 id="第二十一课-使用游标"><a href="#第二十一课-使用游标" class="headerlink" title="第二十一课 使用游标"></a>第二十一课 使用游标</h1><h2 id="20-1-游标"><a href="#20-1-游标" class="headerlink" title="20.1 游标"></a>20.1 游标</h2><p>在使用游标前，必须声明他。</p>
<p>一旦声明，就必须打开游标以供使用。</p>
<p>对于填有数据的游标，根据需要取出(检索)各行。</p>
<p>在结束游标使用时，必须关闭，</p>
<h3 id="20-1-1创建游标"><a href="#20-1-1创建游标" class="headerlink" title="20.1.1创建游标"></a>20.1.1创建游标</h3><p>使用DECLARE语句创建游标，这条语句在不同的dbms中有所不同。</p>
<p>DECLARE命名游标，并定义相应的select语句。</p>
<p>下面是mysql和sqlserver的例子</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> CustCUrosr <span class="keyword">CURSOR</span></span><br><span class="line"><span class="keyword">FOR</span> </span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Customers</span><br></pre></td></tr></table></figure>

<h3 id="20-1-2使用游标"><a href="#20-1-2使用游标" class="headerlink" title="20.1.2使用游标"></a>20.1.2使用游标</h3><p>使用OPEN CURSOR 语句打开游标，这条语句很简单，在大多数dbms中的语法相同：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">OPEN</span> SURSOR CustoCurso</span><br></pre></td></tr></table></figure>

<p>现在可以用FETCH语句访问游标数据了，指出要检索哪些行，从何处检索他们以及将他们放于何处。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> TYPE CustCursor <span class="keyword">IS</span> <span class="keyword">REF</span> <span class="keyword">CURSOR</span> </span><br><span class="line">    <span class="keyword">RETURN</span> Customers<span class="operator">%</span>ROWTUPE;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">OPEN</span> CustCursor;</span><br><span class="line">    <span class="keyword">FETCH</span> CustCursor <span class="keyword">INTO</span> CustRecord;</span><br><span class="line">    <span class="keyword">CLOSE</span> CustCursor;</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-cn">
    <link itemprop="mainEntityOfPage" href="https://wanheiqiyihu.top/2022/01/10/ctfhub-find-it/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="十三">
      <meta itemprop="description" content="潜心学习，不骄不躁">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="十三の博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/10/ctfhub-find-it/" class="post-title-link" itemprop="url">ctfhub find_it</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-01-10 15:59:50 / 修改时间：16:00:18" itemprop="dateCreated datePublished" datetime="2022-01-10T15:59:50+08:00">2022-01-10</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Experience/" itemprop="url" rel="index"><span itemprop="name">-Experience</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="ctfhub-find-it"><a href="#ctfhub-find-it" class="headerlink" title="ctfhub find_it"></a>ctfhub find_it</h1><p>在robots.php中发现提示</p>
<p>然后访问.文件.swp的时候发现备份源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Really easy...</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$file</span>=fopen(<span class="string">&quot;flag.php&quot;</span>,<span class="string">&quot;r&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Unable 2 open!&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$I_know_you_wanna_but_i_will_not_give_you_hhh</span> = fread(<span class="variable">$file</span>,filesize(<span class="string">&quot;flag.php&quot;</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$hack</span>=fopen(<span class="string">&quot;hack.php&quot;</span>,<span class="string">&quot;w&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Unable 2 open&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/system|eval|exec|base|compress|chr|ord|str|replace|pack|assert|preg|replace|create|function|call|\~|\^|\`|flag|cat|tac|more|tail|echo|require|include|proc|open|read|shell|file|put|get|contents|dir|link|dl|var|dump/&#x27;</span>,<span class="variable">$a</span>))&#123;</span><br><span class="line">	<span class="keyword">die</span>(<span class="string">&quot;you die&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(strlen(<span class="variable">$a</span>)&gt;<span class="number">33</span>)&#123;</span><br><span class="line">	<span class="keyword">die</span>(<span class="string">&quot;nonono.&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">fwrite(<span class="variable">$hack</span>,<span class="variable">$a</span>);</span><br><span class="line">fwrite(<span class="variable">$hack</span>,<span class="variable">$I_know_you_wanna_but_i_will_not_give_you_hhh</span>);</span><br><span class="line"></span><br><span class="line">fclose(<span class="variable">$file</span>);</span><br><span class="line">fclose(<span class="variable">$hack</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>发现代码中把falg写入了hack.php中</p>
<p>利用show_source()函数将文件读出来。</p>
<p>再或者用大小写绕过这种没有忽略大小写的preg_match System()</p>
<p><a target="_blank" rel="noopener" href="https://writeup.ctfhub.com/Challenge/2021/%E7%AC%AC%E5%9B%9B%E5%B1%8A%E7%BA%A2%E5%B8%BD%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B/Web/oKTHZCKnTRgZzifYg5twqZ.html">find_it | CTFHub</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/47/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/47/">47</a><span class="page-number current">48</span><a class="page-number" href="/page/49/">49</a><span class="space">&hellip;</span><a class="page-number" href="/page/58/">58</a><a class="extend next" rel="next" href="/page/49/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="十三"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">十三</p>
  <div class="site-description" itemprop="description">潜心学习，不骄不躁</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">173</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">十三</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginModelPath":"assets/","model":{"jsonPath":"live2d-widget-model-tsumiki"},"display":{"position":"right","width":300,"height":600},"mobile":{"show":true},"log":false,"pluginJsPath":"lib/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/clicklove.js"></script>
